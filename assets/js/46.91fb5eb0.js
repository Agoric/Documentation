(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{445:function(t,a,n){"use strict";n.r(a);var s=n(41),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"chainlink-integration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#chainlink-integration"}},[t._v("#")]),t._v(" Chainlink Integration")]),t._v(" "),n("p",[t._v("This document explains how to consume "),n("a",{attrs:{href:"https://chain.link",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chainlink\noracles"),n("OutboundLink")],1),t._v(" when unit testing, integration testing, and\nactually on-chain.")]),t._v(" "),n("h2",{attrs:{id:"overview"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[t._v("#")]),t._v(" Overview")]),t._v(" "),n("p",[t._v("Using Chainlink on Agoric provides two main features:")]),t._v(" "),n("ul",[n("li",[t._v("Price feeds are exposed on Agoric via the on-chain "),n("code",[t._v("home.priceAuthority")]),t._v(". This is an\nofficially-sponsored "),n("RouterLink",{attrs:{to:"/zoe/guide/price-authority.html"}},[t._v("price authority")]),t._v(" built\nfrom aggregating several Chainlink nodes.")],1),t._v(" "),n("li",[n("a",{attrs:{href:"https://docs.chain.link/docs/request-and-receive-data",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chainlink's Any API"),n("OutboundLink")],1),t._v("\ncan initiate a job on a single oracle and return its results")])]),t._v(" "),n("p",[t._v("We have tested these features with "),n("a",{attrs:{href:"https://github.com/Agoric/dapp-oracle/blob/main/chainlink-agoric/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("actual Chainlink oracle\nsoftware"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("p",[n("strong",[t._v("Note")]),t._v(": Chainlink has not yet (as of 2020-11-16) finished setting up an incentivized testnet for established Chainlink node operators to connect to Agoric.")]),t._v(" "),n("h2",{attrs:{id:"price-authority"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#price-authority"}},[t._v("#")]),t._v(" Price Authority")]),t._v(" "),n("p",[t._v("To test your contract against a locally-simulated price authority, just follow\nthe instructions in "),n("RouterLink",{attrs:{to:"/zoe/api/contract-support/price-authority.html"}},[t._v("the Price Authority API")]),t._v(".")],1),t._v(" "),n("p",[t._v("To use the curated on-chain price authority, see "),n("code",[t._v("home.priceAuthority")]),t._v(".  For\nexample, to get a quote for selling "),n("code",[t._v("30 Testnet.$LINK")]),t._v(" in "),n("code",[t._v("Testnet.$USD")]),t._v(":")]),t._v(" "),n("p",[t._v("(Note that this is a mock price until there are actual Chainlink nodes on the\ntestnet).")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" linkIssuer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("home"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIssuer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Testnet.$LINK'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" linkBrand "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("linkIssuer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBrand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" linkAmount "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" amountMath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("linkBrand"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" usdBrand "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("home"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIssuer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Testnet.$USD'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBrand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" quoteAmount"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" amountOut"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" usdAmount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timestamp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("home"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("priceAuthority"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("quoteGiven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("linkAmount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" usdBrand"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"any-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#any-api"}},[t._v("#")]),t._v(" Any API")]),t._v(" "),n("p",[t._v("To use Chainlink's Any API, you need to get an instance of the\n"),n("RouterLink",{attrs:{to:"/zoe/guide/contracts/oracle.html"}},[t._v("Low-level Oracle Query Contract")]),t._v(" and submit a\nquery of the form:")],1),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  jobId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Chainlink JobId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("job parameters"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("The oracle node returns its result, which is a JSONable value such as a string.\nThis is sent as your query's reply.")]),t._v(" "),n("p",[t._v("You can test these queries against a locally-running Chainlink node that you\ncontrol.  Follow "),n("a",{attrs:{href:"https://github.com/Agoric/dapp-oracle/blob/main/chainlink-agoric/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("the Chainlink integration\ninstructions"),n("OutboundLink")],1),t._v("\nto set it up.")]),t._v(" "),n("p",[t._v("There is also a more limited local node that emulates part of the Chainlink API\nwithout having to run Docker containers.  This is the "),n("a",{attrs:{href:"https://github.com/agoric/dapp-oracle#running-a-local-builtin-oracle",target:"_blank",rel:"noopener noreferrer"}},[t._v("local (mock) builtin\noracle"),n("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);a.default=e.exports}}]);