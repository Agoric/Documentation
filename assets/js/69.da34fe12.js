(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{473:function(t,e,a){"use strict";a.r(e);var s=a(41),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"zoe-contract-facet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zoe-contract-facet"}},[t._v("#")]),t._v(" Zoe Contract Facet")]),t._v(" "),a("Zoe-Version"),t._v(" "),a("p",[t._v("A Zoe Contract Facet is an API object for a running contract instance to access the Zoe state\nfor that instance. A Zoe Contract Facet is accessed synchronously from within the contract,\nand usually is referred to in code as "),a("code",[t._v("zcf")]),t._v(".")]),t._v(" "),a("p",[t._v("The contract instance is launched by "),a("code",[t._v("E(zoe).startInstance()")]),t._v(", and is given access to\nthe "),a("code",[t._v("zcf")]),t._v(" object during that launch. In the operations below, "),a("code",[t._v("instance")]),t._v(" is\nthe handle for the running contract instance.")]),t._v(" "),a("h2",{attrs:{id:"start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#start"}},[t._v("#")]),t._v(" "),a("code",[t._v("start")])]),t._v(" "),a("p",[t._v("This section covers the code you need to have at the start of your contract code.")]),t._v(" "),a("p",[t._v("To warn if the correct return values for your contract are not being returned,\nadd this right before the start of your contract code. It also lets TypeScript-aware\ntools (IDEs like vsCode and WebStorm) inform the developer about required parameters\nand return values and warn when methods are misused.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @type {ContractStartFn}\n */")]),t._v("\n")])])]),a("p",[t._v("Your contract code must export a function "),a("code",[t._v("start")]),t._v(" as a non-default export.\n"),a("code",[t._v("zcf")]),t._v(" is the Zoe Contract Facet and is the only argument provided to the contract")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("start")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("zcf")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// your code here")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" creatorFacet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" creatorInvitation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" publicFacet "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" start "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("The contract must return a record with any (or none) of the following:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("creatorFacet")]),t._v(" - an object, usually with admin authority. It is only given to the entity that\ncalls "),a("code",[t._v("E(zoe).startInstance()")]),t._v("; i.e. the party that was the creator of the current contract "),a("code",[t._v("instance")]),t._v(".\nIt creates "),a("code",[t._v("invitations")]),t._v(" for other parties, and takes actions that are unrelated to making offers.")]),t._v(" "),a("li",[a("code",[t._v("creatorInvitation")]),t._v(" - a Zoe "),a("code",[t._v("invitation")]),t._v(" only given to the entity that calls "),a("code",[t._v("E(zoe).startInstance()")]),t._v("; i.e.\nthe party that was the creator of the current contract "),a("code",[t._v("instance")]),t._v(".\nThis is usually used when a party has to make an offer first, such as escrowing the underlying good\nfor sale in an auction or covered call.")]),t._v(" "),a("li",[a("code",[t._v("publicFacet")]),t._v(" - an object available through Zoe to anyone who knows the contract instance. Use the "),a("code",[t._v("publicFacet")]),t._v(" for general queries and actions, such as getting the current price or creating public "),a("code",[t._v("invitations")]),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"zcf-makezcfmint-keyword-amountmathkind"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-makezcfmint-keyword-amountmathkind"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.makeZCFMint(keyword, amountMathKind)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("keyword")]),t._v(" "),a("code",[t._v("{String}")])]),t._v(" "),a("li",[a("code",[t._v("amountMathKind")]),t._v(" "),a("code",[t._v("{AmountMathKind}")]),t._v(" (defaults to "),a("code",[t._v("MathKind.NAT")]),t._v(")")]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{Promise<ZCFMint>}")])])]),t._v(" "),a("p",[t._v("Creates a synchronous Zoe mint, allowing users to mint and reallocate digital assets synchronously\ninstead of relying on an asynchronous ERTP "),a("code",[t._v("mint")]),t._v(".")]),t._v(" "),a("p",[a("strong",[t._v("Important")]),t._v(": "),a("code",[t._v("ZCFMints")]),t._v(" do "),a("strong",[t._v("not")]),t._v(" have the same methods as an ERTP "),a("code",[t._v("mint")]),t._v(". Do not try to use\nERTP methods on a "),a("code",[t._v("ZCFMint")]),t._v(" or vice versa.")]),t._v(" "),a("p",[a("strong",[t._v("Important")]),t._v(": On the other hand, the "),a("code",[t._v("issuer")]),t._v(" and "),a("code",[t._v("brand")]),t._v(" associated with a "),a("code",[t._v("zcfMint")]),t._v("\ndo have the same methods as their ERTP-derived counterparts. Assets created by a "),a("code",[t._v("zcfMint")]),t._v(" are treated\nthe same as ERTP "),a("code",[t._v("mint")]),t._v("-created assets by ERTP methods.")]),t._v(" "),a("p",[a("code",[t._v("AmountKeywordRecord")]),t._v(" is a record in which the keys are keywords, and\nthe values are "),a("code",[t._v("amounts")]),t._v(". Keywords are unique identifiers per contract,\nthat tie together the "),a("code",[t._v("proposal")]),t._v(", "),a("code",[t._v("payments")]),t._v(" to be escrowed, and "),a("code",[t._v("payouts")]),t._v("\nto the user. In the below example, "),a("code",[t._v("Asset")]),t._v(" and "),a("code",[t._v("Price")]),t._v(" are keywords.")]),t._v(" "),a("p",[t._v("Users should submit their "),a("code",[t._v("payments")]),t._v(" using keywords:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" payments "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" quatloosPayment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("And, users will receive their "),a("code",[t._v("payouts")]),t._v(" with keywords as the keys of a "),a("code",[t._v("payout")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("quatloosPurse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deposit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Asset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("For example:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" quatloos5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" amountMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quatloosBrand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5n")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" quatloos9 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" amountMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quatloosBrand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9n")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myAmountKeywordRecord "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" quatloos5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  Price"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" quatloos9\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The following demonstrates "),a("code",[t._v("zcf.makeZCFMint")]),t._v(":")]),t._v(" "),a("p",[a("strong",[t._v("Note")]),t._v(": The call to make the "),a("code",[t._v("ZCFMint")]),t._v(" is asynchronous, but\ncalls to the resulting "),a("code",[t._v("ZCFMint")]),t._v(" are synchronous.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mySynchronousMint "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeZCFMint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySyncMint'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" brand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" issuer "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mySynchronousMint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIssuerRecord")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmySynchronousMint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mintGains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" MyKeyword"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amount "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" seat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("ZCFSeats")]),t._v(" have three methods:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("getIssuerRecord()")])]),t._v(" "),a("li",[a("code",[t._v("mintGains(gains, zcfSeat)")])]),t._v(" "),a("li",[t._v("`burnLosses(losses, zcfSeat)")])]),t._v(" "),a("h3",{attrs:{id:"zcfmint-getissuerrecord"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfmint-getissuerrecord"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFMint.getIssuerRecord()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("code",[t._v("{IssuerRecord}")])]),t._v(" "),a("li",[t._v("Returns an "),a("code",[t._v("issuerRecord")]),t._v(" containing the "),a("code",[t._v("issuer")]),t._v(" and "),a("code",[t._v("brand")]),t._v(" associated with the "),a("code",[t._v("zcfMint")]),t._v(".")])]),t._v(" "),a("h3",{attrs:{id:"zcfmint-mintgains-gains-zcfseat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfmint-mintgains-gains-zcfseat"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFMint.mintGains(gains, zcfSeat)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("gains")]),t._v(": "),a("code",[t._v("AmountKeywordRecord")])]),t._v(" "),a("li",[a("code",[t._v("zcfSeat")]),t._v(": "),a("code",[t._v("{ZCFSeat}")]),t._v(" - optional")]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{ZCFSeat}")])]),t._v(" "),a("li",[t._v("All "),a("code",[t._v("amounts")]),t._v(" in "),a("code",[t._v("gains")]),t._v(" must be of this "),a("code",[t._v("ZCFMint")]),t._v("'s "),a("code",[t._v("brand")]),t._v(".\nThe "),a("code",[t._v("gains")]),t._v("' keywords are in that "),a("code",[t._v("seat")]),t._v("'s namespace.\nMint the "),a("code",[t._v("gains")]),t._v(" "),a("code",[t._v("amount")]),t._v(" of assets and add them to\nthat "),a("code",[t._v("seat")]),t._v("'s "),a("code",[t._v("allocation")]),t._v(". If a "),a("code",[t._v("seat")]),t._v(" is provided,\nit is returned. Otherwise a new "),a("code",[t._v("seat")]),t._v(" is returned.")]),t._v(" "),a("li",[a("code",[t._v("zcfMint.mintGains({ Token: amount }, seat);")])])]),t._v(" "),a("h3",{attrs:{id:"zcfmint-burnlosses-losses-zcfseat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfmint-burnlosses-losses-zcfseat"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFMint.burnLosses(losses, zcfSeat)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("losses")]),t._v(": "),a("code",[t._v("AmountKeywordRecord")])]),t._v(" "),a("li",[a("code",[t._v("zcfSeat")]),t._v(" : "),a("code",[t._v("{ZCFSeat}")])]),t._v(" "),a("li",[t._v("Returns: void")]),t._v(" "),a("li",[t._v("All "),a("code",[t._v("amounts")]),t._v(" in "),a("code",[t._v("losses")]),t._v(" must be of this "),a("code",[t._v("ZCFMint")]),t._v("'s "),a("code",[t._v("brand")]),t._v(".\nThe "),a("code",[t._v("losses")]),t._v("' keywords are in that "),a("code",[t._v("seat")]),t._v("'s namespace.\nSubtract "),a("code",[t._v("losses")]),t._v(" from that "),a("code",[t._v("seat")]),t._v("'s "),a("code",[t._v("allocation")]),t._v(", then\nburn that "),a("code",[t._v("amount")]),t._v(" of assets from the pooled "),a("code",[t._v("purse")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("zcfMint.burnLosses({ Token: amount }, seat);")]),t._v("getIssuerRecord()`")])]),t._v(" "),a("h2",{attrs:{id:"zcf-getinvitationissuer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-getinvitationissuer"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.getInvitationIssuer()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("RouterLink",{attrs:{to:"/ertp/api/issuer.html"}},[a("code",[t._v("{Issuer}")])])],1)]),t._v(" "),a("p",[t._v("Zoe has a single "),a("code",[t._v("invitationIssuer")]),t._v(" for the entirety of its\nlifetime. This method returns the Zoe "),a("code",[t._v("InvitationIssuer")]),t._v(", which\nvalidates user-received "),a("code",[t._v("invitations")]),t._v(" to participate\nin contract instances.")]),t._v(" "),a("p",[t._v('"All '),a("code",[t._v("invitations")]),t._v(" come from this single "),a("code",[t._v("invitation")]),t._v(" "),a("code",[t._v("issuer")]),t._v(" and its "),a("code",[t._v("mint")]),t._v(", which\nmint "),a("code",[t._v("invitations")]),t._v(" and validate their "),a("code",[t._v("amounts")]),t._v('."')]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" invitationIssuer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInvitationIssuer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-saveissuer-issuer-keyword"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-saveissuer-issuer-keyword"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.saveIssuer(issuer, keyword)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("issuer")]),t._v(" "),a("code",[t._v("{Issuer}")])]),t._v(" "),a("li",[a("code",[t._v("keyword")]),t._v(" "),a("code",[t._v("{String}")])]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{Promise<IssuerRecord>}")])])]),t._v(" "),a("p",[t._v("Informs Zoe about an "),a("code",[t._v("issuer")]),t._v(" and returns a promise for acknowledging\nwhen the "),a("code",[t._v("issuer")]),t._v(" is added and ready. The "),a("code",[t._v("keyword")]),t._v(" is the one associated\nwith the new "),a("code",[t._v("issuer")]),t._v(". It returns a promise for "),a("code",[t._v("issuerRecord")]),t._v(" of the new "),a("code",[t._v("issuer")])]),t._v(" "),a("p",[t._v("This saves an "),a("code",[t._v("issuer")]),t._v(" in Zoe's records for this contract "),a("code",[t._v("instance")]),t._v(".\nIt also has saved the "),a("code",[t._v("issuer")]),t._v(" information such that Zoe can handle offers involving\nthis "),a("code",[t._v("issuer")]),t._v(" and ZCF can provide the "),a("code",[t._v("issuerRecord")]),t._v(" synchronously on request.")]),t._v(" "),a("p",[t._v("An "),a("code",[t._v("IssuerRecord")]),t._v(" has two fields, each of which holds the namesake object\nassociated with the "),a("code",[t._v("issuer")]),t._v(" value of the record:\n"),a("code",[t._v("issuerRecord.brand")]),t._v(" and "),a("code",[t._v("issuerRecord.issuer")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveIssuer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("secondaryIssuer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" keyword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-makeinvitation-offerhandler-description-customproperties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-makeinvitation-offerhandler-description-customproperties"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.makeInvitation(offerHandler, description, customProperties)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("offerHandler")]),t._v(" "),a("code",[t._v("{ZCFSeat => Object}")])]),t._v(" "),a("li",[a("code",[t._v("description")]),t._v(" "),a("code",[t._v("{String}")])]),t._v(" "),a("li",[a("code",[t._v("customProperties")]),t._v(" "),a("code",[t._v("{Object}")])]),t._v(" "),a("li",[t._v("Returns: "),a("RouterLink",{attrs:{to:"/ertp/api/payment.html#payment"}},[a("code",[t._v("{Promise<Invitation>}")])])],1)]),t._v(" "),a("p",[t._v("Make a credible Zoe "),a("code",[t._v("invitation")]),t._v(" for a smart contract. Note that "),a("code",[t._v("invitations")]),t._v(" are a special case\nof an ERTP "),a("code",[t._v("payment")]),t._v(". They are associated with the "),a("code",[t._v("invitationIssuer")]),t._v(" and its "),a("code",[t._v("mint")]),t._v(", which\nvalidate and mint "),a("code",[t._v("invitations")]),t._v(". "),a("code",[t._v("zcf.makeInvitation()")]),t._v(" serves as an interface to\nthe "),a("code",[t._v("invitation")]),t._v(" "),a("code",[t._v("mint")]),t._v(".")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("invitation")]),t._v("'s\n"),a("code",[t._v("value")]),t._v(" specifies:")]),t._v(" "),a("ul",[a("li",[t._v("The specific contract "),a("code",[t._v("instance")]),t._v(".")]),t._v(" "),a("li",[t._v("The Zoe "),a("code",[t._v("installation")]),t._v(".")]),t._v(" "),a("li",[t._v("A unique "),a("code",[t._v("handle")])])]),t._v(" "),a("p",[t._v("The second argument is a required "),a("code",[t._v("description")]),t._v(" for the "),a("code",[t._v("invitation")]),t._v(",\nand should include whatever information is needed for a potential recipient of the "),a("code",[t._v("invitation")]),t._v("\nto know what they are getting in the optional "),a("code",[t._v("customProperties")]),t._v(" argument, which is\nput in the "),a("code",[t._v("invitation")]),t._v("'s "),a("code",[t._v("value")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" creatorInvitation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeInvitation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("makeCallOption"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'makeCallOption'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-makeemptyseatkit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-makeemptyseatkit"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.makeEmptySeatKit()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("code",[t._v("{ZCFSeat, Promise<UserSeat>}")])])]),t._v(" "),a("p",[t._v("Returns an empty "),a("code",[t._v("ZCFSeat")]),t._v(" and a promise for a "),a("code",[t._v("UserSeat")])]),t._v(" "),a("p",[t._v("Zoe uses "),a("code",[t._v("seats")]),t._v(" to represent offers, and has two seat facets (a\nparticular view or API of an object;\nthere may be multiple such APIs per object) a "),a("code",[t._v("ZCFSeat")]),t._v(" and a "),a("code",[t._v("UserSeat")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" zcfSeat"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mySeat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeEmptySeatKit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcfseat-object"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-object"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat")]),t._v(" object")]),t._v(" "),a("p",[t._v("Zoe uses "),a("code",[t._v("seats")]),t._v(" to access or manipulate offers. Seats represent active\noffers and let contracts and users interact with them. Zoe has two kinds\nof seats. "),a("code",[t._v("ZCFSeats")]),t._v(" are used within contracts and with "),a("code",[t._v("zcf")]),t._v(" methods.\n"),a("code",[t._v("UserSeats")]),t._v(" represent offers external to Zoe and the contract.")]),t._v(" "),a("p",[t._v("A "),a("code",[t._v("ZCFSeat")]),t._v(" includes synchronous queries for the current state of the\nassociated offer, such as the amounts of assets that are currently\nallocated to the offer. It also includes synchronous operations\nto manipulate the offer. The queries and operations are as follows:")]),t._v(" "),a("h3",{attrs:{id:"zcfseat-hasexited"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-hasexited"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.hasExited()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("code",[t._v("{Boolean}")])]),t._v(" "),a("li",[t._v("Returns "),a("code",[t._v("true")]),t._v(" if the "),a("code",[t._v("seat")]),t._v(" has exited, "),a("code",[t._v("false")]),t._v(" if it is still active.")])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-getnotifier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-getnotifier"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.getNotifier()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("code",[t._v("{Notifier<Allocation>}")])]),t._v(" "),a("li",[t._v("Returns a "),a("code",[t._v("notifier")]),t._v(" associated with the "),a("code",[t._v("seat")]),t._v("'s "),a("code",[t._v("allocation")]),t._v(". You use a "),a("code",[t._v("notifier")]),t._v("\nwherever some piece of code has changing state that other code wants updates on.\nThis "),a("code",[t._v("notifier")]),t._v(" provides updates on changing "),a("code",[t._v("allocations")]),t._v(" for this "),a("code",[t._v("seat")]),t._v(", and tells\nwhen the "),a("code",[t._v("seat")]),t._v(" has been exited. For more on "),a("code",[t._v("notifiers")]),t._v(", see the "),a("RouterLink",{attrs:{to:"/guides/js-programming/notifiers.html"}},[t._v("Distributed Programming Guide")]),t._v(".")],1)]),t._v(" "),a("h3",{attrs:{id:"zcfseat-getproposal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-getproposal"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.getProposal()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("code",[t._v("{ProposalRecord}")])]),t._v(" "),a("li",[t._v("A "),a("code",[t._v("Proposal")]),t._v(" is represented by a "),a("code",[t._v("ProposalRecord")]),t._v(". It is the rules\naccompanying the escrow of "),a("code",[t._v("payments")]),t._v(" dictating what the user expects\nto get back from Zoe. It has keys "),a("code",[t._v("give")]),t._v(", "),a("code",[t._v("want")]),t._v(", and\n"),a("code",[t._v("exit")]),t._v(". "),a("code",[t._v("give")]),t._v(" and "),a("code",[t._v("want")]),t._v(" are records with keywords as keys and\n"),a("code",[t._v("amounts")]),t._v(" as values. The "),a("code",[t._v("proposal")]),t._v(" is a user's understanding of the\ncontract that they are entering when they make an offer. See\n"),a("RouterLink",{attrs:{to:"/zoe/api/zoe.html#e-zoe-offer-invitation-proposal-paymentkeywordrecord"}},[a("code",[t._v("E(zoe).offer()")])]),t._v(" for full details.")],1),t._v(" "),a("li",[t._v("Example:"),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" want"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" give"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sellerSeat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProposal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-getamountallocated-keyword-brand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-getamountallocated-keyword-brand"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.getAmountAllocated(keyword, brand)")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("keyword")]),t._v(": "),a("code",[t._v("{String}")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("brand")]),t._v(": "),a("code",[t._v("{Brand}")])])]),t._v(" "),a("li",[a("p",[t._v("Returns: "),a("code",[t._v("{Amount}")])])]),t._v(" "),a("li",[a("p",[t._v("Returns the "),a("code",[t._v("amount")]),t._v(" from the part of the "),a("code",[t._v("allocation")]),t._v(" that matches the\n"),a("code",[t._v("keyword")]),t._v(" and "),a("code",[t._v("brand")]),t._v(". If the "),a("code",[t._v("keyword")]),t._v(" is not in the "),a("code",[t._v("allocation")]),t._v(", it\nreturns an empty "),a("code",[t._v("amount")]),t._v(" of the "),a("code",[t._v("brand")]),t._v(" argument. (After\n"),a("code",[t._v("exit()")]),t._v(" has been called, it continues to report the final allocation balance,\nwhich was transferred to a payout.)")]),t._v(" "),a("p",[t._v("This is similar to the next method, "),a("code",[t._v("getCurrentAllocation()")]),t._v(". "),a("code",[t._v("getAmountAllocated()")]),t._v("\ngets the "),a("code",[t._v("allocation")]),t._v(" of one keyword at a time, while "),a("code",[t._v("getCurrentAllocation()")]),t._v(" returns\nall the current "),a("code",[t._v("allocations")]),t._v(" at once.")])])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-getcurrentallocation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-getcurrentallocation"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.getCurrentAllocation()")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Returns: "),a("code",[t._v("{<Allocation>}")])])]),t._v(" "),a("li",[a("p",[t._v("An "),a("code",[t._v("Allocation")]),t._v(" is an "),a("code",[t._v("AmountKeywordRecord")]),t._v(" of key-value pairs where\nthe key is a keyword such as "),a("code",[t._v("Asset")]),t._v(" or "),a("code",[t._v("Price")]),t._v(" applicable to the\ncontract. The value is an "),a("code",[t._v("amount")]),t._v(" with its "),a("code",[t._v("value")]),t._v(" and "),a("code",[t._v("brand")]),t._v(".")]),t._v(" "),a("p",[a("code",[t._v("Allocations")]),t._v(" represent the "),a("code",[t._v("amounts")]),t._v(" to be paid out to each "),a("code",[t._v("seat")]),t._v(" on exit. (After\n"),a("code",[t._v("exit()")]),t._v(" has been called, the final allocation balances, which were transferred to\npayouts, continue to be reported.)\nNormal reasons for exiting are the user requesting to exit or the contract\nexplicitly choosing to close out the "),a("code",[t._v("seat")]),t._v(". The guarantees also hold if the contract\nencounters an error or misbehaves. There are several methods for finding out\nwhat "),a("code",[t._v("amount")]),t._v(" a current "),a("code",[t._v("allocation")]),t._v(" is.")]),t._v(" "),a("p",[t._v("This is similar to the previous method, "),a("code",[t._v("getAmountAllocated()")]),t._v(". "),a("code",[t._v("getAmountAllocated()")]),t._v("\ngets the "),a("code",[t._v("allocation")]),t._v(" of one keyword at a time, while "),a("code",[t._v("getCurrentAllocation()")]),t._v(" returns\nall the current "),a("code",[t._v("allocations")]),t._v(" at once.")]),t._v(" "),a("p",[t._v("An "),a("code",[t._v("Allocation")]),t._v(" example:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amountMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quatloosBrand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5n")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Price"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amountMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quatloosBrand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9n")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-exit-completion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-exit-completion"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.exit(completion)")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("completion")]),t._v(": "),a("code",[t._v("{Object}")])])]),t._v(" "),a("li",[a("p",[t._v("Returns: "),a("code",[t._v("void")])])]),t._v(" "),a("li",[a("p",[t._v("Causes the "),a("code",[t._v("seat")]),t._v(" to exit, concluding its existence. All "),a("code",[t._v("payouts")]),t._v(", if any,\nare made, and the "),a("code",[t._v("seat")]),t._v(" object can no longer interact with the contract.\nThe "),a("code",[t._v("completion")]),t._v(" argument is usually a string, but this is not required. Its\nonly use is for the notification sent to the contract instance's "),a("code",[t._v("done()")]),t._v(" function.\nAny other still open seats or outstanding promises and the contract instance continue.")]),t._v(" "),a("p",[t._v("Note: You should not use "),a("code",[t._v("ZCFSeat.exit()")]),t._v(" when exiting with an error. Use the method\ndescribed next, "),a("code",[t._v("ZCFSeat.fail()")]),t._v(", instead.")])])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-fail-msg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-fail-msg"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.fail(msg)")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("msg")]),t._v(": "),a("code",[t._v("{String}")])])]),t._v(" "),a("li",[a("p",[t._v("Returns: "),a("code",[t._v("void")])])]),t._v(" "),a("li",[a("p",[t._v("The "),a("code",[t._v("seat")]),t._v(" exits, displaying the optional "),a("code",[t._v("msg")]),t._v(" string, if there is one, on the console.\nThis is equivalent to exiting, except that "),a("code",[t._v("exit")]),t._v(" is successful while\n"),a("code",[t._v("fail()")]),t._v(" signals an error occured while processing the offer. The contract\nstill gets its current "),a("code",[t._v("allocation")]),t._v(" and the "),a("code",[t._v("seat")]),t._v(" can no longer interact with the contract.\nAny other still open seats or outstanding promises and the contract instance continue.")]),t._v(" "),a("p",[t._v("Agoric recommends you exit a seat with an error as follows:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" seat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'you did it wrong'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-stage-newallocation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-stage-newallocation"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.stage(newAllocation)")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("newAllocation")]),t._v(": "),a("code",[t._v("{Allocation}")])])]),t._v(" "),a("li",[a("p",[t._v("Returns: "),a("code",[t._v("{SeatStaging}")])])]),t._v(" "),a("li",[a("p",[t._v("An "),a("code",[t._v("Allocation")]),t._v(" is an "),a("code",[t._v("AmountKeywordRecord")]),t._v(" of key-value pairs where\nthe key is a keyword such as "),a("code",[t._v("Asset")]),t._v(" or "),a("code",[t._v("Price")]),t._v(" applicable to the\ncontract. The value is an "),a("code",[t._v("amount")]),t._v(" with its "),a("code",[t._v("value")]),t._v(" and "),a("code",[t._v("brand")]),t._v(".")]),t._v(" "),a("p",[t._v("A "),a("code",[t._v("seatStaging")]),t._v(" is an association of a "),a("code",[t._v("seat")]),t._v(" with reallocations. "),a("code",[t._v("reallocate()")]),t._v(" takes\nat least two "),a("code",[t._v("seatStagings")]),t._v(" as arguments and does its reallocation based on them.")]),t._v(" "),a("p",[t._v("You can create multiple independent "),a("code",[t._v("seatStagings")]),t._v(" for a "),a("code",[t._v("seat")]),t._v(". None of them has\nany effect until submitted to "),a("code",[t._v("reallocate()")]),t._v(". Each call to "),a("code",[t._v("stage()")]),t._v(" starts from the\n"),a("code",[t._v("seat")]),t._v("'s current "),a("code",[t._v("allocation")]),t._v(" and uses the "),a("code",[t._v("newAllocation")]),t._v(" as a replacement for the\ncurrent state. Any keywords not mentioned in "),a("code",[t._v("newAllocation")]),t._v(" retain the\nsame "),a("code",[t._v("amounts")]),t._v(". All keywords mentioned in the "),a("code",[t._v("newAllocation")]),t._v(" have their "),a("code",[t._v("amounts")]),t._v("\nreplaced with the corresponding "),a("code",[t._v("amount")]),t._v(" from "),a("code",[t._v("newAllocation")]),t._v(".")]),t._v(" "),a("p",[t._v("Note that ZoeHelpers "),a("RouterLink",{attrs:{to:"/zoe/api/zoe-helpers.html#trade-zcf-left-right-lefthasexitedmsg-righthasexitedmsg"}},[a("code",[t._v("trade()")])]),t._v("\nand "),a("RouterLink",{attrs:{to:"/zoe/api/zoe-helpers.html#swap-zcf-leftseat-rightseat-lefthasexitedmsg-righthasexitedmsg"}},[a("code",[t._v("swap()")])]),t._v(" might\nbe easier to use for simple cases.")],1)])]),t._v(" "),a("h3",{attrs:{id:"zcfseat-isoffersafe-newallocation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcfseat-isoffersafe-newallocation"}},[t._v("#")]),t._v(" "),a("code",[t._v("ZCFSeat.isOfferSafe(newAllocation)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("newAllocation")]),t._v(": "),a("code",[t._v("{Allocation}")])]),t._v(" "),a("li",[t._v("Returns "),a("code",[t._v("{Boolean}")])]),t._v(" "),a("li",[t._v("Takes an "),a("code",[t._v("allocation")]),t._v(" as an argument and returns "),a("code",[t._v("true")]),t._v(" if that "),a("code",[t._v("allocation")]),t._v("\nsatisfies offer safety, "),a("code",[t._v("false")]),t._v(" if is doesn't. Essentially, it checks\n"),a("code",[t._v("newAllocation")]),t._v(" for offer safety, against the "),a("code",[t._v("seat")]),t._v("'s "),a("code",[t._v("proposal")]),t._v(".\nIt checks whether "),a("code",[t._v("newAllocation")]),t._v(" fully satisfies\n"),a("code",[t._v("proposal.give")]),t._v(" (giving a refund) or whether it fully satisfies\n"),a("code",[t._v("proposal.want")]),t._v(". Both can be fully satisfied. See the ZoeHelper\n"),a("RouterLink",{attrs:{to:"/zoe/api/zoe-helpers.html#satisfies-zcf-seat-update"}},[a("code",[t._v("satisfies()")])]),t._v(" method for more details.")],1)]),t._v(" "),a("h2",{attrs:{id:"zcf-getbrandforissuer-issuer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-getbrandforissuer-issuer"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.getBrandForIssuer(issuer)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("issuer")]),t._v(" "),a("code",[t._v("{Issuer}")])]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{Brand}")])])]),t._v(" "),a("p",[t._v("Returns the "),a("code",[t._v("brand")]),t._v(" associated with the "),a("code",[t._v("issuer")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"zcf-getissuerforbrand-brand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-getissuerforbrand-brand"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.getIssuerForBrand(brand)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("brand")]),t._v(" "),a("code",[t._v("{Brand}")])]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{Issuer}")])])]),t._v(" "),a("p",[t._v("Returns the "),a("code",[t._v("issuer")]),t._v(" of the "),a("code",[t._v("brand")]),t._v(" argument.")]),t._v(" "),a("h2",{attrs:{id:"zcf-getmathkind-brand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-getmathkind-brand"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.getMathKind(brand)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("brand")]),t._v(" "),a("code",[t._v("{Brand}")])]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{MathKind}")])])]),t._v(" "),a("p",[t._v("Returns the "),a("code",[t._v("MathKind")]),t._v(" associated with the "),a("code",[t._v("brand")]),t._v(" argument.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" quatloosMathKind "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMathKind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quatloosBrand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-stopacceptingoffers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-stopacceptingoffers"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.stopAcceptingOffers()")])]),t._v(" "),a("ul",[a("li",[t._v("The contract requests Zoe to not accept offers for this contract instance.\nIt can't be called from outside the contract unless the contract explicitly makes it accessible.")])]),t._v(" "),a("h2",{attrs:{id:"zcf-shutdown-completion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-shutdown-completion"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.shutdown(completion)")])]),t._v(" "),a("p",[t._v("Shuts down the entire vat and contract instance and gives payouts.")]),t._v(" "),a("p",[t._v("All open "),a("code",[t._v("seats")]),t._v(" associated with the current "),a("code",[t._v("instance")]),t._v(" have "),a("code",[t._v("fail()")]),t._v("\ncalled on them.")]),t._v(" "),a("p",[t._v("Call when:")]),t._v(" "),a("ul",[a("li",[t._v("You want nothing more to happen in the contract, and")]),t._v(" "),a("li",[t._v("You don't want to take any more offers")])]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("completion")]),t._v(" argument is usually a string, but this\nis not required. It is used for the notification sent to the\ncontract instance's "),a("code",[t._v("done()")]),t._v(" function. Any still open seats or\nother outstanding promises are closed with a generic 'vat terminated'\nmessage.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-getterms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-getterms"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.getTerms()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("code",[t._v("{Object}")])])]),t._v(" "),a("p",[t._v("Returns the "),a("code",[t._v("issuers")]),t._v(", "),a("code",[t._v("brands")]),t._v(", and custom "),a("code",[t._v("terms")]),t._v(" the current contract "),a("code",[t._v("instance")]),t._v(" was instantiated with.")]),t._v(" "),a("p",[t._v("The returned values look like:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" brands"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" issuers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" customTermA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" customTermB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// where brands and issuers are keywordRecords, like:")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    brands"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" moolaKit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("brand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" simoleanKit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("brand "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    issuers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" moolaKit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("issuer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" simoleanKit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("issuer "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customTermA"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'something'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customTermB"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'something else'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Note that there is also an "),a("code",[t._v("E(zoe).getTerms(instance)")]),t._v(". Often the choice of which to use is not which method\nto use, but which of Zoe Service or ZCF you have access to. On the contract side, you more easily have access\nto "),a("code",[t._v("zcf")]),t._v(", and "),a("code",[t._v("zcf")]),t._v(" already knows what instance is running. So in contract code, you use "),a("code",[t._v("zcf.getTerms()")]),t._v(". From\na user side, with access to Zoe Service, you use "),a("code",[t._v("E(zoe).getTerms()")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" brands"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" issuers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maths"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" terms "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTerms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-getzoeservice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-getzoeservice"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.getZoeService()")])]),t._v(" "),a("ul",[a("li",[t._v("Returns: "),a("RouterLink",{attrs:{to:"/zoe/api/zoe.html"}},[t._v("ZoeService")])],1)]),t._v(" "),a("p",[t._v("This is the only way to get the user-facing "),a("RouterLink",{attrs:{to:"/zoe/api/zoe.html#zoe"}},[t._v("Zoe Service API")]),t._v(" to\nthe contract code as well.")],1),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Making an offer to another contract instance in the contract.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" zoeService "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getZoeService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zoeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("offer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("creatorInvitation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" proposal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" paymentKeywordRecord"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-assertuniquekeyword-keyword"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-assertuniquekeyword-keyword"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.assertUniqueKeyword(keyword)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("keyword")]),t._v(" "),a("code",[t._v("{String}")])]),t._v(" "),a("li",[t._v("Returns: Undefined")])]),t._v(" "),a("p",[t._v("Checks if a keyword is valid and not already used as a "),a("code",[t._v("brand")]),t._v(" in this "),a("code",[t._v("instance")]),t._v(" (i.e. unique)\nand could be used as a new "),a("code",[t._v("brand")]),t._v(" to make an "),a("code",[t._v("issuer")]),t._v(". Throws an appropriate error if it's not\na valid keyword, or is not unique.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertUniqueKeyword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("keyword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"zcf-reallocate-seatstagings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zcf-reallocate-seatstagings"}},[t._v("#")]),t._v(" "),a("code",[t._v("zcf.reallocate(seatStagings)")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("seatStagings")]),t._v(" "),a("code",[t._v("{SeatStaging[]}")]),t._v(" (at least two)")]),t._v(" "),a("li",[t._v("Returns: "),a("code",[t._v("{void}")])])]),t._v(" "),a("p",[t._v("The contract reallocates over "),a("code",[t._v("seatStagings")]),t._v(", which are\nassociations of "),a("code",[t._v("seats")]),t._v(" with new "),a("code",[t._v("allocations")]),t._v(" to be used in reallocation.\nThere must be at least two "),a("code",[t._v("seatStagings")]),t._v(" in the array argument.")]),t._v(" "),a("p",[t._v("The reallocation only succeeds if it:")]),t._v(" "),a("ol",[a("li",[t._v("Conserves rights (the specified "),a("code",[t._v("amounts")]),t._v(" have the same total value as the\ncurrent total amount)")]),t._v(" "),a("li",[t._v("Is 'offer-safe' for all parties\ninvolved. Offer safety is checked at the staging step.")])]),t._v(" "),a("p",[t._v("The reallocation is partial, only applying to "),a("code",[t._v("seats")]),t._v(" associated\nwith the "),a("code",[t._v("seatStagings")]),t._v(". By induction, if rights conservation and\noffer safety hold before, they hold after a safe reallocation.")]),t._v(" "),a("p",[t._v("This is true even though we only re-validate for "),a("code",[t._v("seats")]),t._v(" whose\n"),a("code",[t._v("allocations")]),t._v(" change. A reallocation can only effect offer safety for\nthose "),a("code",[t._v("seats")]),t._v(", and since rights are conserved for the change, overall\nrights are unchanged.")]),t._v(" "),a("p",[a("code",[t._v("reallocate()")]),t._v(" throws these errors:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("reallocating must be done over two or more seats")])]),t._v(" "),a("li",[a("code",[t._v("The seatStaging was not recognized")])]),t._v(" "),a("li",[a("code",[t._v("The seatStaging was not recognized")])]),t._v(" "),a("li",[a("code",[t._v("keyword must be unique")])]),t._v(" "),a("li",[t._v("If the total "),a("code",[t._v("amount")]),t._v(" per "),a("code",[t._v("brand")]),t._v(" is not equal to the total "),a("code",[t._v("amount")]),t._v(" per "),a("code",[t._v("brand")]),t._v("\nin the proposed reallocation. (no message)")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("zcf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reallocate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    seat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("seatAAllocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    seat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("seatBAllocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])],1)}),[],!1,null,null,null);e.default=n.exports}}]);