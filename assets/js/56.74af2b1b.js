(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{456:function(e,t,s){"use strict";s.r(t);var a=s(41),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"ses-reference"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ses-reference"}},[e._v("#")]),e._v(" SES Reference")]),e._v(" "),s("p",[e._v('This document describes how SES (Secure ECMAScript) affects writing Agoric JavaScript code.\nIt is very much a "how to do something" document, with little explanation about why and\nhow something was implemented or other background information. For that, see the more\ncomprehensive '),s("RouterLink",{attrs:{to:"/guides/js-programming/ses/ses-guide.html"}},[e._v("SES Guide")]),e._v(".")],1),e._v(" "),s("h2",{attrs:{id:"using-ses-with-your-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-ses-with-your-code"}},[e._v("#")]),e._v(" Using SES with your code")]),e._v(" "),s("p",[e._v("The SES shim transforms ordinary JavaScript environments into SES environments.")]),e._v(" "),s("p",[e._v("On Node.js you can import or require "),s("code",[e._v("ses")]),e._v(" in either CommonJS or ECMAScript modules, then call "),s("code",[e._v("lockdown()")]),e._v(". This is a "),s("em",[e._v("shim")]),e._v(". It mutates the environment in place so any code running after the shim can assume itâ€™s running in a SES environment. This includes the globals "),s("code",[e._v("lockdown()")]),e._v(", "),s("code",[e._v("harden()")]),e._v(", "),s("code",[e._v("Compartment")]),e._v(", and so on. For example:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ses"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("Or:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'ses'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("To ensure a module runs in a SES environment, wrap the above code in a "),s("code",[e._v("ses-lockdown.js")]),e._v(" module and import it:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./non-ses-code-before-lockdown.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./ses-lockdown.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// calls lockdown.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./ses-code-after-lockdown.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("To use SES as a script on the web, use the UMD build.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node_modules/ses/dist/ses.umd.min.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("p",[e._v("The full SES environment's module system requires a translating compiler. There is a much thinner SES version that just provides an evaluator Compartment. For it, use the much smaller "),s("code",[e._v("ses/lockdown")]),e._v(" layer. Especially if all client code gets bundled as a script out-of-band.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'ses/lockdown'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node_modules/ses/dist/lockdown.umd.min.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("h2",{attrs:{id:"removed-by-ses-summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#removed-by-ses-summary"}},[e._v("#")]),e._v(" Removed by SES summary")]),e._v(" "),s("p",[e._v("The following are missing or unusable under SES:")]),e._v(" "),s("ul",[s("li",[e._v("Most "),s("a",{attrs:{href:"https://nodejs.org/dist/latest-v14.x/docs/api/globals.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js-specific global objects"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("All "),s("a",{attrs:{href:"https://nodejs.org/dist/latest-v14.x/docs/api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js built-in modules"),s("OutboundLink")],1),e._v(" such as "),s("code",[e._v("http")]),e._v(" and\n"),s("code",[e._v("crypto")]),e._v(".")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API",target:"_blank",rel:"noopener noreferrer"}},[e._v("Features from browser environments"),s("OutboundLink")],1),e._v(" presented as names in the global scope including "),s("code",[e._v("atob")]),e._v(", "),s("code",[e._v("TextEncoder")]),e._v(", and "),s("code",[e._v("URL")]),e._v(".")]),e._v(" "),s("li",[e._v("HTML comments")]),e._v(" "),s("li",[e._v("Dynamic "),s("code",[e._v("import")]),e._v(" expressions")]),e._v(" "),s("li",[e._v("Direct evals")])]),e._v(" "),s("h2",{attrs:{id:"added-changed-by-ses-summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#added-changed-by-ses-summary"}},[e._v("#")]),e._v(" Added/Changed by SES summary")]),e._v(" "),s("p",[e._v("SES adds the following to JavaScript or changes them significantly:")]),e._v(" "),s("ul",[s("li",[e._v("console")]),e._v(" "),s("li",[s("code",[e._v("Compartment")])]),e._v(" "),s("li",[s("code",[e._v("lockdown()")])]),e._v(" "),s("li",[s("code",[e._v("harden()")])]),e._v(" "),s("li",[s("code",[e._v("globalThis")]),e._v(" is frozen.")]),e._v(" "),s("li",[e._v("JavaScript primordials are frozen.")])]),e._v(" "),s("h2",{attrs:{id:"lockdown"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lockdown"}},[e._v("#")]),e._v(" "),s("code",[e._v("lockdown()")])]),e._v(" "),s("p",[s("code",[e._v("lockdown()")]),e._v(" tamper-proofs all of the JavaScript intrinsics, so no program can subvert their methods\n(preventing some man in the middle attacks). Also, no program can use them to pass notes to parties\nthat haven't been expressly introduced (preventing some covert communication channels).")]),e._v(" "),s("p",[e._v("Lockdown "),s("em",[e._v("freezes")]),e._v(" all JavaScript defined objects accessible to any program in the realm. The frozen\naccessible objects include but are not limited to:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("globalThis")])]),e._v(" "),s("li",[s("code",[e._v("[].__proto__")]),e._v(" the array prototype, equivalent to "),s("code",[e._v("Array.prototype")]),e._v(" in a pristine JavaScript environment.")]),e._v(" "),s("li",[s("code",[e._v("{}.__proto__")]),e._v(" the "),s("code",[e._v("Object.prototype")])]),e._v(" "),s("li",[s("code",[e._v("(() => {}).__proto__")]),e._v(" the "),s("code",[e._v("Function.prototype")])]),e._v(" "),s("li",[s("code",[e._v("(async () => {}).__proto__")]),e._v(" the prototype of all asynchronous functions, and has no alias\nin the global scope of a pristine JavaScript environment.")]),e._v(" "),s("li",[e._v("The properties of any accessible object")])]),e._v(" "),s("p",[s("code",[e._v("lockdown()")]),e._v(" also "),s("em",[e._v("tames")]),e._v(" some objects, such as:")]),e._v(" "),s("ul",[s("li",[e._v("Regular expressions\n"),s("ul",[s("li",[e._v("A tamed RexExp does not have the deprecated compile method.")])])]),e._v(" "),s("li",[e._v("Locale methods\n"),s("ul",[s("li",[e._v("Lockdown replaces locale methods like "),s("code",[e._v("String.prototype.localeCompare()")]),e._v(" with lexical\nversions that do not reveal the user locale.")])])]),e._v(" "),s("li",[e._v("Errors\n"),s("ul",[s("li",[e._v("A tamed error does not have a V8 stack, but the console can still see the stack.")])])])]),e._v(" "),s("p",[e._v("Lockdown does not erase any powerful objects from the initial global scope. Instead,\nCompartments give complete control over what powerful objects exist for client code.")]),e._v(" "),s("h2",{attrs:{id:"lockdown-and-harden"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lockdown-and-harden"}},[e._v("#")]),e._v(" "),s("code",[e._v("lockdown()")]),e._v(" and "),s("code",[e._v("harden()")])]),e._v(" "),s("p",[s("code",[e._v("lockdown()")]),e._v(" and "),s("code",[e._v("harden()")]),e._v(" essentially do the same thing; freeze objects so their\nproperties cannot be changed. You can only interact with frozen objects through\ntheir methods. Their differences are what objects you use them on, and when you use them.")]),e._v(" "),s("p",[s("code",[e._v("lockdown()")]),e._v(" "),s("strong",[e._v("must")]),e._v(" be called first. It hardens JavaScript's built-in "),s("em",[e._v("primordials")]),e._v("\n(implicitly shared global objects) and enables "),s("code",[e._v("harden()")]),e._v(". Calling "),s("code",[e._v("harden()")]),e._v("\nbefore "),s("code",[e._v("lockdown()")]),e._v(" executes throws an error.")]),e._v(" "),s("p",[s("code",[e._v("lockdown()")]),e._v(" works on objects created by the JavaScript language itself as part of\nits definition. Use "),s("code",[e._v("harden()")]),e._v(" to freeze objects created by your JavaScript code\nafter "),s("code",[e._v("lockdown()")]),e._v("was called.")]),e._v(" "),s("h2",{attrs:{id:"lockdown-options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lockdown-options"}},[e._v("#")]),e._v(" "),s("code",[e._v("lockdown")]),e._v(" Options")]),e._v(" "),s("h3",{attrs:{id:"default-safe-settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#default-safe-settings"}},[e._v("#")]),e._v(" Default "),s("code",[e._v("'safe'")]),e._v(" settings")]),e._v(" "),s("p",[e._v("All four of these safety-relevant options default to "),s("code",[e._v("'safe'")]),e._v(" if omitted\nfrom a call to "),s("code",[e._v("lockdown()")]),e._v(". Their other possible value is "),s("code",[e._v("'unsafe'")]),e._v(".")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("regExpTaming")])]),e._v(" "),s("li",[s("code",[e._v("localeTaming")])]),e._v(" "),s("li",[s("code",[e._v("consoleTaming")])]),e._v(" "),s("li",[s("code",[e._v("errorTaming")])])]),e._v(" "),s("p",[e._v("The tradeoff is safety vs compatibility with existing code. However, much legacy\nJavaScript code does run under SES, even if both not written to do so and with all\nthe options set to "),s("code",[e._v("'safe'")]),e._v(". Only consider an "),s("code",[e._v("'unsafe'")]),e._v(" value if you both need it\nand can evaluate its risks.")]),e._v(" "),s("h3",{attrs:{id:"options-quick-reference"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#options-quick-reference"}},[e._v("#")]),e._v(" Options quick reference")]),e._v(" "),s("p",[e._v("This section provides a quick usage reference for "),s("code",[e._v("lockdown()")]),e._v("'s options, their possible\nvalues, and their usage. Each is described in more detail in their individual sections\nbelow.")]),e._v(" "),s("table",[s("tbody",[s("tr",[s("td",[s("center",[s("b",[e._v("Option")])])],1),e._v(" "),s("td",[s("center",[s("b",[e._v("Values")])])],1),e._v(" "),s("td",[s("center",[s("b",[e._v("Functionality")])])],1)]),e._v(" "),s("tr",[s("td",[s("code",[e._v("regExpTaming")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" (default) or "),s("code",[e._v("'unsafe'")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" disables all "),s("code",[e._v("RegExp.*")]),e._v(" methods,"),s("br"),e._v(" "),s("code",[e._v("'unsafe'")]),e._v(" disables all but "),s("code",[e._v("RegExp.prototype.compile()")])])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("localeTaming")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" (default) or "),s("code",[e._v("'unsafe'")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" aliases "),s("code",[e._v("toLocaleString()")]),e._v(" to "),s("code",[e._v("toString()")]),e._v(", etc.,"),s("br"),e._v(" "),s("code",[e._v("'unsafe'")]),e._v(" keeps JavaScript locale methods as is")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("consoleTaming")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" (default) or "),s("code",[e._v("'unsafe'")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" wraps start console to show deep stacks,"),s("br"),e._v(" "),s("code",[e._v("'unsafe'")]),e._v(" uses the original start console.")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("errorTaming")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" (default) or "),s("code",[e._v("'unsafe'")])]),e._v(" "),s("td",[s("code",[e._v("'safe'")]),e._v(" denies unprivileged stacks access,"),s("br"),e._v(" "),s("code",[e._v("'unsafe'")]),e._v(" makes stacks also available by "),s("code",[e._v("errorInstance.stackkeeps()")]),e._v(".")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("stackFiltering")])]),e._v(" "),s("td",[s("code",[e._v("'concise'")]),e._v(" (default) or "),s("code",[e._v("'verbose'")])]),e._v(" "),s("td",[s("code",[e._v("'concise'")]),e._v(" preserves important deep stack info,"),s("br"),e._v(" "),s("code",[e._v("'verbose'")]),e._v(" console shows full deep stacks")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("overrideTaming")])]),e._v(" "),s("td",[s("code",[e._v("'moderate'")]),e._v(" (default) or "),s("code",[e._v("'min'")])]),e._v(" "),s("td",[s("code",[e._v("'moderate'")]),e._v(" moderates mitigations for legacy compatibility,"),s("br"),e._v(" "),s("code",[e._v("'min'")]),e._v(" minimal mitigations for purely modern code")])])])]),e._v(" "),s("h3",{attrs:{id:"regexptaming-option"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#regexptaming-option"}},[e._v("#")]),e._v(" "),s("code",[e._v("regExpTaming")]),e._v(" Option")]),e._v(" "),s("p",[e._v("With its default "),s("code",[e._v("'safe'")]),e._v(" value, regExpTaming prevents using "),s("code",[e._v("RegExp.*()")]),e._v(" methods in the locked down code.")]),e._v(" "),s("p",[e._v("With its "),s("code",[e._v("'unsafe'")]),e._v(" value, "),s("code",[e._v("RegExp.prototype.compile()")]),e._v(" can be used in locked down code.\nAll other "),s("code",[e._v("RegExp.*()")]),e._v(" methods are disabled.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// regExpTaming defaults to 'safe'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" regExpTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'safe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Disables all RegExp.*() methods.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" regExpTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'unsafe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Disables all RegExp.*() methods except RegExp.prototype.compile()")]),e._v("\n")])])]),s("h3",{attrs:{id:"localetaming-option"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#localetaming-option"}},[e._v("#")]),e._v(" "),s("code",[e._v("localeTaming")]),e._v(" Option")]),e._v(" "),s("p",[e._v("The default "),s("code",[e._v("'safe'")]),e._v(" setting replaces each method listed below with their\ncorresponding non-locale-specific method. For example, "),s("code",[e._v("Object.prototype.toLocaleString()")]),e._v("\nbecomes another name for "),s("code",[e._v("Object.prototype.toString()")]),e._v(".")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("toLocaleString")])]),e._v(" "),s("li",[s("code",[e._v("toLocaleDateString")])]),e._v(" "),s("li",[s("code",[e._v("toLocaleTimeString")])]),e._v(" "),s("li",[s("code",[e._v("toLocaleLowerCase")])]),e._v(" "),s("li",[s("code",[e._v("toLocaleUpperCase")])]),e._v(" "),s("li",[s("code",[e._v("localeCompare")])])]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("'unsafe'")]),e._v(" setting keeps the original behavior for compatibility at the price\nof reproducibility and fingerprinting.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// localeTaming defaults to 'safe'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" localeTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'safe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Alias toLocaleString to toString, etc")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" localeTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'unsafe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Allow locale-specific behavior")]),e._v("\n")])])]),s("h3",{attrs:{id:"consoletaming-options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#consoletaming-options"}},[e._v("#")]),e._v(" "),s("code",[e._v("consoleTaming")]),e._v(" Options")]),e._v(" "),s("p",[e._v("The default "),s("code",[e._v("'safe'")]),e._v(" option actually expands what you would expect from "),s("code",[e._v("console")]),e._v("'s logging\noutput. It will show information from the "),s("code",[e._v("assert")]),e._v(" package and error objects.\nErrors can report more diagnostic information that should be hidden from other objects. See\nthe "),s("a",{attrs:{href:"https://github.com/endojs/endo/blob/master/packages/ses/src/error/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("error README"),s("OutboundLink")],1),e._v("\nfor an in depth explanation of this.")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("'unsafe'")]),e._v(" setting leaves the original "),s("code",[e._v("console")]),e._v(" in place. The "),s("code",[e._v("assert")]),e._v(" package\nand error objects continue to work, but the "),s("code",[e._v("console")]),e._v(" logging output will not\nshow this extra information. "),s("code",[e._v("'unsafe'")]),e._v(" does "),s("strong",[e._v("not")]),e._v(" remove any additional "),s("code",[e._v("console")]),e._v('\nmethods beyond its de facto "standards". Since we do not know if these\nmethods violate OCap security, we should assume they are unsafe. A raw '),s("code",[e._v("console")]),e._v("\nobject should only be handled by very trustworthy code.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// consoleTaming defaults to 'safe'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" consoleTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'safe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Wrap start console to show deep stacks")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" consoleTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'unsafe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Leave original start console in place")]),e._v("\n")])])]),s("h3",{attrs:{id:"errortaming-options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#errortaming-options"}},[e._v("#")]),e._v(" "),s("code",[e._v("errorTaming")]),e._v(" Options")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("errorTaming")]),e._v(" default "),s("code",[e._v("'safe'")]),e._v(" setting makes the stack trace inaccessible\nfrom error instances alone. It does this on v8 engines (Chrome, Brave, Node).\nNote that it is "),s("strong",[e._v("not")]),e._v(" hidden on other engines, leaving an information\nleak available. It reveals information only as a powerless string.")]),e._v(" "),s("p",[e._v("In JavaScript the stack is only available via "),s("code",[e._v("err.stack")]),e._v(", so some\ndevelopment tools assume it is there. When the information leak is tolerable,\nthe "),s("code",[e._v("'unsafe'")]),e._v(" setting preserves "),s("code",[e._v("err.stack")]),e._v("'s filtered stack information.")]),e._v(" "),s("p",[s("code",[e._v("errorTaming")]),e._v(" does not affect the "),s("code",[e._v("Error")]),e._v(" constructor's safety.\nAfter calling "),s("code",[e._v("lockdown")]),e._v(", the tamed "),s("code",[e._v("Error")]),e._v(" constructor in the\nstart compartment follows OCap rules. Under v8 it emulates most of the\nmagic powers of the v8 "),s("code",[e._v("Error")]),e._v(" constructorâ€”those consistent with the\ndiscourse level of the proposed "),s("code",[e._v("getStack")]),e._v(". In all cases, the "),s("code",[e._v("Error")]),e._v("\nconstructor shared by all other compartments is both safe and powerless.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// errorTaming defaults to 'safe'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" errorTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'safe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Deny unprivileged access to stacks, if possible")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" errorTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'unsafe'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Stacks also available by errorInstance.stack")]),e._v("\n")])])]),s("h3",{attrs:{id:"stackfiltering-options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stackfiltering-options"}},[e._v("#")]),e._v(" "),s("code",[e._v("stackFiltering")]),e._v(" Options")]),e._v(" "),s("p",[s("code",[e._v("stackFiltering")]),e._v(" trades off stronger stack traceback filtering to\nminimize distractions vs completeness for tracking down bugs in\nobscure places.")]),e._v(" "),s("p",[e._v("The default "),s("code",[e._v("'concise'")]),e._v(' setting removes "noise" from the full distributed\nstack traces, in particularly artifacts from low level infrastructure. It\nonly works on v8 engines.')]),e._v(" "),s("p",[e._v("With the "),s("code",[e._v("'verbose'")]),e._v(" setting, the "),s("code",[e._v("console")]),e._v(' displays the full raw stack\ninformation for each level of the "deep stack", tracing back through the\n'),s("a",{attrs:{href:"https://github.com/tc39/proposal-eventual-send",target:"_blank",rel:"noopener noreferrer"}},[e._v("eventually sent messages"),s("OutboundLink")],1),e._v("\nfrom other turns of the event loop. This makes JavaScript's already voluminous\nerror stacks even more so. However, this is sometimes useful for finding bugs\nin low level infrastructure.")]),e._v(" "),s("p",[e._v("Both settings are safe. Stack information will\nor will not be available from error objects according to the "),s("code",[e._v("errorTaming")]),e._v("\noption and the platform error behavior.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// stackFiltering defaults to 'concise'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" stackFiltering"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'concise'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Preserve important deep stack info")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" stackFiltering"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'verbose'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Console shows full deep stacks")]),e._v("\n")])])]),s("h3",{attrs:{id:"overridetaming-options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#overridetaming-options"}},[e._v("#")]),e._v(" "),s("code",[e._v("overrideTaming")]),e._v(" Options")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("overrideTaming")]),e._v(" option trades off better code\ncompatibility vs better tool compatibility.")]),e._v(" "),s("p",[e._v("When starting a project, we recommend using the non-default "),s("code",[e._v("'min'")]),e._v(" option to make\ndebugging more pleasant. You may need to reset it to the "),s("code",[e._v("'moderate'")]),e._v(" default if\nthird-party shimming code interferes with "),s("code",[e._v("lockdown()")]),e._v(".")]),e._v(" "),s("p",[s("code",[e._v("'moderate'")]),e._v(" option is intended to be fairly minimal. Expand it when you\nencounter code which should run under SES but can't due to\nthe "),s("a",{attrs:{href:"https://web.archive.org/web/20141230041441/http://wiki.ecmascript.org/doku.php?id=strawman:fixing_override_mistake",target:"_blank",rel:"noopener noreferrer"}},[e._v("override mistake"),s("OutboundLink")],1),e._v(",")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("'min'")]),e._v(" setting serves two purposes:")]),e._v(" "),s("ul",[s("li",[e._v("It enables a pleasant VSCode debugging experience.")]),e._v(" "),s("li",[e._v("It helps ensure new code does not depend on anything more than enabled legacy code.")])]),e._v(" "),s("p",[e._v("All Agoric-authored code is compatible with both settings, but\nAgoric currently still pulls in some third party dependencies only compatible\nwith the "),s("code",[e._v("'moderate'")]),e._v(" setting.")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// overrideTaming defaults to 'moderate'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// or")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" overrideTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'moderate'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Moderate mitigations for legacy compat")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("lockdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" overrideTaming"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'min'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Minimal mitigations for purely modern code")]),e._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);