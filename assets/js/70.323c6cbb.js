(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{474:function(t,e,s){"use strict";s.r(e);var a=s(44),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"zoehelpers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zoehelpers"}},[t._v("#")]),t._v(" ZoeHelpers")]),t._v(" "),s("p",[t._v("ZoeHelpers are functions that extract common contract code and\npatterns into reusable helpers.")]),t._v(" "),s("p",[t._v("All of the ZoeHelper methods are described below. To use any of them, import\nit directly from "),s("code",[t._v("@agoric/zoe/src/contractSupport/")]),t._v(". For example, the following\nimports the two ZoeHelpers "),s("code",[t._v("assertIssuerKeywords()")]),t._v(" and "),s("code",[t._v("assertProposalShape()")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  assertIssuerKeywords"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  assertProposalShape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Note that almost all ZoeHelpers require "),s("code",[t._v("zcf")]),t._v(", a "),s("code",[t._v("ContractFacet")]),t._v(" as a first argument.\nZoeHelpers are contract helpers, in that they are useful to contract code. Contracts are started up by Zoe,\nand "),s("code",[t._v("zcf")]),t._v(" is passed in as a parameter to "),s("code",[t._v("start()")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"assertissuerkeywords-zcf-keywords"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#assertissuerkeywords-zcf-keywords"}},[t._v("#")]),t._v(" "),s("code",[t._v("assertIssuerKeywords(zcf, keywords)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("keywords")]),t._v(" "),s("code",[t._v("{Array <String>}")])])]),t._v(" "),s("p",[t._v("This method always takes "),s("code",[t._v("zcf")]),t._v(" as its first argument.")]),t._v(" "),s("p",[t._v("Checks that keywords submitted by the contract instance creator\nmatch what the contract expects. Throws if incorrect or if there are\nmissing or extra keywords. The keywords order is irrelevant.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  assertIssuerKeywords"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// proposals for this contract instance use keywords 'Asset' and 'Price'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertIssuerKeywords")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asset'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Price'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"assertnatassetkind-zcf-brand"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#assertnatassetkind-zcf-brand"}},[t._v("#")]),t._v(" "),s("code",[t._v("assertNatAssetKind(zcf, brand)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v("- "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("brand")]),t._v(" - "),s("code",[t._v("{Brand}")])])]),t._v(" "),s("p",[t._v("This method always takes "),s("code",[t._v("zcf")]),t._v(" as its first argument.")]),t._v(" "),s("p",[t._v("Assert that the "),s("code",[t._v("brand")]),t._v(" has the AssetKind.NAT\nThis means the corresponding "),s("code",[t._v("mint")]),t._v(" creates fungible assets.")]),t._v(" "),s("p",[t._v("If "),s("code",[t._v("false")]),t._v(" throws with message "),s("code",[t._v("brand must be AssetKind.NAT")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  assertNatAssetKind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertNatAssetKind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quatloosBrand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"satisfies-zcf-seat-update"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#satisfies-zcf-seat-update"}},[t._v("#")]),t._v(" "),s("code",[t._v("satisfies(zcf, seat, update)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v("- "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("seat")]),t._v(" - "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("update")]),t._v(" - "),s("code",[t._v("{AmountKeywordRecord}")])]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("{Boolean}")])])]),t._v(" "),s("p",[t._v("This method always takes "),s("code",[t._v("zcf")]),t._v(" as its first argument.")]),t._v(" "),s("p",[t._v("Returns "),s("code",[t._v("true")]),t._v(" if an update to a "),s("code",[t._v("seat")]),t._v("'s "),s("code",[t._v("currentAllocation")]),t._v(" satisfies its\n"),s("code",[t._v("proposal.want")]),t._v(". Note this is half of the offer safety check;\nit does not check if the allocation constitutes a refund.\nThe update is merged with "),s("code",[t._v("currentAllocation")]),t._v(" such that\n"),s("code",[t._v("update")]),t._v("'s values prevail if the keywords are the same. If they\nare not the same, the "),s("code",[t._v("keyword")]),t._v(" and "),s("code",[t._v("value")]),t._v(" is just added to the "),s("code",[t._v("currentAllocation")]),t._v(".")]),t._v(" "),s("p",[t._v("The following example code uses "),s("code",[t._v("satisfies()")]),t._v(" to define a "),s("code",[t._v("satisfiedBy()")]),t._v(" comparison\nmethod between two "),s("code",[t._v("seats")]),t._v(". It checks if the second "),s("code",[t._v("seat")]),t._v(" argument's "),s("code",[t._v("currentAllocation")]),t._v("\nsatisfies the first "),s("code",[t._v("seat")]),t._v(" argument's "),s("code",[t._v("proposal.want")]),t._v(".")]),t._v(" "),s("p",[t._v("It then calls "),s("code",[t._v("satisfiedBy()")]),t._v(" on both orders of the two "),s("code",[t._v("seats")]),t._v(". If both satisfy each other,\nit does a swap on them.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  satisfies"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("satisfiedBy")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("xSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ySeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("satisfies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ySeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentAllocation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("satisfiedBy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" seat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("satisfiedBy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("seat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" seat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"trade-zcf-left-right-lefthasexitedmsg-righthasexitedmsg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#trade-zcf-left-right-lefthasexitedmsg-righthasexitedmsg"}},[t._v("#")]),t._v(" "),s("code",[t._v("trade(zcf, left, right, leftHasExitedMsg, rightHasExitedMsg)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" - "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("left")]),t._v(" - "),s("code",[t._v("{SeatGainsLossesRecord}")])]),t._v(" "),s("li",[s("code",[t._v("right")]),t._v(" - "),s("code",[t._v("{SeatGainsLossesRecord}")])]),t._v(" "),s("li",[s("code",[t._v("leftHasExitedMsg")]),t._v(" - "),s("code",[t._v("{String}")]),t._v(" - Optional")]),t._v(" "),s("li",[s("code",[t._v("rightHasExitedMsg")]),t._v(" - "),s("code",[t._v("{String}")]),t._v(" - Optional")]),t._v(" "),s("li",[t._v("Returns: void")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("SeatGainsLossesRecord")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("seat")]),t._v(" - "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("gains")]),t._v(" - "),s("code",[t._v("{AmountKeywordRecord}")]),t._v("  - what the seat will\ngain as a result of this trade")]),t._v(" "),s("li",[s("code",[t._v("losses")]),t._v(" - "),s("code",[t._v("{AmountKeywordRecord=}")]),t._v("  - what the seat will give up\nas a result of this trade. Losses is optional, but can only be\nomitted if the keywords for both seats are the same. If losses is\nnot defined, the gains of the other seat is subtracted.")])])]),t._v(" "),s("p",[s("strong",[t._v("Note")]),t._v(": The "),s("code",[t._v("swap()")]),t._v(" method is a specific use of "),s("code",[t._v("trade()")]),t._v(". In "),s("code",[t._v("swap()")]),t._v(",\nfor both "),s("code",[t._v("seats")]),t._v(", everything a "),s("code",[t._v("seat")]),t._v(" wants is given to it, having been\ntaken from the other "),s("code",[t._v("seat")]),t._v(". "),s("code",[t._v("swap()")]),t._v(" exits both "),s("code",[t._v("seats")]),t._v(", but "),s("code",[t._v("trade()")]),t._v(" does not.")]),t._v(" "),s("ul",[s("li",[t._v("Use "),s("code",[t._v("trade()")]),t._v(" when any of these are true:\n"),s("ul",[s("li",[t._v("The "),s("code",[t._v("seats")]),t._v(" have different keywords.")]),t._v(" "),s("li",[t._v("The "),s("code",[t._v("amounts")]),t._v(" to be reallocated don't exactly match the wants of the "),s("code",[t._v("seats")]),t._v(".")]),t._v(" "),s("li",[t._v("You want to continue to interact with the "),s("code",[t._v("seats")]),t._v(" after the trade.")])])]),t._v(" "),s("li",[t._v("Use "),s("code",[t._v("swap()")]),t._v(" when all of these are true:\n"),s("ul",[s("li",[t._v("Both "),s("code",[t._v("seats")]),t._v(" use the same keywords.")]),t._v(" "),s("li",[t._v("The "),s("code",[t._v("seats")]),t._v("' wants can be fulfilled from the other "),s("code",[t._v("seat")]),t._v(".")]),t._v(" "),s("li",[t._v("No further "),s("code",[t._v("seat")]),t._v(" interaction is desired.")])])])]),t._v(" "),s("p",[t._v("This method always takes "),s("code",[t._v("zcf")]),t._v(" as its first argument.")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("left")]),t._v(" and "),s("code",[t._v("right")]),t._v(" arguments are each "),s("code",[t._v("SeatGainsLossesRecords")]),t._v("\nwith "),s("code",[t._v("seat")]),t._v(", "),s("code",[t._v("gains")]),t._v(", and optional "),s("code",[t._v("losses")]),t._v(" properties. "),s("code",[t._v("gains")]),t._v(" and\n"),s("code",[t._v("losses")]),t._v(" are "),s("code",[t._v("amountKeywordRecords")]),t._v(" describing declaratively what is\nadded or removed from that "),s("code",[t._v("seat")]),t._v("'s allocation.")]),t._v(" "),s("p",[s("code",[t._v("trade()")]),t._v(" does a trade between the "),s("code",[t._v("seats")]),t._v(" in "),s("code",[t._v("left")]),t._v(" and "),s("code",[t._v("right")]),t._v(". If the two "),s("code",[t._v("seats")]),t._v(" can trade,\nit swaps their compatible assets.")]),t._v(" "),s("p",[t._v("Any surplus remains with its original "),s("code",[t._v("seat")]),t._v(". For example if "),s("code",[t._v("seat")]),t._v("\nA gives 5 Quatloos and "),s("code",[t._v("seat")]),t._v(" B only wants 3 Quatloos, "),s("code",[t._v("seat")]),t._v(" A retains 2 Quatloos.")]),t._v(" "),s("p",[t._v("If either of the seats has exited, "),s("code",[t._v("trade")]),t._v(" throws. "),s("code",[t._v("trade")]),t._v(" itself does NOT\n"),s("code",[t._v("fail")]),t._v(" or "),s("code",[t._v("exit")]),t._v(" either seat for any reason.")]),t._v(" "),s("p",[t._v("If the trade fails for reasons other than either seat exiting, it\nthrows the message "),s("code",[t._v("The trade between left and right failed. Please check the log for more information")]),t._v(". It writes the specific error to\nthe console.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  trade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trade")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        seat"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" poolSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        gains"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Central"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amountIn "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        losses"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Secondary"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amountOut "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        seat"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" swapSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        gains"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Out"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amountOut "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        losses"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" In"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amountIn "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"swap-zcf-leftseat-rightseat-lefthasexitedmsg-righthasexitedmsg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swap-zcf-leftseat-rightseat-lefthasexitedmsg-righthasexitedmsg"}},[t._v("#")]),t._v(" "),s("code",[t._v("swap(zcf, leftSeat, rightSeat, leftHasExitedMsg, rightHasExitedMsg)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("leftSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("rightSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("leftHasExitedMsg")]),t._v(" - "),s("code",[t._v("{String}")]),t._v(" - Optional")]),t._v(" "),s("li",[s("code",[t._v("rightHasExitedMsg")]),t._v(" - "),s("code",[t._v("{String}")]),t._v(" - Optional")]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("defaultAcceptanceMsg")])])]),t._v(" "),s("p",[s("strong",[t._v("Note")]),t._v(": The "),s("code",[t._v("swap()")]),t._v(" method is a specific use of "),s("code",[t._v("trade()")]),t._v(". In "),s("code",[t._v("swap(),")]),t._v("\nfor both "),s("code",[t._v("seats")]),t._v(", everything a "),s("code",[t._v("seat")]),t._v(" wants is given to it, having been\ntaken from the other "),s("code",[t._v("seat")]),t._v(". "),s("code",[t._v("swap()")]),t._v(" exits both "),s("code",[t._v("seats")]),t._v(", but "),s("code",[t._v("trade()")]),t._v(" does not.")]),t._v(" "),s("ul",[s("li",[t._v("Use "),s("code",[t._v("trade()")]),t._v(" when any of these are true:\n"),s("ul",[s("li",[t._v("The "),s("code",[t._v("seats")]),t._v(" have different keywords.")]),t._v(" "),s("li",[t._v("The "),s("code",[t._v("amounts")]),t._v(" to be reallocated don't exactly match the wants of the "),s("code",[t._v("seats")]),t._v(".")]),t._v(" "),s("li",[t._v("You want to continue interacting with the "),s("code",[t._v("seats")]),t._v(" after the trade.")])])]),t._v(" "),s("li",[t._v("Use "),s("code",[t._v("swap()")]),t._v(" when all of these are true:\n"),s("ul",[s("li",[t._v("Both "),s("code",[t._v("seats")]),t._v(" use the same keywords.")]),t._v(" "),s("li",[t._v("The "),s("code",[t._v("seats")]),t._v("' wants can be fulfilled from the other "),s("code",[t._v("seat")]),t._v(".")]),t._v(" "),s("li",[t._v("No further "),s("code",[t._v("seat")]),t._v(" interaction is desired.")])])])]),t._v(" "),s("p",[t._v("This method always takes "),s("code",[t._v("zcf")]),t._v(" as its first argument.")]),t._v(" "),s("p",[s("code",[t._v("leftHasExitedMsg")]),t._v(" and "),s("code",[t._v("rightHasExitedMsg")]),t._v(" are optional and are passed\nto "),s("code",[t._v("trade")]),t._v(" within "),s("code",[t._v("swap")]),t._v(" to add custom error messages in the case that\neither seat has exited.")]),t._v(" "),s("p",[t._v("If the two "),s("code",[t._v("seats")]),t._v(" can trade, then swap their compatible assets,\nexiting both "),s("code",[t._v("seats")]),t._v(". It returns the message "),s("code",[t._v("The offer has been accepted. Once the contract has been completed, please check your payout")]),t._v(".")]),t._v(" "),s("p",[t._v("Any surplus remains with whichever "),s("code",[t._v("seat")]),t._v(" has the surplus.\nFor example if "),s("code",[t._v("seat")]),t._v(" A gives 5 Quatloos and "),s("code",[t._v("seat")]),t._v(" B only\nwants 3 Quatloos, "),s("code",[t._v("seat")]),t._v(" A retains 2 Quatloos.")]),t._v(" "),s("p",[t._v("If the swap fails, no assets transfer, and both left and right "),s("code",[t._v("seats")]),t._v(" are exited.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  swap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" firstSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secondSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"swapexact-zcf-leftseat-rightseat-lefthasexitedmsg-righthasexitedmsg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swapexact-zcf-leftseat-rightseat-lefthasexitedmsg-righthasexitedmsg"}},[t._v("#")]),t._v(" "),s("code",[t._v("swapExact(zcf, leftSeat, rightSeat, leftHasExitedMsg, rightHasExitedMsg)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("leftSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("rightSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("leftHasExitedMsg")]),t._v(" - "),s("code",[t._v("{String}")]),t._v(" - Optional")]),t._v(" "),s("li",[s("code",[t._v("rightHasExitedMsg")]),t._v(" - "),s("code",[t._v("{String}")]),t._v(" - Optional")]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("defaultAcceptanceMsg")])])]),t._v(" "),s("p",[s("strong",[t._v("Note")]),t._v(": "),s("code",[t._v("swapExact()")]),t._v(" and "),s("code",[t._v("swap()")]),t._v(" are specific uses of "),s("code",[t._v("trade()")]),t._v(". In "),s("code",[t._v("swap()")]),t._v(" and "),s("code",[t._v("swapExact()")]),t._v(",\nfor both seats, everything a seat wants is given to it, having been\ntaken from the other seat. "),s("code",[t._v("swap()")]),t._v(" and "),s("code",[t._v("swapExact()")]),t._v(" exit both seats, but "),s("code",[t._v("trade()")]),t._v(" does not.")]),t._v(" "),s("ul",[s("li",[t._v("Use "),s("code",[t._v("trade()")]),t._v(" when any of these are true:\n"),s("ul",[s("li",[t._v("The "),s("code",[t._v("seats")]),t._v(" have different keywords.")]),t._v(" "),s("li",[t._v("The "),s("code",[t._v("amounts")]),t._v(" to be reallocated don't exactly match the wants of the "),s("code",[t._v("seats")]),t._v(".")]),t._v(" "),s("li",[t._v("You want to continue interacting with the "),s("code",[t._v("seats")]),t._v(" after the trade.")])])]),t._v(" "),s("li",[t._v("Use "),s("code",[t._v("swap()")]),t._v(" or "),s("code",[t._v("swapExact()")]),t._v(" when all of these are true:\n"),s("ul",[s("li",[t._v("Both "),s("code",[t._v("seats")]),t._v(" use the same keywords.")]),t._v(" "),s("li",[t._v("The "),s("code",[t._v("seats")]),t._v("' wants can be fulfilled from the other "),s("code",[t._v("seat")]),t._v(".")]),t._v(" "),s("li",[t._v("No further "),s("code",[t._v("seat")]),t._v(" interaction is desired.")])])])]),t._v(" "),s("p",[t._v("This method always takes "),s("code",[t._v("zcf")]),t._v(" as its first argument.")]),t._v(" "),s("p",[s("code",[t._v("leftHasExitedMsg")]),t._v(" and "),s("code",[t._v("rightHasExitedMsg")]),t._v(" are optional and are passed\nto "),s("code",[t._v("trade()")]),t._v(" within "),s("code",[t._v("swapExact()")]),t._v(" to add custom error messages in the case that\neither seat has exited. They default to "),s("code",[t._v("the left seat in swapExact() has exited")]),t._v(",\nand "),s("code",[t._v("the right seat in swapExact() has exited")]),t._v(" respectively.")]),t._v(" "),s("p",[s("code",[t._v("exactSwap()")]),t._v(" is a special case of "),s("code",[t._v("swap()")]),t._v(" such that it is successful only\nif both seats gain everything they want and lose everything they were willing to give.\nIt is only good for exact and entire swaps where each\nseat wants everything that the other seat has. The benefit of using\nthis method is that the keywords of each seat do not matter.")]),t._v(" "),s("p",[t._v("If the two "),s("code",[t._v("seats")]),t._v(" can trade, then swap their compatible assets,\nexiting both "),s("code",[t._v("seats")]),t._v(". It returns the message "),s("code",[t._v("The offer has been accepted. Once the contract has been completed, please check your payout")]),t._v(".")]),t._v(" "),s("p",[t._v("If the swap fails, no assets transfer, and both left and right "),s("code",[t._v("seats")]),t._v(" are exited.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  swapExact"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" swapMsg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swapExact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zcfSeatA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zcfSeatB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"assertproposalshape-seat-expected"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#assertproposalshape-seat-expected"}},[t._v("#")]),t._v(" "),s("code",[t._v("assertProposalShape(seat, expected)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("seat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("expected")]),t._v(" "),s("code",[t._v("{ExpectedRecord}")])]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("{void}")])])]),t._v(" "),s("p",[t._v("This is the only ZoeHelper that does "),s("strong",[t._v("not")]),t._v(" take 'zcf' as its first argument.")]),t._v(" "),s("p",[t._v("Check the seat's proposal against an "),s("code",[t._v("expected")]),t._v(" record that says\nwhat shape of proposal is acceptable.")]),t._v(" "),s("p",[t._v('By "shape", we mean the '),s("code",[t._v("give")]),t._v(", "),s("code",[t._v("want")]),t._v(", and exit rule keywords of the proposal must be equal to\nthose in "),s("code",[t._v("expected")]),t._v(". Note that exit rule keywords are optional in "),s("code",[t._v("expected")]),t._v(". Also, none of the\nvalues of those keywords are checked.")]),t._v(" "),s("p",[t._v("This "),s("code",[t._v("ExpectedRecord")]),t._v(" is like a "),s("code",[t._v("Proposal")]),t._v(", but the amounts in "),s("code",[t._v("want")]),t._v("\nand "),s("code",[t._v("give")]),t._v(" should be "),s("code",[t._v("null")]),t._v("; the "),s("code",[t._v("exit")]),t._v(" clause should specify a rule with\n"),s("code",[t._v("null")]),t._v(" contents. If the client submits a "),s("code",[t._v("Proposal")]),t._v(" which does not match\nthese expectations, that "),s("code",[t._v("proposal")]),t._v(" is rejected (and refunded).")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  assertProposalShape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sellAssetForPrice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    give"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Asset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    want"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Price"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("sell")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("seat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertProposalShape")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("seat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sellAssetForPrice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  buySeats "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swapIfCanTradeAndUpdateBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buySeats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sellSeats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" seat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Trade Successful'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"deposittoseat-zcf-recipientseat-amounts-payments"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deposittoseat-zcf-recipientseat-amounts-payments"}},[t._v("#")]),t._v(" "),s("code",[t._v("depositToSeat(zcf, recipientSeat, amounts, payments)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet }")])]),t._v(" "),s("li",[s("code",[t._v("recipientSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("amounts")]),t._v(" "),s("code",[t._v("{AmountKeywordRecord}")])]),t._v(" "),s("li",[s("code",[t._v("payments")]),t._v(" "),s("code",[t._v("{PaymentPKeywordRecord}")])]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("{Promise<string>}")]),t._v("\nDeposit payments such that their amounts are reallocated to a seat.\nThe "),s("code",[t._v("amounts")]),t._v(" and "),s("code",[t._v("payments")]),t._v(" records must have corresponding\nkeywords.")])]),t._v(" "),s("p",[t._v("If the seat has exited, aborts with the message "),s("code",[t._v("The recipientSeat cannot have exited.")])]),t._v(" "),s("p",[t._v("On success, returns the exported and settable "),s("code",[t._v("depositToSeatSuccessMsg")]),t._v(" which\ndefaults to "),s("code",[t._v("Deposit and reallocation successful.")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  depositToSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("depositToSeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zcfSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Dep"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("quatloos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2n")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Dep"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" quatloosPayment "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"withdrawfromseat-zcf-seat-amounts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#withdrawfromseat-zcf-seat-amounts"}},[t._v("#")]),t._v(" "),s("code",[t._v("withdrawFromSeat(zcf, seat, amounts)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet }")])]),t._v(" "),s("li",[s("code",[t._v("seat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("amounts")]),t._v(" "),s("code",[t._v("{AmountKeywordRecord}")])]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("{Promise<PaymentPKeywordRecord>}")])])]),t._v(" "),s("p",[t._v("Withdraw payments from a seat. Note that withdrawing the amounts of\nthe payments must not and cannot violate offer safety for the seat. The\n"),s("code",[t._v("amounts")]),t._v(" and "),s("code",[t._v("payments")]),t._v(" records must have corresponding keywords.")]),t._v(" "),s("p",[t._v("If the seat has exited, aborts with the message "),s("code",[t._v("The seat cannot have exited.")])]),t._v(" "),s("p",[t._v("Unlike "),s("code",[t._v("depositToSeat()")]),t._v(", a "),s("code",[t._v("PaymentKeywordRecord")]),t._v(" is returned, not a success message.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  withdrawFromSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" paymentKeywordRecord "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("withdrawFromSeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zcfSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" With"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("quatloos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2n")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"saveallissuers-zcf-issuerkeywordrecord"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#saveallissuers-zcf-issuerkeywordrecord"}},[t._v("#")]),t._v(" "),s("code",[t._v("saveAllIssuers(zcf, issuerKeywordRecord)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("issuerKeywordRecord")]),t._v(" "),s("code",[t._v("{IssuerKeywordRecord}")])]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("{Promise<PaymentPKeywordRecord>}")])])]),t._v(" "),s("p",[t._v("Save all of the issuers in an "),s("code",[t._v("issuersKeywordRecord")]),t._v(" to ZCF, using\nthe method "),s("RouterLink",{attrs:{to:"/zoe/api/zoe-contract-facet.html#zcf-saveissuer-issuer-keyword"}},[s("code",[t._v("zcf.saveIssuer()")])]),t._v(".")],1),t._v(" "),s("p",[t._v("This does "),s("strong",[t._v("not")]),t._v(" error if any of the keywords already exist. If the keyword is\nalready present, it is ignored.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  saveAllIssuers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/zoe/src/contractSupport'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveAllIssuers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("G")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" gIssuer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" dIssuer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("P")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" pIssuer "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"offerto-zcf-invitation-keywordmapping-proposal-fromseat-toseat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#offerto-zcf-invitation-keywordmapping-proposal-fromseat-toseat"}},[t._v("#")]),t._v(" "),s("code",[t._v("offerTo(zcf, invitation, keywordMapping, proposal, fromSeat, toSeat)")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("zcf")]),t._v(" "),s("code",[t._v("{ContractFacet}")])]),t._v(" "),s("li",[s("code",[t._v("invitation")]),t._v(" "),s("code",[t._v("{ERef<Invitation>}")])]),t._v(" "),s("li",[s("code",[t._v("keywordMapping")]),t._v(" "),s("code",[t._v("{KeywordKeywordRecord=}")])]),t._v(" "),s("li",[s("code",[t._v("proposal")]),t._v(" "),s("code",[t._v("{Proposal}")])]),t._v(" "),s("li",[s("code",[t._v("fromSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[s("code",[t._v("toSeat")]),t._v(" "),s("code",[t._v("{ZCFSeat}")])]),t._v(" "),s("li",[t._v("Returns: "),s("code",[t._v("{OfferToReturns}")])])]),t._v(" "),s("p",[s("code",[t._v("offerTo()")]),t._v(' makes an offer from your current contract instance (which\nwe\'ll call "contractA") to another contract instance (which we\'ll call\n"contractB"). It withdraws offer payments from the '),s("code",[t._v("fromSeat")]),t._v(" in\ncontractA and deposits any payouts in the "),s("code",[t._v("toSeat")]),t._v(", also a contractA\nseat. Note that "),s("code",[t._v("fromSeat")]),t._v(" and "),s("code",[t._v("toSeat")]),t._v(" may be the same seat, which is\nthe default condition (i.e. "),s("code",[t._v("toSeat")]),t._v(" is an optional parameter\ndefaulting to "),s("code",[t._v("fromSeat")]),t._v("'s value). "),s("code",[t._v("offerTo")]),t._v(" can be used to make an\noffer from any contract instance to any other contract instance, as\nlong as the "),s("code",[t._v("fromSeat")]),t._v(" allows the withdrawal without violating\noffer-safety. To be clear, this does mean that contractA and contractB\ndo not have to be instances of the same contract.")]),t._v(" "),s("p",[s("code",[t._v("zcf")]),t._v(" is contractA's Zoe contract facet. The "),s("code",[t._v("invitation")]),t._v(" parameter is an invitation\nto contractB. The "),s("code",[t._v("proposal")]),t._v(" parameter is the proposal part of the offer made to contractB.")]),t._v(" "),s("p",[s("code",[t._v("keywordMapping")]),t._v(' is a record of the keywords used in contractA mapped to the\nkeywords for contractB. Note that the pathway to deposit the payout back to\ncontractA reverses this mapping. It looks like this, where the keywords are\nfrom the contracts indicated by using "A" or "B" in the keyword name.')]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Map the keywords in contractA to the keywords in contractB")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" keywordMapping "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    TokenA1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TokenB1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    TokenA2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TokenB2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("The "),s("code",[t._v("OfferToReturns")]),t._v(" return value is a promise for an object containing\nthe "),s("code",[t._v("userSeat")]),t._v(" for the offer to the other contract, and a promise ("),s("code",[t._v("deposited")]),t._v(")\nthat resolves when the payout for the offer has been deposited to the "),s("code",[t._v("toSeat")]),t._v(".\nIts two properties are:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("userSeatPromise")]),t._v(": "),s("code",[t._v("Promise<UserSeat>")])]),t._v(" "),s("li",[s("code",[t._v("deposited")]),t._v(": "),s("code",[t._v("Promise<AmountKeywordRecord>")])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" userSeatPromise"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" autoswapUserSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deposited "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("offerTo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   swapInvitation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   keywordMapping"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {}")]),t._v("\n   proposal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   fromSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   lenderSeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);