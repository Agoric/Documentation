(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{463:function(t,a,e){"use strict";e.r(a);var s=e(44),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"zoe-offer-safety-enforcement"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zoe-offer-safety-enforcement"}},[t._v("#")]),t._v(" Zoe: Offer-Safety Enforcement")]),t._v(" "),e("Zoe-Version"),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Beta status")]),t._v(" "),e("p",[t._v("The Agoric platform is at the beta stage. It has not yet been formally tested\nor hardened. Do not use for production purposes.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Work in Progress: Fees and Metering")]),t._v(" "),e("p",[t._v("We recently started\ncharging fees for using Zoe. If you are experiencing problems running\ndapps, please make sure your fee purse has enough RUN to pay fees. For\nmore information about how fees are charged and how some fees are used\nto pay for code execution, please see our "),e("RouterLink",{attrs:{to:"/zoe/api/fees-and-metering.html"}},[t._v("work-in-progress\ndocumentation")]),t._v(". We expect that this model will change in the upcoming\nfew months.")],1)]),t._v(" "),e("p",[t._v("This guide assumes some knowledge of the "),e("RouterLink",{attrs:{to:"/ertp/guide/"}},[t._v("ERTP\nfundamentals")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"what-is-zoe"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-is-zoe"}},[t._v("#")]),t._v(" What is Zoe?")]),t._v(" "),e("p",[e("strong",[t._v("For users")]),t._v(": Zoe guarantees that as a user of a smart contract, you\nwill either get what you wanted or get a full refund, even if the\nsmart contract is buggy or malicious. (In fact, the smart contract\nnever has access to your digital assets.)")]),t._v(" "),e("p",[e("strong",[t._v("For developers")]),t._v(": Zoe provides a safety net so you can focus on what\nyour smart contract does best, without worrying about your users\nlosing their assets due to a bug in the code that you wrote. Writing a\nsmart contract on Zoe is easy: all of the Zoe smart contracts are\nwritten in the familiar language of JavaScript.")]),t._v(" "),e("h2",{attrs:{id:"sounds-like-magic-how-does-it-actually-work"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sounds-like-magic-how-does-it-actually-work"}},[t._v("#")]),t._v(" Sounds like magic. How does it actually work?")]),t._v(" "),e("p",[t._v('To use Zoe, we put things in terms of "offers". An offer proposal is a\nstatement about what you want and what you\'re willing to offer. It\nturns out, many smart contracts (apart from gifts and one-way\npayments) involve an exchange of digital assets that can be put in\nterms of offer proposals. We\ncan say things like, "I\'ll give you '),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Catan",target:"_blank",rel:"noopener noreferrer"}},[t._v("three wool for two\nbricks"),e("OutboundLink")],1),t._v('." '),e("RouterLink",{attrs:{to:"/zoe/guide/proposal.html"}},[t._v("Learn more about the\nparticulars of structuring an offer proposal here")]),t._v(".")],1),t._v(" "),e("p",[t._v("Offers are a structured way of describing user intent. To a certain\nextent, an offer's rules (called a "),e("em",[t._v("proposal")]),t._v(") are the user's\n"),e("em",[t._v("contractual understanding")]),t._v(" of the agreement they are entering into.")]),t._v(" "),e("p",[t._v("You might have noticed that the offer doesn't specify the mechanism by\nwhich the exchange happens. The offer doesn't say whether the item you\nwant is up for auction, in an exchange, or part of a private trade.\nThe offer doesn't mention the particular mechanism because an\nimportant part of the design of Zoe is a "),e("strong",[t._v("separation of concerns")]),t._v(".")]),t._v(" "),e("p",[t._v('Zoe is responsible for enforcing what we call "offer safety", and the\nsmart contract that runs on top of Zoe is responsible for figuring out\na proposed reallocation of resources. To use an auction as an example,\nthe smart contract is responsible for figuring out who wins the\nauction and how much they pay, but Zoe handles the escrowing of the\nbids and the payments. You can think of this as similar to e-commerce\nwebsites using a separate payment-processor so that they don\'t have to\nhandle the credit cards themselves.')]),t._v(" "),e("h3",{attrs:{id:"what-is-offer-safety"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-is-offer-safety"}},[t._v("#")]),t._v(' What is "offer safety"?')]),t._v(" "),e("p",[t._v("Zoe guarantees offer safety, meaning that when a user makes an offer\nand it is escrowed with Zoe, Zoe guarantees that the user either\ngets back what they said they wanted, or gets back (refunded) what they\noriginally offered and escrowed.")]),t._v(" "),e("p",[t._v("When a user escrows with Zoe, they get back\na JavaScript promise for a future payout. Let's\nlook a particular example to see how this works.")]),t._v(" "),e("h2",{attrs:{id:"an-example-a-swap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#an-example-a-swap"}},[t._v("#")]),t._v(" An example: A swap")]),t._v(" "),e("p",[t._v("I want to trade my three bricks for five wool. You realize you have\nfive wool and agree to the deal. Without Zoe, you might send\nme the five wool, and I might disappear without ever giving you the\nthree bricks. With Zoe, we can safely trade with each other,\neven if we don't trust each other. We are assured that at worst, if\nthe swap contract behaves badly, we both get a refund, and at\nbest, we get what we each wanted.")]),t._v(" "),e("p",[t._v("Let's look at the basic "),e("code",[t._v("atomicSwap")]),t._v(" contract ("),e("a",{attrs:{href:"https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/atomicSwap.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("full text of\nthe real contract"),e("OutboundLink")],1),t._v(").")]),t._v(" "),e("p",[t._v("Here's a high-level overview of what happens:")]),t._v(" "),e("ol",[e("li",[t._v("I make an instance of the swap contract, and get an invitation to\nparticipate in the contract.")]),t._v(" "),e("li",[t._v("I make an offer through Zoe by presenting my invitation, a proposal\nof 3 bricks for 5 wool, and a payment with the 3 bricks. Zoe escrows\nthe bricks and returns me a seat (a "),e("code",[t._v("UserSeat")]),t._v(" to be precise) in the\ncontract, from which I can get the results of my offer, the payouts, etc.")]),t._v(" "),e("li",[t._v("The result of processing my offer is an invitation for my counterparty.\nI send you that invitation to participate in this contract instance.")]),t._v(" "),e("li",[t._v("You inspect the invitation and verify it was created by the\n"),e("code",[t._v("atomicSwap")]),t._v(" contract code.")]),t._v(" "),e("li",[t._v("You use your invitation to make your offer (offering five wool for\nthree bricks) with Zoe, making a matching offer. You get your own seat\nto with which to access your payout and offer results.")]),t._v(" "),e("li",[t._v("The contract confirms that our offers match, and reallocates our bricks\nand wool and exits our offers. That will resolve our respective payout\npromises, mine to the five wool that I wanted, and yours to the three\nbricks that you wanted. Success!")])]),t._v(" "),e("h2",{attrs:{id:"how-to-write-smart-contracts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-write-smart-contracts"}},[t._v("#")]),t._v(" How to write smart contracts")]),t._v(" "),e("p",[t._v("Writing smart contracts that run on Zoe is easy. Let's look\nat a simple contract. It only does one thing, and\nit's pretty useless - it gives you back what you put in. Let's call it\n"),e("code",[t._v("automaticRefund")]),t._v(". Let's say the code of "),e("code",[t._v("automaticRefund")]),t._v(" looks like\nthis (see the "),e("a",{attrs:{href:"https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/automaticRefund.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("real contract code\nhere"),e("OutboundLink")],1),t._v("):")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("start")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("zcf")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("refund")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("seat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    seat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("The offer was accepted")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("makeRefundInvitation")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" zcf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeInvitation")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("refund"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'getRefund'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" publicFacet "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    makeInvitation"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" makeRefundInvitation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" creatorInvitation "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeRefundInvitation")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" creatorInvitation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" publicFacet "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("(In a real contract, whenever we create a new object or array, we recursively\nfreeze it with "),e("code",[t._v("harden")]),t._v(". You can learn more about "),e("code",[t._v("harden")]),t._v(" in the\n"),e("a",{attrs:{href:"https://github.com/endojs/endo/blob/master/packages/ses/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hardened JavaScript SES shim package\ndocumentation"),e("OutboundLink")],1),t._v(".)")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("automaticRefund")]),t._v(" contract behavior is implemented in "),e("code",[t._v("refund")]),t._v(".\nIt just tells Zoe to exit the offer, which gives the user their payout\nthrough Zoe.")]),t._v(" "),e("p",[t._v("A smart contract on Zoe must export a function named "),e("code",[t._v("start")]),t._v(" that\ntakes a single parameter: "),e("code",[t._v("zcf")]),t._v(", which is the contract-internal API\nfor Zoe. The "),e("code",[t._v("start")]),t._v(" function must return an object with any of\nseveral optional properties:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("creatorInvitation")]),t._v(": an invitation only available to the creator of the contract instance.")]),t._v(" "),e("li",[e("code",[t._v("creatorFacet")]),t._v(": an object with operations made accessible only to the creator.")]),t._v(" "),e("li",[e("code",[t._v("publicFacet")]),t._v(": and object with operations available to any client with access to the instance.")])]),t._v(" "),e("h2",{attrs:{id:"diving-deeper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#diving-deeper"}},[t._v("#")]),t._v(" Diving Deeper")]),t._v(" "),e("p",[t._v("Let's dive back into the "),e("code",[t._v("atomicSwap")]),t._v(" contract. As with "),e("code",[t._v("automaticRefund")]),t._v(", see the "),e("a",{attrs:{href:"https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/atomicSwap.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("real contract code\nhere"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("p",[t._v("The contract first confirms that "),e("code",[t._v("issuers")]),t._v(" are setup for the "),e("code",[t._v("Asset")]),t._v(" and "),e("code",[t._v("Price")]),t._v(" keywords. Those are the two items that will be swapped.")]),t._v(" "),e("p",[t._v("The following uses the "),e("RouterLink",{attrs:{to:"/zoe/api/zoe-helpers.html#assertissuerkeywords-zcf-keywords"}},[e("code",[t._v("assertIssuerKeywords")]),t._v(" helper function")]),t._v(". It\nchecks properties of the running contract instance's terms. The terms were retrieved via "),e("code",[t._v("zcf.getTerms()")]),t._v("\nin the "),e("code",[t._v("automaticRefund")]),t._v(" contract.")],1),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("start")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("zcf")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertIssuerKeywords")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asset'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Price'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("The first handler defined below, "),e("code",[t._v("makeMatchingInvitation()")]),t._v(" is for the contract instance's creator, and it\nmakes the "),e("code",[t._v("invitation")]),t._v(" for the other party to use. At the end of this section, we'll see how it's incorporated into\nthe contract. When the associated "),e("code",[t._v("invitation")]),t._v(" is used to make an offer, "),e("code",[t._v("makeMatchingInvitation()")]),t._v(" is invoked\nwith the "),e("code",[t._v("seat")]),t._v(" for that offer.")]),t._v(" "),e("p",[t._v("This contract uses the\n"),e("RouterLink",{attrs:{to:"/zoe/api/zoe-helpers.html#assertproposalshape-seat-expected"}},[e("code",[t._v("assertProposalShape")]),t._v(" helper function")]),t._v(" to\ncheck that the offer proposes the kind of trade the contract accepts. In this case, offers must\nhave a proposal of the form:")],1),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" give"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Asset"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amount1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" want"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Price"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" amount2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("code",[t._v("amount1")]),t._v(" and "),e("code",[t._v("amount2")]),t._v(" are amounts with the correct issuers for the keywords.\nThe contract then uses "),e("code",[t._v("getProposal()")]),t._v(" to extract the properties of the proposal for later matching.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("makeMatchingInvitation")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("firstSeat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertProposalShape")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("firstSeat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      give"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Asset"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      want"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Price"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" want"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" give "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" firstSeat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProposal")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[e("code",[t._v("makeMatchingInvitation()")]),t._v(", our first handler, then constructs a handler for the second offer,\nwith the first offer's "),e("code",[t._v("want")]),t._v(" and "),e("code",[t._v("give")]),t._v(" in scope. This second\nhandler, "),e("code",[t._v("matchingSeatOfferHandler()")]),t._v(" does the final step.\nIt uses the "),e("RouterLink",{attrs:{to:"/zoe/api/zoe-helpers.html#swap-zcf-leftseat-rightseat"}},[e("code",[t._v("swap")]),t._v(" helper  function")]),t._v(",\na powerful Zoe Helper that handles a lot of the logic of doing a basic swap of assets.")],1),t._v(" "),e("p",[t._v("If the swap succeeds, it reallocates the assets between the parties, as described above. The handler then exits\nboth seats (causing payouts to be made available to both parties) and shuts down the contract.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("matchingSeatOfferHandler")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("matchingSeat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" swapResult "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("swap")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zcf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" firstSeat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" matchingSeat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      zcf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" swapResult"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("Now let's put it together. The last step of the first handler, "),e("code",[t._v("makeMatchingInvitation()")]),t._v("\nis to create and return the second party's invitation, using\n"),e("code",[t._v("matchingSeatOfferHandler")]),t._v(" and including custom properties for the proposal of the invited offer.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" matchingSeatInvitation "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeInvitation")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      matchingSeatOfferHandler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'matchOffer'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        asset"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" give"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Asset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        price"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" want"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Price"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" matchingSeatInvitation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("Finally, we make the invitation for the first party, and return it as\nthe contract's "),e("code",[t._v("creatorInvitation")]),t._v(".")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" creatorInvitation "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zcf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeInvitation")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    makeMatchingInvitation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'firstOffer'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" creatorInvitation "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("The "),e("code",[t._v("creatorInvitation")]),t._v(" is only available to the contract instance's creator.\n(see "),e("RouterLink",{attrs:{to:"/zoe/api/zoe.html#e-zoe-startinstance-installation-issuerkeywordrecord-terms"}},[e("code",[t._v("startInstance")])]),t._v(").\nThe creator can use it (by making an offer with it) or send it to some other party.")],1)],1)}),[],!1,null,null,null);a.default=n.exports}}]);