<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SES Guide | Beta</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/documentation/favicon-full.ico">
    <style type="text/css">
    .two-col-table td {
        width: 50%;
    }
    .two-col-table table {
        table-layout: fixed;
    }</style>
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-118217811-1"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-118217811-1'); </script>
    <script>
    const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://agoric.com");
      homeEl.setAttribute("onclick", "return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://agoric.com';return false;");
      clearInterval(logoUrlChanger);
    }
   }, 1000) </script>
    <meta name="description" content="Build, deploy and operate dApps and DeFi markets.">
    
    <link rel="preload" href="/documentation/assets/css/0.styles.3032228c.css" as="style"><link rel="preload" href="/documentation/assets/js/app.0bd16630.js" as="script"><link rel="preload" href="/documentation/assets/js/2.581bc00f.js" as="script"><link rel="preload" href="/documentation/assets/js/55.7e077254.js" as="script"><link rel="prefetch" href="/documentation/assets/js/10.d33116e2.js"><link rel="prefetch" href="/documentation/assets/js/11.5a655d5a.js"><link rel="prefetch" href="/documentation/assets/js/12.6724b569.js"><link rel="prefetch" href="/documentation/assets/js/13.a0bf1487.js"><link rel="prefetch" href="/documentation/assets/js/14.11dce8c6.js"><link rel="prefetch" href="/documentation/assets/js/15.7045f18e.js"><link rel="prefetch" href="/documentation/assets/js/16.bdf95412.js"><link rel="prefetch" href="/documentation/assets/js/17.1444a129.js"><link rel="prefetch" href="/documentation/assets/js/18.1b284903.js"><link rel="prefetch" href="/documentation/assets/js/19.c3c01e28.js"><link rel="prefetch" href="/documentation/assets/js/20.50ec122d.js"><link rel="prefetch" href="/documentation/assets/js/21.bbcb470d.js"><link rel="prefetch" href="/documentation/assets/js/22.0bb08ac2.js"><link rel="prefetch" href="/documentation/assets/js/23.8cd5cd72.js"><link rel="prefetch" href="/documentation/assets/js/24.04d6ec39.js"><link rel="prefetch" href="/documentation/assets/js/25.21f6a6bb.js"><link rel="prefetch" href="/documentation/assets/js/26.be3a2ec2.js"><link rel="prefetch" href="/documentation/assets/js/27.dea439dc.js"><link rel="prefetch" href="/documentation/assets/js/28.63a8b800.js"><link rel="prefetch" href="/documentation/assets/js/29.fb8d695b.js"><link rel="prefetch" href="/documentation/assets/js/3.1a031185.js"><link rel="prefetch" href="/documentation/assets/js/30.a8d1e3ca.js"><link rel="prefetch" href="/documentation/assets/js/31.003e1792.js"><link rel="prefetch" href="/documentation/assets/js/32.1ce71901.js"><link rel="prefetch" href="/documentation/assets/js/33.31597657.js"><link rel="prefetch" href="/documentation/assets/js/34.5907a4d8.js"><link rel="prefetch" href="/documentation/assets/js/35.629b1d28.js"><link rel="prefetch" href="/documentation/assets/js/36.4b56dd64.js"><link rel="prefetch" href="/documentation/assets/js/37.ad446959.js"><link rel="prefetch" href="/documentation/assets/js/38.e74a319f.js"><link rel="prefetch" href="/documentation/assets/js/39.74e426ad.js"><link rel="prefetch" href="/documentation/assets/js/4.a06f2bdb.js"><link rel="prefetch" href="/documentation/assets/js/40.e784f4df.js"><link rel="prefetch" href="/documentation/assets/js/41.745b5691.js"><link rel="prefetch" href="/documentation/assets/js/42.44478856.js"><link rel="prefetch" href="/documentation/assets/js/43.1790b347.js"><link rel="prefetch" href="/documentation/assets/js/44.96b44254.js"><link rel="prefetch" href="/documentation/assets/js/45.e85af69d.js"><link rel="prefetch" href="/documentation/assets/js/46.5fceed33.js"><link rel="prefetch" href="/documentation/assets/js/47.9a1df3eb.js"><link rel="prefetch" href="/documentation/assets/js/48.eba982d4.js"><link rel="prefetch" href="/documentation/assets/js/49.41cd1692.js"><link rel="prefetch" href="/documentation/assets/js/5.d15c8e8e.js"><link rel="prefetch" href="/documentation/assets/js/50.fc2013b4.js"><link rel="prefetch" href="/documentation/assets/js/51.373bf8df.js"><link rel="prefetch" href="/documentation/assets/js/52.c9b991af.js"><link rel="prefetch" href="/documentation/assets/js/53.64c0eb80.js"><link rel="prefetch" href="/documentation/assets/js/54.c13e37db.js"><link rel="prefetch" href="/documentation/assets/js/56.620d50d4.js"><link rel="prefetch" href="/documentation/assets/js/57.df4a4438.js"><link rel="prefetch" href="/documentation/assets/js/58.cb097b29.js"><link rel="prefetch" href="/documentation/assets/js/59.1b9533fa.js"><link rel="prefetch" href="/documentation/assets/js/6.5613c56f.js"><link rel="prefetch" href="/documentation/assets/js/60.d363826d.js"><link rel="prefetch" href="/documentation/assets/js/61.4a56b9b1.js"><link rel="prefetch" href="/documentation/assets/js/62.84da92dd.js"><link rel="prefetch" href="/documentation/assets/js/63.29e83b9f.js"><link rel="prefetch" href="/documentation/assets/js/64.782a564d.js"><link rel="prefetch" href="/documentation/assets/js/65.cc0eceef.js"><link rel="prefetch" href="/documentation/assets/js/66.c73f5912.js"><link rel="prefetch" href="/documentation/assets/js/67.6e58b485.js"><link rel="prefetch" href="/documentation/assets/js/68.c94aaed3.js"><link rel="prefetch" href="/documentation/assets/js/69.25762f00.js"><link rel="prefetch" href="/documentation/assets/js/7.66629c4e.js"><link rel="prefetch" href="/documentation/assets/js/70.ba0f5265.js"><link rel="prefetch" href="/documentation/assets/js/71.0271d662.js"><link rel="prefetch" href="/documentation/assets/js/72.43fd816c.js"><link rel="prefetch" href="/documentation/assets/js/73.f018e699.js"><link rel="prefetch" href="/documentation/assets/js/74.3b3f7646.js"><link rel="prefetch" href="/documentation/assets/js/75.330a7fb8.js"><link rel="prefetch" href="/documentation/assets/js/76.5769a932.js"><link rel="prefetch" href="/documentation/assets/js/77.4b541fae.js"><link rel="prefetch" href="/documentation/assets/js/78.11a4e60e.js"><link rel="prefetch" href="/documentation/assets/js/79.735043f8.js"><link rel="prefetch" href="/documentation/assets/js/8.d172e1dd.js"><link rel="prefetch" href="/documentation/assets/js/80.84d69a21.js"><link rel="prefetch" href="/documentation/assets/js/81.e7604314.js"><link rel="prefetch" href="/documentation/assets/js/82.e38a0d57.js"><link rel="prefetch" href="/documentation/assets/js/83.1f9be2e4.js"><link rel="prefetch" href="/documentation/assets/js/84.4dc7875f.js"><link rel="prefetch" href="/documentation/assets/js/85.255ee7ca.js"><link rel="prefetch" href="/documentation/assets/js/86.ae93ff5e.js"><link rel="prefetch" href="/documentation/assets/js/87.6e649559.js"><link rel="prefetch" href="/documentation/assets/js/88.86008bb9.js"><link rel="prefetch" href="/documentation/assets/js/89.0ee79ead.js"><link rel="prefetch" href="/documentation/assets/js/9.a9a56321.js"><link rel="prefetch" href="/documentation/assets/js/90.6616e755.js"><link rel="prefetch" href="/documentation/assets/js/91.140d11c7.js"><link rel="prefetch" href="/documentation/assets/js/92.3eb7f46a.js"><link rel="prefetch" href="/documentation/assets/js/93.7166ef65.js"><link rel="prefetch" href="/documentation/assets/js/94.b487ad47.js"><link rel="prefetch" href="/documentation/assets/js/95.a87f4f56.js"><link rel="prefetch" href="/documentation/assets/js/96.c108944b.js"><link rel="prefetch" href="/documentation/assets/js/97.56a0fd4c.js">
    <link rel="stylesheet" href="/documentation/assets/css/0.styles.3032228c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation/" class="home-link router-link-active"><img src="https://agoric.com/wp-content/themes/agoric_2021_theme/assets/img/logo.svg" alt="Beta" class="logo"> <span class="site-name can-hide">Beta</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Before Using Agoric
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/beta.html" class="nav-link">
  Agoric Beta
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/js-programming/" class="nav-link router-link-active">
  Agoric JavaScript Programming
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/wallet/" class="nav-link">
  Wallet Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/repl/" class="nav-link">
  REPL
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/chainlink-integration.html" class="nav-link">
  Chainlink Integration
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Before Using Agoric
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/beta.html" class="nav-link">
  Agoric Beta
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/js-programming/" class="nav-link router-link-active">
  Agoric JavaScript Programming
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/wallet/" class="nav-link">
  Wallet Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/repl/" class="nav-link">
  REPL
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/chainlink-integration.html" class="nav-link">
  Chainlink Integration
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/documentation/getting-started/" class="sidebar-link">Documentation Guide</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/agoric-cli/" class="sidebar-heading clickable"><span>Agoric CLI</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/ertp/guide/" class="sidebar-heading clickable"><span>ERTP Guide</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/zoe/guide/" class="sidebar-heading clickable"><span>Zoe Guide</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/wallet/" class="sidebar-heading clickable"><span>Wallet</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/js-programming/" class="sidebar-heading clickable router-link-active"><span>JavaScript Programming</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/js-programming/ses/" class="sidebar-heading clickable router-link-active open"><span>SES</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/guides/js-programming/ses/ses-guide.html" aria-current="page" class="active sidebar-link">SES Guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#what-is-ses" class="sidebar-link">What is SES?</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#the-ses-story" class="sidebar-link">The SES story</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#using-ses-with-your-code" class="sidebar-link">Using SES with your code</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#what-ses-does-to-javascript" class="sidebar-link">What SES does to JavaScript</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#what-ses-removes-from-standard-javascript" class="sidebar-link">What SES removes from standard JavaScript</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#what-ses-adds-to-standard-javascript" class="sidebar-link">What SES adds to standard Javascript</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#realms" class="sidebar-link">Realms</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#compartments" class="sidebar-link">Compartments</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#lockdown" class="sidebar-link">lockdown()</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#harden" class="sidebar-link">harden()</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#lockdown-and-harden" class="sidebar-link">lockdown() and harden()</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#library-compatibility" class="sidebar-link">Library compatibility</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#html-comments" class="sidebar-link">HTML comments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#dynamic-import-expressions" class="sidebar-link">Dynamic import expressions</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/ses-guide.html#direct-vs-indirect-eval-expressions" class="sidebar-link">Direct vs. indirect eval expressions</a></li></ul></li><li><a href="/documentation/guides/js-programming/ses/ses-reference.html" class="sidebar-link">SES Reference</a></li><li><a href="/documentation/guides/js-programming/ses/lockdown.html" class="sidebar-link">lockdown() and its Options</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/repl/" class="sidebar-heading clickable"><span>REPL</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="sidebar-link">Dynamic IBC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/documentation/guides/chainlink-integration.html" class="sidebar-link">Chainlink Integration</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ses-guide"><a href="#ses-guide" class="header-anchor">#</a> SES Guide</h1> <p>This is a guide to understanding <em>SES (Secure ECMAScript)</em>. It:</p> <ul><li>Shows what you can and cannot do with a SES-using JavaScript program.</li> <li>Defines what SES is and does.</li> <li>Provides background on why JavaScript functionality was added, removed, or changed.</li> <li>Describes <em>realms</em> and <em>compartments</em>.</li></ul> <p>This is intended for initial reading when starting to use or learn about Agoric. For
those knowledgeable about or experienced with SES, see the <a href="/documentation/guides/js-programming/ses/ses-reference.html">SES Reference</a>
for to use SES without much explanation.</p> <h2 id="what-is-ses"><a href="#what-is-ses" class="header-anchor">#</a> What is SES?</h2> <p>SES (<em>Secure ECMAScript</em>):</p> <ul><li>Is a JavaScript runtime library for safely running third-party code.</li> <li>Addresses JavaScript’s lack of internal security.
<ul><li>This is particularly significant because JavaScript applications
use and rely on third-party code (modules, packages, libraries,
user-provided code for extensions and plug-ins, etc.).</li></ul></li> <li>Enforces best practices by removing hazardous features such as global
mutable state and lack of encapsulation in sloppy mode.</li> <li>Is a safe deterministic subset of &quot;strict mode&quot; JavaScript.</li> <li>Does not include any IO objects that provide
<a href="https://en.wikipedia.org/wiki/Ambient_authority" target="_blank" rel="noopener noreferrer"><em>ambient authority</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Removes non-determinism by modifying a few built-in objects.</li> <li>Adds functionality to freeze and make immutable both built-in JavaScript
objects and program created objects and make them immutable.</li></ul> <h2 id="the-ses-story"><a href="#the-ses-story" class="header-anchor">#</a> The SES story</h2> <p>JavaScript was created to let web surfers safely run programs from strangers.
Web pages put JavaScript programs in a <em>sandbox</em> that restricts their abilities
while maximizing utility.</p> <p>This worked well until web applications started inviting multiple strangers
into the same sandbox. But they continued to depend on a security model where
every stranger had their own sandbox.</p> <p>Meanwhile, server-side JavaScript applications imbued their sandbox with unbounded
abilities and ran programs written by strangers. They were vulnerable
to both their dependencies <em>and</em> also the rarely reviewed dependencies of their dependencies.</p> <p>SES uses a finer grain security model, <em>Object Capabilities</em> or <em>OCaps</em>.
With OCaps, many strangers can collaborate in a single sandbox, without risking them
frustrating, interfering, or conspiring with or against the user or each other.</p> <p>To do this, SES <em>hardens</em> the entire surface of the JavaScript environment.
<em>The only way a program can subvert or communicate with another program is to
have been expressly granted a reference to an object provided by that other program.</em></p> <p>Any programming environment fitting the OCaps model satisfies three requirements:</p> <ul><li>Any program can protect its invariants by hiding its own data and capabilities.</li> <li>Power can only be exercised over something by having a reference to the
object providing that power, for example, a file system object. A
reference to a powerful object is a <em>capability</em>.</li> <li>The only way to get a capability is by being given one. For example, by receiving
one as an argument of a constructor or method.</li></ul> <p>Ordinary JavaScript does not fully qualify as an OCaps language due to the pervasive
mutability of shared objects. You can construct a JavaScript subset with a
transitively immutable environment without any unintended capabilities. Starting
in 2007 with ECMAScript 5, Agoric engineers and the OCap community have influenced
JavaScript’s evolution so a program can transform its own environment into
this safe JavaScript environment.</p> <p>As of February 2021, SES is making its way through JavaScript standards committees.
It is expected to become official JavaScript when the standards process
is completed. Meanwhile, Agoric provides its own SES <em>shim</em> (a library providing
the needed SES features) for writing secure smart contracts in JavaScript.
Note that several Agoric engineers are on the relevant standards committees
and are responsible for aspects of SES, so our SES should be very close to the
eventual standards.</p> <h2 id="using-ses-with-your-code"><a href="#using-ses-with-your-code" class="header-anchor">#</a> Using SES with your code</h2> <p>The SES shim transforms ordinary JavaScript environments into SES environments.</p> <p>On Node.js you can import or require <code>ses</code> in either CommonJS or ECMAScript modules, then call <code>lockdown()</code>. This is a <em>shim</em>. It mutates the environment in place so any code running after the shim can assume it’s running in a SES environment. This includes the globals <code>lockdown()</code>, <code>harden()</code>, <code>Compartment</code>, and so on. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ses&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'ses'</span><span class="token punctuation">;</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To ensure a module runs in a SES environment, wrap the above code in a <code>ses-lockdown.js</code> module and import it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./non-ses-code-before-lockdown.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./ses-lockdown.js'</span><span class="token punctuation">;</span> <span class="token comment">// calls lockdown.</span>
<span class="token keyword">import</span> <span class="token string">'./ses-code-after-lockdown.js'</span><span class="token punctuation">;</span>
</code></pre></div><p>To use SES as a script on the web, use the UMD build.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;node_modules/ses/dist/ses.umd.min.js&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>The full SES environment's module system requires a translating compiler. There is a much thinner SES version that just provides an evaluator Compartment. For it, use the much smaller <code>ses/lockdown</code> layer. Especially if all client code gets bundled as a script out-of-band.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'ses/lockdown'</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;node_modules/ses/dist/lockdown.umd.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="what-ses-does-to-javascript"><a href="#what-ses-does-to-javascript" class="header-anchor">#</a> What SES does to JavaScript</h2> <p>As mentioned, SES does not include any IO objects providing &quot;unsafe&quot; <a href="https://en.wikipedia.org/wiki/Ambient_authority" target="_blank" rel="noopener noreferrer"><em>ambient authority</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
It also doesn't allow non-determinism from built-in JavaScript objects.</p> <p>As of SES-0.8.0/Fall 2020, <a href="https://github.com/endojs/endo/blob/SES-v0.8.0/packages/ses/src/whitelist.js" target="_blank" rel="noopener noreferrer">Agoric's SES source code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
defines a subset of the globals defined by the baseline JavaScript language specification. SES includes these globals:</p> <ul><li><code>Object</code></li> <li><code>Array</code></li> <li><code>Number</code></li> <li><code>Map</code></li> <li><code>WeakMap</code></li> <li><code>Number</code></li> <li><code>BigInt</code></li> <li><code>Intl</code></li> <li><code>Math</code> all features except
<ul><li><code>Math.random()</code> is disabled (calling it throws an error) as an obvious source of<br>
non-determinism.</li></ul></li> <li><code>Date</code> all features except
<ul><li><code>Date.now()</code> returns <code>NaN</code></li> <li><code>new Date(nonNumber)</code> or <code>Date(anything)</code> return a <code>Date</code> that stringifies to <code>&quot;Invalid Date&quot;</code></li></ul></li></ul> <p>Much of the <code>Intl</code> package, and some other objects' locale-specific aspects (e.g. <code>Number.prototype.toLocaleString</code>)
have results that depend upon which locale is configured. This varies from one process to another.
See <a href="/documentation/guides/js-programming/ses/lockdown.html"><code>lockdown()</code></a> for how those are handled.</p> <p>SES freezes <em>primordials</em>; built-in JavaScript objects such as <code>Object</code>, <code>Array</code>, and <code>RegExp</code>,
and their prototype chains. <code>globalThis</code> is also frozen. This prevents malicious code from changing their behavior
(imagine <code>Array.prototype.push</code> delivering a copy of its argument to an attacker, or ignoring
certain values). It also prevents using, for example, <code>Object.heyBuddy</code> or <code>globalThis.heyBuddy</code>
as an ambient communication channel via setting a property and another program periodically reading it.
This would violate object-capability discipline; objects may only communicate through references.</p> <p>Both frozen primordials and a frozen <code>globalThis</code> have problems with a few JavaScript
libraries that add new features to built-in objects (shims/polyfills). These
libraries stretch best practices' boundaries by adding new features to built-in
objects in a way SES Compartments don't allow.</p> <h2 id="what-ses-removes-from-standard-javascript"><a href="#what-ses-removes-from-standard-javascript" class="header-anchor">#</a> What SES removes from standard JavaScript</h2> <p>Almost all existing JavaScript code runs under Node.js or inside a browser, so
it's easy to conflate environment features with JavaScript. For example, you may
be surprised that <code>Buffer</code> and <code>require</code> are Node.js additions. Also <code>setTimeout()</code>,
<code>setInterval()</code>, <code>URL</code>, <code>atob()</code>, <code>btoa()</code>, <code>TextEncoder</code>, and <code>TextDecoder</code> are additions
to the programming environment standardized by the web, and are not intrinsic
to JavaScript.</p> <p>Most Node.js-specific <a href="https://nodejs.org/dist/latest-v14.x/docs/api/globals.html" target="_blank" rel="noopener noreferrer">global objects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are
<strong>unavailable</strong> including:</p> <ul><li><code>queueMicrotask</code></li> <li><code>URL</code> and <code>URLSearchParams</code></li> <li><code>WebAssembly</code></li> <li><code>TextEncoder</code> and <code>TextDecoder</code></li> <li><code>global</code> <ul><li>Use <code>globalThis</code> instead (and remember it is frozen).</li></ul></li> <li><code>process</code> <ul><li>No <code>process.env</code> to access the process's environment variables.</li> <li>No <code>process.argv</code> for the argument array.</li></ul></li> <li><code>Buffer</code> (consider using <code>TypedArray</code> instead, but see below)</li> <li><code>setImmediate</code>/<code>clearImmediate</code> <ul><li><p>You can generally replace <code>setImmediate(fn)</code>
with <code>Promise.resolve().then(_ =&gt; fn())</code> to defer execution of <code>fn</code> until after the current event/callback
finishes processing. But it won't run until after all <em>other</em> ready Promise callbacks execute.</p> <p>There are two queues: the <em>IO queue</em> (accessed by <code>setImmediate</code>), and the <em>Promise queue</em> (accessed by
Promise resolution). SES code can add to the Promise queue, but needs to be given a
capability to be able to add to the IO queue. Note that the Promise queue is
higher-priority than the IO queue, so the Promise queue must be empty for any IO or timers to be handled.</p></li></ul></li> <li><code>setInterval</code> and <code>setTimeout</code> (and <code>clearInterval</code>/<code>clearTimeout</code>)
<ul><li>Any notion of time must come from
exchanging messages with external timer services (the SwingSet environment provides a <code>TimerService</code> object
to the bootstrap vat, which can share it with other vats)</li></ul></li></ul> <p>None of the huge list of <a href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank" rel="noopener noreferrer">other Browser environment features<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
presented as names in the global scope (some also added to Node.js) are available in a
SES environment. The most surprising removals include <code>atob</code>, <code>TextEncoder</code>, and <code>URL</code>.</p> <p><code>debugger</code> is a first-class JavaScript statement, and behaves as expected.</p> <h2 id="what-ses-adds-to-standard-javascript"><a href="#what-ses-adds-to-standard-javascript" class="header-anchor">#</a> What SES adds to standard Javascript</h2> <p>The following anticipate additional proposed standard-track features. If they become standards,
future JavaScript environments will include them as global objects. So the current Agoric SES shim
makes those global objects available.</p> <ul><li><p><code>console</code> is available for debugging. While not in the official spec, since all implementations
add it, leaving it out would cause confusion. Note that <code>console.log</code>’s exact
behavior is up to the host program; display to the operator is not guaranteed. Use the
console for debug information only. The console is not obliged to write to the POSIX standard output.</p></li> <li><p><code>lockdown()</code> and <code>harden()</code> both freeze an object’s API surface (enumerable data properties).
A hardened object’s properties cannot be changed, only read, so the only way to interact with a
hardened object is through its methods. <code>harden()</code> is similar to <code>Object.freeze()</code> but more
thorough. See the individual <a href="#lockdown"><code>lockdown()</code></a> and <a href="#harden"><code>harden()</code></a> sections
below.</p></li> <li><p><code>[Compartment](https://github.com/endojs/endo/tree/SES-v0.8.0/packages/ses#compartment)</code> is
a global. Code runs inside a <code>Compartment</code> and can create sub-compartments to host other
code (with different globals or transforms). Note that these child compartments get <code>harden()</code> and <code>Compartment</code>.</p></li></ul> <h2 id="realms"><a href="#realms" class="header-anchor">#</a> Realms</h2> <p>Agoric deploy scripts and smart contract code run in an <em>immutable
realm</em> with <em>Compartments</em> providing just enough authority to create
useful and secure contracts. But not enough authority to do anything
unintended or harmful to the participants of the smart contract.</p> <p>JavaScript code runs in the context of
a <a href="https://www.ecma-international.org/ecma-262/10.0/index.html#sec-code-realms" target="_blank" rel="noopener noreferrer"><em>Realm</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. A
realm is the set of <em>primordials</em> (objects and standard library functions
like <code>Array.prototype.push</code>) and a global object. In a web browser, an iframe is a realm.
In Node.js, a Node process is a realm.</p> <p>For historical reasons, the ECMAScript specification requires primordials
be mutable (<code>Array.prototype.push = yourFunction</code> is valid ECMAScript but not
recommended). By using the Agoric SES shim and calling <code>lockdown()</code>, you can turn the
current realm into an <em>immutable realm</em>; a realm within which the primordials
are deeply frozen.</p> <p>SES also lets programs create <em>Compartments</em>. These are &quot;mini-realms&quot;.
A Compartment has its own dedicated global object and environment, but
it inherits the primordials from their parent realm. Components are described
in detail in the next section.</p> <h2 id="compartments"><a href="#compartments" class="header-anchor">#</a> Compartments</h2> <p>A <em>compartment</em> is an execution environment for evaluating a stranger’s code. It has
its own <code>globalThis</code> global object and wholly independent system of
modules. Otherwise it shares the same batch of intrinsics such as <code>Array</code> with its surrounding
compartment. The concept of a compartment implies an initial compartment,
the initial execution environment of a realm. After lockdown is called, all compartments share the same
frozen realm.</p> <p>Here we create a compartment with a <code>print()</code> function on <code>globalThis</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'ses'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  print<span class="token operator">:</span> <span class="token function">harden</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

c<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  print('Hello! Hello?');
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This new compartment has a different global object than the start compartment. We
posit that all JavaScript executes in a realm and compartment. Every realm has
distinct intrinsics, whereas every compartment shares intrinsics. The initial
realm and compartment are not constructed with <code>new Realm()</code> or <code>new Compartment()</code> but
that’s invisible to the code running; they could just as well be running within
a constructed realm or compartment.</p> <p>We call the one compartment in a realm that was not expressly constructed the start
compartment. The start compartment receives some ambient authorities from the host,
often access to timers and IO that are denied to other compartments. Running lockdown
does not erase these powerful objects, but puts the program running in the start
compartment on a footing where it is possible to carefully delegate powers to child
compartments.</p> <p>The global object is initially mutable. Locking down the realm hardened the objects in
global scope. After lockdown, no compartment can tamper with these intrinsics and
undeniable objects. Many of these are identical in the new compartment.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token punctuation">.</span>globalThis <span class="token operator">===</span> globalThis<span class="token punctuation">;</span> <span class="token comment">// false</span>
c<span class="token punctuation">.</span>globalThis<span class="token punctuation">.</span><span class="token constant">JSON</span> <span class="token operator">===</span> <span class="token constant">JSON</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>Other pairs of compartments also share many identical intrinsics and undeniable objects
of the realm. Each has a unique, initially mutable, global object.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
c1<span class="token punctuation">.</span>globalThis <span class="token operator">===</span> c2<span class="token punctuation">.</span>globalThis<span class="token punctuation">;</span> <span class="token comment">// false</span>
c1<span class="token punctuation">.</span>globalThis<span class="token punctuation">.</span><span class="token constant">JSON</span> <span class="token operator">===</span> c2<span class="token punctuation">.</span>globalThis<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>Every compartment's global scope includes a shallow, specialized copy of the JavaScript
intrinsics. These omit <code>Date.now()</code> and <code>Math.random()</code>
since they can be covert inter-program communication channels.</p> <p>However, a compartment may be expressly given access to these objects through
the compartment constructor's first argument or by assigning them to the
compartment's <code>globalThis</code> after construction.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> powerfulCompartment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Math <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
powerfulCompartment<span class="token punctuation">.</span>globalThis<span class="token punctuation">.</span>Date <span class="token operator">=</span> Date<span class="token punctuation">;</span>
</code></pre></div><p>When you create a new <code>Compartment</code> object, you must decide if it supports OCaps security.
If it does, run <code>harden(compartment.globalThis)</code> on it before loading any untrusted code into it.</p> <p>A single compartment can run a JavaScript program in the locked-down SES environment.
However, most interesting programs have multiple modules. So, each compartment also has
its own module system. SES version 0.8.0 adds support for ECMAScript modules,
a relatively new system supported by many browsers, and officially released in Node.js 14.</p> <p>Compartments can be linked, so one compartment can export a module that another compartment
imports. Each compartment may have its own rules for how to resolve import specifiers and
how to locate and retrieve modules. In the following example, we use the compartment constructor to
create two compartments: one for the application and another for its dependency.</p> <p>The <code>resolveHook</code> is synchronous and determines how to compute the full module specifier
for a partially resolved module specifier in ESM source text, like <code>import &quot;./even.js&quot;</code> as
it appears in <code>./math/odd.js</code> corresponds to <code>./math/even.js</code> in a Node.js program.</p> <p>The <code>importHook</code> is asynchronous and responsible for for locating, retrieving, and parsing
modules. Retrieving is getting the source text from the web, archive, or database based on
its location. Converting a module specifier to a location is an internal concern of
the <code>importHook</code> and the particular storage medium for the module texts, but should generally
be a URL and may appear in stack traces. The <code>importHook</code> may use the <code>ModuleStaticRecord</code>
constructor to create a reusable, parsed representation of the module text.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dependency <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">resolveHook</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">moduleSpecifier<span class="token punctuation">,</span> moduleReferrer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>moduleSpecifier<span class="token punctuation">,</span> moduleReferrer<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">importHook</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token parameter">moduleSpecifier</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> moduleLocation <span class="token operator">=</span> <span class="token function">locate</span><span class="token punctuation">(</span>moduleSpecifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> moduleText <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>moduleLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModuleStaticRecord</span><span class="token punctuation">(</span>moduleText<span class="token punctuation">,</span> moduleLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> application <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compartment</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'dependency'</span><span class="token operator">:</span> dependency<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'./main.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  resolveHook<span class="token punctuation">,</span>
  importHook<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Compartments provide a low-level loader API for JavaScript modules.
Your code might run in compartments, but they are an implementation
detail of tools and runtimes.</p> <p>Vats in the Agoric runtime use compartments to isolate contracts within a vat.
A vat can use multiple comparments.
MetaMask’s LavaMoat uses a Compartment for every module, to create
boundaries between application code and third-party dependencies.</p> <p>The lifetime of a compartment is bounded by garbage collection and the
lifetime of the realm that contains them. You will not ever have to tear
down or delete one.</p> <h2 id="lockdown"><a href="#lockdown" class="header-anchor">#</a> <code>lockdown()</code></h2> <p><code>lockdown()</code> freezes all JavaScript defined objects accessible to any
program in the execution environment. Calling <code>lockdown()</code> turns a JavaScript
system into a SES system, with enforced OCap (object-capability) security. It
alters the surrounding execution environment (realm) such that no two
programs running in the same realm can observe or interfere with each other
until they have been introduced.</p> <p>To do this, <code>lockdown()</code> tamper-proofs all of the JavaScript intrinsics to prevent
prototype pollution. After that, no program can subvert the methods of these objects
(preventing some man in the middle attacks). Also, no program can use these mutable
objects to pass notes to parties that haven't been expressly introduced (preventing
some covert communication channels).</p> <p>For a full explanation of <code>lockdown()</code> and its options, please click
<a href="/documentation/guides/js-programming/ses/lockdown.html">here</a>.</p> <h2 id="harden"><a href="#harden" class="header-anchor">#</a> <code>harden()</code></h2> <p><code>harden()</code> is automatically provided by SES. Any code that will run inside a vat or a
contract can use harden as a global, without importing anything. The Agoric programming
environment defines objects (<code>mint</code>, <code>issuer</code>, <code>zcf</code>, etc.) that shouldn't need hardening
as their constructors do that work. You mainly need to harden records, callbacks, and ephemeral objects.</p> <p><code>harden()</code> must be called on all objects that will be transferred across a trust boundary
The general rule is if you make a new object and give it to someone else (and don't
immediately forget it yourself), you should give them <code>harden(obj)</code> instead of the raw object.
This ensures other objects can only interact with them through their defined method interface,
i.e. the functions in the object's API. <em>CapTP</em>, our communications layer for passing
references to distributed objects, enforces this at vat boundaries.</p> <p>Hardening an instance also hardens its class.</p> <p>You can send a message to a hardened object. If it's a record, you can access
its properties and their values. Being hardened doesn't preclude an object from having
access to mutable state (<code>harden(new Map())</code> still behaves like a normal mutable <code>Map</code>),
but it means their methods stay the same and can't be surprisingly changed by someone else.</p> <blockquote><p>Tip: If your text editor/IDE complains about <code>harden()</code> not being defined or imported,
try adding <code>/* global harden */</code> to the top of the file.</p> <p>You use <code>harden()</code> like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>a  <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12 because o is still mutable</span>
<span class="token function">harden</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>a  <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span> <span class="token comment">// throws a TypeError because o is now hardened</span>
</code></pre></div></blockquote> <h2 id="lockdown-and-harden"><a href="#lockdown-and-harden" class="header-anchor">#</a> <code>lockdown()</code> and <code>harden()</code></h2> <p><code>lockdown()</code> and <code>harden()</code> essentially do the same thing; freeze objects so their
properties cannot be changed. The only way to interact with frozen objects is through
their methods. Their differences are what objects you use them on, and when you use them.</p> <p><code>lockdown()</code> <strong>must</strong> be called first. It hardens JavaScript's built-in <em>primordials</em>
(implicitly shared global objects) and enables <code>harden()</code>. If you call <code>harden()</code>
before <code>lockdown()</code> excutes, it throws an error.</p> <p><code>lockdown()</code> works on objects created by the JavaScript language itself as part of
its definition. Use <code>harden()</code> to freeze objects created after <code>lockdown()</code>was called;
i.e. objects created by programs written in JavaScript.</p> <h2 id="library-compatibility"><a href="#library-compatibility" class="header-anchor">#</a> Library compatibility</h2> <p>Programs running under SES can use <code>import</code> or <code>require()</code> to import other libraries consisting
only of SES-compatible JavaScript code. This includes a significant part of the NPM registry.</p> <p>However, many NPM packages use built-in Node.js modules. If used at import time (in their top-level
code), SES-enabled code cannot use the package and fails to load at all. If they use the built-in
features at runtime, then the package can load. However, it might fail later when an invoked function
accesses the missing functionality. So some NPM packages are partially compatible;
usable if you don't invoke certain features.</p> <p>The same is true for NPM packages that use missing globals, or attempt to modify frozen primordials.</p> <p>The <a href="https://github.com/endojs/endo/wiki" target="_blank" rel="noopener noreferrer">SES wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> tracks compatibility reports for NPM packages,
including potential workarounds.</p> <h2 id="html-comments"><a href="#html-comments" class="header-anchor">#</a> HTML comments</h2> <p>JavaScript parsers may not recognize HTML comments within source code, potentially causing different
behavior on different engines. For safety, the Agoric SES shim rejects any source code containing a comment
open (<code>&lt;!--</code>) or close (<code>--&gt;</code>) sequence. However, its filter uses a regular expression, not a full
parser. It unnecessarily rejects any source code containing either of the strings <code>&lt;!--</code> or <code>--&gt;</code>,
even if neither marks a comment.</p> <h3 id="dynamic-import-expressions"><a href="#dynamic-import-expressions" class="header-anchor">#</a> Dynamic import expressions</h3> <p>The &quot;dynamic import expression&quot; (<code>import('path')</code>) enables code to load dependencies at
runtime. It returns a promise resolving to the module namespace object. While it takes
the form of a function call, it's actually not a function call, but is instead JavaScript
syntax. As such it would let vat code bypass the shim's <code>Compartment</code>'s module map.
For safety, the SES shim rejects code that looks like it uses a dynamic import expression.</p> <p>The regular expression for this pattern is safe and should never allow any use of
dynamic import, however obfuscated the usage is. Because of this, it may be confused
into falsely rejecting legitimate code.</p> <p>For example, the word “import” near a parenthesis or at the end of a line inside a
comment is identified as a disallowed use of <code>import()</code> and falsely rejected:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//</span>
<span class="token comment">// This function calculates the import</span>
<span class="token comment">// duties paid on the merchandise..</span>
<span class="token comment">//</span>
</code></pre></div><p>But the following obfuscated dynamic import usage is rightly rejected:</p> <div class="language-js extra-class"><pre class="language-js"><code>sneaky <span class="token operator">=</span> <span class="token keyword">import</span>
<span class="token comment">// comment to hide invocation</span>
<span class="token punctuation">(</span>modulename<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="direct-vs-indirect-eval-expressions"><a href="#direct-vs-indirect-eval-expressions" class="header-anchor">#</a> Direct vs. indirect eval expressions</h2> <p>A <em>direct eval</em>, invoked as <code>eval(code)</code>, behaves as if <code>code</code> were expanded in place. The
evaluated code sees the same scope as the <code>eval</code> itself sees, so this <code>code</code> can reference <code>x</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token function">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you perform a direct eval, you cannot hide your internal authorities from the code being evaluated.</p> <p>In contrast, an <em>indirect eval</em> only gets the global scope, not the local scope. In a safe SES
environment, indirect eval is a useful and common tool. The evaluated code can only access global
objects, and those are all safe (and frozen). The only bad thing an indirect eval can do is consume
unbounded CPU or memory. Once you've evaluated the code, you can invoke it with arguments to give it
as many or as few authorities as you like.</p> <p>The most common way to invoke an indirect eval is <code>(1,eval)(code)</code>.</p> <p>The SES proposal does not change how direct and indirect eval work. However, the SES shim
cannot correctly emulate a direct eval. If it tried, it would perform an indirect eval.
This could be pretty confusing, because the evaluated code would not use objects from
the local scope as expected. Furthermore, in the future when SES is natively implemented
by JavaScript engines, the behavior would revert to direct eval, allowing access to
anything in scope.</p> <p>To avoid this confusion and compatibility risk, the shim uses a regular expression to
reject code that looks like it is performing a direct eval. This regexp is not complete
(you can trick it into allowing a direct eval), but that’s safe because it really performs
an indirect eval. Our goal is just to guide people away from confusing and non-compliant
behaviors early in their development process.</p> <p>This regexp falsely rejects occurrences inside static strings and comments.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Agoric/documentation/edit/main/main/guides/js-programming/ses/ses-guide.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/4/2021, 6:42:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/documentation/guides/js-programming/notifiers.html" class="prev">
        Notifiers and Subscriptions
      </a></span> <span class="next"><a href="/documentation/guides/js-programming/ses/ses-reference.html">
        SES Reference
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/documentation/assets/js/app.0bd16630.js" defer></script><script src="/documentation/assets/js/2.581bc00f.js" defer></script><script src="/documentation/assets/js/55.7e077254.js" defer></script>
  </body>
</html>
