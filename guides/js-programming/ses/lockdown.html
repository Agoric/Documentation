<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lockdown() and its Options | Beta</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/documentation/favicon-full.ico">
    <style type="text/css">
    .two-col-table td {
        width: 50%;
    }
    .two-col-table table {
        table-layout: fixed;
    }</style>
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-118217811-1"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-118217811-1'); </script>
    <script>
    const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://agoric.com");
      homeEl.setAttribute("onclick", "return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://agoric.com';return false;");
      clearInterval(logoUrlChanger);
    }
   }, 1000) </script>
    <meta name="description" content="Build, deploy and operate dApps and DeFi markets.">
    
    <link rel="preload" href="/documentation/assets/css/0.styles.3032228c.css" as="style"><link rel="preload" href="/documentation/assets/js/app.da4d8089.js" as="script"><link rel="preload" href="/documentation/assets/js/2.92af905e.js" as="script"><link rel="preload" href="/documentation/assets/js/53.24ba908b.js" as="script"><link rel="prefetch" href="/documentation/assets/js/10.3ac2d62d.js"><link rel="prefetch" href="/documentation/assets/js/11.d00c32f1.js"><link rel="prefetch" href="/documentation/assets/js/12.31d4e598.js"><link rel="prefetch" href="/documentation/assets/js/13.6d0b39b2.js"><link rel="prefetch" href="/documentation/assets/js/14.82c8afa5.js"><link rel="prefetch" href="/documentation/assets/js/15.0e7a9af7.js"><link rel="prefetch" href="/documentation/assets/js/16.6b4136ac.js"><link rel="prefetch" href="/documentation/assets/js/17.515167f1.js"><link rel="prefetch" href="/documentation/assets/js/18.ea712515.js"><link rel="prefetch" href="/documentation/assets/js/19.804d65b8.js"><link rel="prefetch" href="/documentation/assets/js/20.968c8180.js"><link rel="prefetch" href="/documentation/assets/js/21.fd635c29.js"><link rel="prefetch" href="/documentation/assets/js/22.8f1b9220.js"><link rel="prefetch" href="/documentation/assets/js/23.5bfb30a7.js"><link rel="prefetch" href="/documentation/assets/js/24.275ad090.js"><link rel="prefetch" href="/documentation/assets/js/25.b9d2d8da.js"><link rel="prefetch" href="/documentation/assets/js/26.9a95f29d.js"><link rel="prefetch" href="/documentation/assets/js/27.dfc25a3d.js"><link rel="prefetch" href="/documentation/assets/js/28.43d60c7b.js"><link rel="prefetch" href="/documentation/assets/js/29.fe80ee95.js"><link rel="prefetch" href="/documentation/assets/js/3.613ab482.js"><link rel="prefetch" href="/documentation/assets/js/30.1a01d837.js"><link rel="prefetch" href="/documentation/assets/js/31.ef515c07.js"><link rel="prefetch" href="/documentation/assets/js/32.c9fdeed6.js"><link rel="prefetch" href="/documentation/assets/js/33.526154c5.js"><link rel="prefetch" href="/documentation/assets/js/34.91c4fc77.js"><link rel="prefetch" href="/documentation/assets/js/35.2f99ea53.js"><link rel="prefetch" href="/documentation/assets/js/36.8c643285.js"><link rel="prefetch" href="/documentation/assets/js/37.496cd3f3.js"><link rel="prefetch" href="/documentation/assets/js/38.609cb51b.js"><link rel="prefetch" href="/documentation/assets/js/39.eaa113ad.js"><link rel="prefetch" href="/documentation/assets/js/4.cb851d81.js"><link rel="prefetch" href="/documentation/assets/js/40.6eb8df26.js"><link rel="prefetch" href="/documentation/assets/js/41.657daa08.js"><link rel="prefetch" href="/documentation/assets/js/42.2c262ced.js"><link rel="prefetch" href="/documentation/assets/js/43.52434302.js"><link rel="prefetch" href="/documentation/assets/js/44.ec7a0db9.js"><link rel="prefetch" href="/documentation/assets/js/45.7dffa03e.js"><link rel="prefetch" href="/documentation/assets/js/46.81dc83d1.js"><link rel="prefetch" href="/documentation/assets/js/47.aa0fbbab.js"><link rel="prefetch" href="/documentation/assets/js/48.207d288e.js"><link rel="prefetch" href="/documentation/assets/js/49.c9231dd9.js"><link rel="prefetch" href="/documentation/assets/js/5.c7b7ee3c.js"><link rel="prefetch" href="/documentation/assets/js/50.73a09e99.js"><link rel="prefetch" href="/documentation/assets/js/51.badbab09.js"><link rel="prefetch" href="/documentation/assets/js/52.b484e10d.js"><link rel="prefetch" href="/documentation/assets/js/54.86bd7e2c.js"><link rel="prefetch" href="/documentation/assets/js/55.3b2f7f39.js"><link rel="prefetch" href="/documentation/assets/js/56.de3215c1.js"><link rel="prefetch" href="/documentation/assets/js/57.c2254c9f.js"><link rel="prefetch" href="/documentation/assets/js/58.12598afe.js"><link rel="prefetch" href="/documentation/assets/js/59.fcc81385.js"><link rel="prefetch" href="/documentation/assets/js/6.6d786ada.js"><link rel="prefetch" href="/documentation/assets/js/60.913b0550.js"><link rel="prefetch" href="/documentation/assets/js/61.6e5c0dca.js"><link rel="prefetch" href="/documentation/assets/js/62.2a5848bd.js"><link rel="prefetch" href="/documentation/assets/js/63.253c5579.js"><link rel="prefetch" href="/documentation/assets/js/64.9b6ff728.js"><link rel="prefetch" href="/documentation/assets/js/65.ee30af73.js"><link rel="prefetch" href="/documentation/assets/js/66.5b06295c.js"><link rel="prefetch" href="/documentation/assets/js/67.af8fcdf9.js"><link rel="prefetch" href="/documentation/assets/js/68.71594875.js"><link rel="prefetch" href="/documentation/assets/js/69.6e06e3ba.js"><link rel="prefetch" href="/documentation/assets/js/7.8c4c4964.js"><link rel="prefetch" href="/documentation/assets/js/70.1ea38e4b.js"><link rel="prefetch" href="/documentation/assets/js/71.a685d4b4.js"><link rel="prefetch" href="/documentation/assets/js/72.f78fd5bf.js"><link rel="prefetch" href="/documentation/assets/js/73.030d2df4.js"><link rel="prefetch" href="/documentation/assets/js/74.c426fc44.js"><link rel="prefetch" href="/documentation/assets/js/75.ff8c8dfa.js"><link rel="prefetch" href="/documentation/assets/js/76.1636865b.js"><link rel="prefetch" href="/documentation/assets/js/77.9555302e.js"><link rel="prefetch" href="/documentation/assets/js/78.cdd95568.js"><link rel="prefetch" href="/documentation/assets/js/79.0bfbcb4a.js"><link rel="prefetch" href="/documentation/assets/js/8.760959c0.js"><link rel="prefetch" href="/documentation/assets/js/80.309be2fd.js"><link rel="prefetch" href="/documentation/assets/js/81.fc9a2667.js"><link rel="prefetch" href="/documentation/assets/js/82.71a30ba9.js"><link rel="prefetch" href="/documentation/assets/js/83.d92d1fdb.js"><link rel="prefetch" href="/documentation/assets/js/84.15387166.js"><link rel="prefetch" href="/documentation/assets/js/85.c4fc6459.js"><link rel="prefetch" href="/documentation/assets/js/86.176b7422.js"><link rel="prefetch" href="/documentation/assets/js/87.7b21fdb1.js"><link rel="prefetch" href="/documentation/assets/js/88.003fe36a.js"><link rel="prefetch" href="/documentation/assets/js/89.df830aa1.js"><link rel="prefetch" href="/documentation/assets/js/9.e3c1f2ef.js"><link rel="prefetch" href="/documentation/assets/js/90.aae04318.js"><link rel="prefetch" href="/documentation/assets/js/91.ef53e6a6.js"><link rel="prefetch" href="/documentation/assets/js/92.790f2c36.js"><link rel="prefetch" href="/documentation/assets/js/93.2d07751b.js"><link rel="prefetch" href="/documentation/assets/js/94.b49b1ab7.js"><link rel="prefetch" href="/documentation/assets/js/95.deb92700.js">
    <link rel="stylesheet" href="/documentation/assets/css/0.styles.3032228c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation/" class="home-link router-link-active"><img src="https://agoric.com/wp-content/themes/agoric_2021_theme/assets/img/logo.svg" alt="Beta" class="logo"> <span class="site-name can-hide">Beta</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Installing the Agoric SDK
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/beta.html" class="nav-link">
  Agoric Beta
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/js-programming/" class="nav-link router-link-active">
  JavaScript Framework
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/wallet/" class="nav-link">
  Wallet Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/repl/" class="nav-link">
  REPL
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/chainlink-integration.html" class="nav-link">
  Chainlink Integration
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Installing the Agoric SDK
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/beta.html" class="nav-link">
  Agoric Beta
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/js-programming/" class="nav-link router-link-active">
  JavaScript Framework
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/wallet/" class="nav-link">
  Wallet Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/repl/" class="nav-link">
  REPL
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/chainlink-integration.html" class="nav-link">
  Chainlink Integration
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/agoric-cli/" class="sidebar-heading clickable"><span>Agoric CLI</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/ertp/guide/" class="sidebar-heading clickable"><span>ERTP Guide</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/zoe/guide/" class="sidebar-heading clickable"><span>Zoe Guide</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/wallet/" class="sidebar-heading clickable"><span>Wallet</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/js-programming/" class="sidebar-heading clickable router-link-active"><span>JavaScript Framework</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/guides/js-programming/ses/" class="sidebar-heading clickable router-link-active open"><span>SES</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/guides/js-programming/ses/ses-guide.html" class="sidebar-link">SES Guide</a></li><li><a href="/documentation/guides/js-programming/ses/ses-reference.html" class="sidebar-link">SES Reference</a></li><li><a href="/documentation/guides/js-programming/ses/lockdown.html" aria-current="page" class="active sidebar-link">lockdown() and its Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#lockdown-vs-harden" class="sidebar-link">lockdown() vs. harden()</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#lockdown-options" class="sidebar-link">lockdown Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#default-safe-settings" class="sidebar-link">Default safe settings</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#options-quick-reference" class="sidebar-link">Options quick reference</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#regexptaming-options" class="sidebar-link">regExpTaming Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#purpose" class="sidebar-link">Purpose</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#background" class="sidebar-link">Background</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#localetaming-options" class="sidebar-link">localeTaming Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#purpose-2" class="sidebar-link">Purpose</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#background-2" class="sidebar-link">Background</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#consoletaming-options" class="sidebar-link">consoleTaming Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#purpose-3" class="sidebar-link">Purpose</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#background-3" class="sidebar-link">Background</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#errortaming-options" class="sidebar-link">errorTaming Options</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#purpose-4" class="sidebar-link">Purpose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#background-4" class="sidebar-link">Background</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#stackfiltering-options" class="sidebar-link">stackFiltering Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#purpose-5" class="sidebar-link">Purpose</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#background-5" class="sidebar-link">Background</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#overridetaming-options" class="sidebar-link">overrideTaming Options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#purpose-6" class="sidebar-link">Purpose</a></li><li class="sidebar-sub-header"><a href="/documentation/guides/js-programming/ses/lockdown.html#background-6" class="sidebar-link">Background</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/repl/" class="sidebar-heading clickable"><span>REPL</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="sidebar-link">Dynamic IBC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/documentation/guides/chainlink-integration.html" class="sidebar-link">Chainlink Integration</a></li><li><a href="/documentation/getting-started/" class="sidebar-link">Documentation Guide</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lockdown-and-its-options"><a href="#lockdown-and-its-options" class="header-anchor">#</a> <code>lockdown()</code> and its Options</h1> <p><strong>Note: This document is a companion to the <a href="/documentation/guides/js-programming/ses/ses-guide.html">SES-Guide</a>, in that it explains and gives backgrounds
to <code>lockdown()</code> and its options. If you just want to use <code>lockdown()</code> with minimal explanation,
please see <a href="/documentation/guides/js-programming/ses/ses-reference.html">SES-Reference</a>.</strong></p> <p>Calling <code>lockdown()</code> turns a JavaScript system into a SES (Secure ECMAScript) system,
with enforced <em>OCap (object-capability) security</em>. This page documents <code>lockdown()</code> and its
configuration options.</p> <p><code>lockdown()</code> alters the surrounding execution environment, or <em>realm</em>, such that no two programs
running in the same realm can observe or interfere with each other until they have been introduced.</p> <p>To do this, <code>lockdown()</code> tamper-proofs all of the JavaScript intrinsics to prevent prototype pollution.
After that, no program can subvert the methods of these objects (preventing some man in the middle
attacks). Also, no program can use these mutable objects to pass notes to parties that haven't been
expressly introduced (preventing some covert communication channels).</p> <p>Lockdown freezes all JavaScript defined objects accessible to any program in the realm. The frozen
accessible objects include but are not limited to:</p> <ul><li><code>globalThis</code></li> <li><code>[].__proto__</code> the array prototype, equivalent to Array.prototype in a pristine JavaScript environment.</li> <li><code>{}.__proto__</code> the Object.prototype</li> <li><code>(() =&gt; {}).__proto__</code> the Function.prototype</li> <li>(async () =&gt; {}).<strong>proto</strong>` the prototype of all asynchronous functions, and has no alias in the global scope of a pristine JavaScript environment</li> <li>The properties of any accessible object</li></ul> <p><code>lockdown()</code> also <em>tames</em> some objects, such as:</p> <ul><li>Regular expressions
<ul><li>A tamed RexExp does not have the deprecated compile method.</li></ul></li> <li>Locale methods
<ul><li>Lockdown replaces locale methods like <code>String.prototype.localeCompare()</code> with lexical
versions that do not reveal the user locale.</li></ul></li> <li>Errors
<ul><li>A tamed error does not have a V8 stack, but the console can still see the stack.
Lockdown replaces locale methods like</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'ses'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'my-vetted-shim'</span><span class="token punctuation">;</span>

<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">isFrozen</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// true</span>
</code></pre></div><p>Lockdown does not erase any powerful objects from the initial global scope. Instead,
Compartments give complete control over what powerful objects exist for client code.</p> <h2 id="lockdown-vs-harden"><a href="#lockdown-vs-harden" class="header-anchor">#</a> <code>lockdown()</code> vs. <code>harden()</code></h2> <p><code>lockdown()</code> and <code>harden()</code> essentially do the same thing; freeze objects so their
properties cannot be changed. The only way to interact with frozen objects is through
their methods. Their differences are what objects you use them on, and when you use them.</p> <p><code>lockdown()</code> <strong>must</strong> be called first. It hardens JavaScript's built-in <em>primordials</em>
(implicitly shared global objects) and enables <code>harden()</code>. If you call <code>harden()</code>
before <code>lockdown()</code> executes, it throws an error.</p> <p><code>lockdown()</code> works on objects created by the JavaScript language itself as part of
its definition. Use <code>harden()</code> to freeze objects created after <code>lockdown()</code>was called;
i.e. objects created by programs written in JavaScript.</p> <h2 id="lockdown-options"><a href="#lockdown-options" class="header-anchor">#</a> <code>lockdown</code> Options</h2> <h3 id="default-safe-settings"><a href="#default-safe-settings" class="header-anchor">#</a> Default <code>safe</code> settings</h3> <p>All four of these safety-relevant options default to <code>'safe'</code> if omitted
from a call to <code>lockdown()</code>. Their other possible value is <code>'unsafe'</code>.</p> <ul><li><code>regExpTaming</code></li> <li><code>localeTaming</code></li> <li><code>consoleTaming</code></li> <li><code>errorTaming</code></li></ul> <p>The tradeoff is safety vs compatibility with existing code. However, much legacy
JavaScript code does run under SES, even if both not written to do so and with all
the options set to <code>'safe'</code>. Only consider an <code>'unsafe'</code> value if you both need it
and can evaluate its risks. These are described in more detail below.</p> <h3 id="options-quick-reference"><a href="#options-quick-reference" class="header-anchor">#</a> Options quick reference</h3> <p>This section provides a quick usage reference for lockdown's options, their possible
values, and their usage. Each is described in more detail in their individual sections
below.</p> <table><tbody><tr><td><b>Option</b></td> <td><b>Values</b></td> <td><center><b>Functionality</b></center></td></tr> <tr><td><code>regExpTaming</code></td> <td><code>'safe'</code> (default) or <code>'unsafe'</code></td> <td><code>'safe'</code> disables all <code>RegExp.*</code> methods,<br> <code>'unsafe'</code> disables all but <code>RegExp.prototype.compile()</code></td></tr> <tr><td><code>localeTaming</code></td> <td><code>'safe'</code> (default) or <code>'unsafe'</code></td> <td><code>'safe'</code> aliases <code>toLocaleString()</code> to <code>toString()</code>, etc.,<br> <code>'unsafe'</code> keeps JavaScript locale methods as is</td></tr> <tr><td><code>consoleTaming</code></td> <td><code>'safe'</code> (default) or <code>'unsafe'</code></td> <td><code>'safe'</code> wraps start console to show deep stacks,<br> <code>'unsafe'</code> uses the original start console.</td></tr> <tr><td><code>errorTaming</code></td> <td><code>'safe'</code> (default) or <code>'unsafe'</code></td> <td><code>'safe'</code> denies unprivileged stacks access,<br> <code>'unsafe'</code> makes stacks also available by <code>errorInstance.stackkeeps()</code>.</td></tr> <tr><td><code>stackFiltering</code></td> <td><code>'concise'</code> (default) or <code>'verbose'</code></td> <td><code>'concise'</code> preserves important deep stack info,<br> <code>'verbose'</code> console shows full deep stacks</td></tr> <tr><td><code>overrideTaming</code></td> <td><code>'moderate'</code> (default) or <code>'min'</code></td> <td><code>'moderate'</code> moderates mitigations for legacy compatibility,<br> <code>'min'</code> minimal mitigations for purely modern code</td></tr></tbody></table> <h2 id="regexptaming-options"><a href="#regexptaming-options" class="header-anchor">#</a> <code>regExpTaming</code> Options</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// regExpTaming defaults to 'safe'</span>
<span class="token comment">// or</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> regExpTaming<span class="token operator">:</span> <span class="token string">'safe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Disables all RegExp.*() methods.</span>
<span class="token comment">// vs</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> regExpTaming<span class="token operator">:</span> <span class="token string">'unsafe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Disables all RegExp.*() methods except RegExp.prototype.compile()</span>
</code></pre></div><h3 id="purpose"><a href="#purpose" class="header-anchor">#</a> Purpose</h3> <p>With its default <code>'safe'</code> value, <code>regExpTaming</code> prevents using <code>RegExp.*()</code> methods in
the locked down code.</p> <p>With its <code>'unsafe'</code> value, <code>RegExp.prototype.compile()</code> can be used in locked down code.
However, all other <code>RegExp.*()</code> methods are disabled</p> <h3 id="background"><a href="#background" class="header-anchor">#</a> Background</h3> <p>There are two reasons for removing <code>RegExp.*</code> methods from usable JavaScript.
One is for <code>RegExp.prototype.compile()</code> and one for all other <code>RegExp.*()</code> methods.</p> <ul><li><p>In standard JavaScript, <code>RegExp.prototype.compile()</code> may
violate the object invariants of frozen <code>RegExp</code> instances. This violates
assumptions elsewhere, and so can corrupt other guarantees. For example,
the <code>Proxy</code> abstraction preserves the object invariants only if its target
does. If a non-conforming object is available, it can construct an also
non-conforming proxy object.</p> <p>The default <code>'safe'</code> setting deletes this dangerous method. The
<code>'unsafe'</code> setting keeps it for compatibility purposes at the price of riskier code.</p></li> <li><p>In standard JavaScript, legacy <code>RegExp</code> static methods like <code>RegExp.lastMatch()</code>
are an unsafe global <a href="https://agoric.com/taxonomy-of-security-issues/" target="_blank" rel="noopener noreferrer">overt communications channel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
The <code>RegExp</code> constructor reveals information derived from the last match
made by any <code>RegExp</code> instance in a form of non-local causality.</p> <p>Except for <code>RegExp.prototype.compile()</code> all <code>RegExp</code> static methods are currently
removed under <strong>both</strong> the <code>regExpTaming</code> <code>'safe</code>' and <code>'unsafe'</code> settings. This
has not caused any compatibility problems; if it does, we may allow a subset
under the <code>'unsafe'</code> setting.</p></li></ul> <h2 id="localetaming-options"><a href="#localetaming-options" class="header-anchor">#</a> <code>localeTaming</code> Options</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// localeTaming defaults to 'safe'</span>
<span class="token comment">// or</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> localeTaming<span class="token operator">:</span> <span class="token string">'safe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Alias toLocaleString to toString, etc</span>
<span class="token comment">// vs</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> localeTaming<span class="token operator">:</span> <span class="token string">'unsafe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Allow locale-specific behavior</span>
</code></pre></div><h3 id="purpose-2"><a href="#purpose-2" class="header-anchor">#</a> Purpose</h3> <p>The default <code>'safe'</code> setting replaces each method listed below with their
corresponding non-locale-specific method. For example, <code>Object.prototype.toLocaleString()</code>
becomes another name for <code>Object.prototype.toString()</code>.</p> <p>The <code>'unsafe'</code> setting keeps the original behavior for compatibility at the price
of reproducibility and fingerprinting.</p> <p>In standard JavaScript, these built-in methods have <code>Locale</code> or <code>locale</code> in their name
and are affected by <code>localeTaming</code>:</p> <ul><li><code>toLocaleString</code></li> <li><code>toLocaleDateString</code></li> <li><code>toLocaleTimeString</code></li> <li><code>toLocaleLowerCase</code></li> <li><code>toLocaleUpperCase</code></li> <li><code>localeCompare</code></li></ul> <h3 id="background-2"><a href="#background-2" class="header-anchor">#</a> Background</h3> <p>All &quot;locale method&quot; behavior varies depending on the user's locale and can change while
a program is running. This breaks determinism since a program run in one compartment may have
a different result in another compartment or at another time. Also, revealing the user's locale<br>
helps unscrupulous programs to track and even identify the user.</p> <p>This behavior might be acceptable if governed on a per-compartment basis (&quot;virtualized&quot;).
But since these methods appear on the prototype of shared intrinsic objects like the <code>String</code>
prototype, there is no safe alternative design.</p> <p>Instead, the hosting program can reveal the locale to all compartments by setting
<code>localeTaming</code> to <code>'unsafe'</code>, or inject a <code>locale</code> object into selected compartments
with the powers of these methods.</p> <p>Aside from fingerprinting, the risk that this slow non-determinism opens a
<a href="https://agoric.com/taxonomy-of-security-issues/" target="_blank" rel="noopener noreferrer">communications channel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
is negligible.</p> <h2 id="consoletaming-options"><a href="#consoletaming-options" class="header-anchor">#</a> <code>consoleTaming</code> Options</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// consoleTaming defaults to 'safe'</span>
<span class="token comment">// or</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> consoleTaming<span class="token operator">:</span> <span class="token string">'safe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wrap start console to show deep stacks</span>
<span class="token comment">// vs</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> consoleTaming<span class="token operator">:</span> <span class="token string">'unsafe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Leave original start console in place</span>
</code></pre></div><h3 id="purpose-3"><a href="#purpose-3" class="header-anchor">#</a> Purpose</h3> <p>The <code>'unsafe'</code> setting leaves the original console in place. The <code>assert</code> package
and error objects continue to work, but the <code>console</code> logging output will not
show this extra information.</p> <h3 id="background-3"><a href="#background-3" class="header-anchor">#</a> Background</h3> <p>Most JavaScript environments provide a write-only <code>console</code> object on the
global object. JavaScript code can write to the console's logging output, but
cannot see that output. The logging output is normally meant for humans, and
is mostly formatted for human use for diagnosing problems.</p> <p>Given these constraints, it is safe and helpful for <code>console</code> to reveal
to humans information it would not reveal to objects it interacts with.
SES amplifies this and reveals much more information than the normal
<code>console</code> does. By default and during <code>lockdown</code> SES replaces the built-in
<code>console</code> with a wrapper, thus virtualizing it.</p> <p>Also, the enhanced virtual <code>console</code> has a special relationship with
error objects and the SES <code>assert</code> package. Errors can report
more diagnostic information that should be hidden from other objects. See
the <a href="https://github.com/endojs/endo/blob/master/packages/ses/src/error/README.md" target="_blank" rel="noopener noreferrer">error README<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
for an in depth explanation of this
relationship between errors, <code>assert</code> and the virtual <code>console</code>.</p> <p><code>console</code> often has additional methods beyond its de facto &quot;standards&quot;. The
<code>'unsafe'</code> setting does not remove them. We do not know if these additional
methods violate OCap security, so should assume they are unsafe. A raw <code>console</code>
object should only be handled by very trustworthy code.</p> <p>Examples from
<a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/eventual-send/test/test-deep-send.js" target="_blank" rel="noopener noreferrer">test-deep-send.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
of the eventual-send shim:</p> <details><summary>Expand for { consoleTaming: 'safe' } log output</summary> <div class="language- extra-class"><pre><code>expected failure (Error#1)
Nested error
  Error#1: Wut?
    at Object.bar (packages/eventual-send/test/test-deep-send.js:13:21)

  Error#1 ERROR_NOTE: Thrown from: (Error#2) : 2 . 0
  Error#1 ERROR_NOTE: Rejection from: (Error#3) : 1 . 1
  Nested 2 errors under Error#1
    Error#2: Event: 1.1
      at Object.foo (packages/eventual-send/test/test-deep-send.js:17:28)

    Error#2 ERROR_NOTE: Caused by: (Error#3)
    Nested error under Error#2
      Error#3: Event: 0.1
        at Object.test (packages/eventual-send/test/test-deep-send.js:21:22)
        at packages/eventual-send/test/test-deep-send.js:25:19
        at async Promise.all (index 0)
</code></pre></div></details> <details><summary>Expand for { consoleTaming: 'unsafe', overrideTaming: 'min' } log output</summary> <div class="language- extra-class"><pre><code>expected failure [Error: Wut?
  at Object.bar (packages/eventual-send/test/test-deep-send.js:13:21)]
</code></pre></div></details> <h2 id="errortaming-options"><a href="#errortaming-options" class="header-anchor">#</a> <code>errorTaming</code> Options</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// errorTaming defaults to 'safe'</span>
<span class="token comment">// or</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> errorTaming<span class="token operator">:</span> <span class="token string">'safe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Deny unprivileged access to stacks, if possible</span>
<span class="token comment">// vs</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> errorTaming<span class="token operator">:</span> <span class="token string">'unsafe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Stacks also available by errorInstance.stack</span>
</code></pre></div><h2 id="purpose-4"><a href="#purpose-4" class="header-anchor">#</a> Purpose</h2> <p>The <code>errorTaming</code> default <code>'safe'</code> setting makes the stack trace inaccessible
from error instances alone. It does this on v8 (Chrome, Brave, Node) and SpiderMonkey (Firefox).
Note that it is <strong>not</strong> hidden on other engines, leaving an information
leak available. It reveals information only as a powerless
string. It threatens <a href="https://agoric.com/taxonomy-of-security-issues/" target="_blank" rel="noopener noreferrer">confidentiality but not integrity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In JavaScript the stack is only available via <code>err.stack</code>, so some
development tools assume it is there. When the information leak is tolerable,
the <code>'unsafe'</code> setting preserves <code>err.stack</code>'s filtered stack information.</p> <h3 id="background-4"><a href="#background-4" class="header-anchor">#</a> Background</h3> <p>JavaScript's error system has several safety problems.
In most JavaScript engines running normal JavaScript, if <code>err</code> is an
Error instance, the expression <code>err.stack</code> produces a string that
reveals the stack trace. This is an <a href="https://agoric.com/taxonomy-of-security-issues/" target="_blank" rel="noopener noreferrer">overt information leak, a confidentiality
violation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
This <code>stack</code> property reveals call stack information that violates
the callers' encapsulation.</p> <p>This <code>stack</code> is part of de facto JavaScript, but not part
of the official standard. It is proposed at
<a href="https://github.com/tc39/proposal-error-stacks" target="_blank" rel="noopener noreferrer">Error Stacks proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>On v8—the JavaScript engine powering Chrome, Brave, and Node—the
default error behavior is dangerous. The v8 <code>Error</code> constructor
provides a set of <a href="https://v8.dev/docs/stack-trace-api" target="_blank" rel="noopener noreferrer">static methods for accessing the raw stack
information<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that create
the error stack string.</p> <p><code>errorTaming</code> does not affect the <code>Error</code> constructor's safety.
After calling <code>lockdown</code>, the tamed <code>Error</code> constructor in the
start compartment follows OCap rules. Under v8 it emulates most of the
magic powers of the v8 <code>Error</code> constructor—those consistent with the
discourse level of the proposed <code>getStack</code>. In all cases, the <code>Error</code>
constructor shared by all other compartments is both safe and powerless.</p> <p>See the <a href="https://github.com/endojs/endo/blob/master/packages/ses/src/error/README.md" target="_blank" rel="noopener noreferrer">error README<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
for an in depth explanation of the
relationship between errors, <code>assert</code> and the virtual <code>console</code>.</p> <h2 id="stackfiltering-options"><a href="#stackfiltering-options" class="header-anchor">#</a> <code>stackFiltering</code> Options</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// stackFiltering defaults to 'concise'</span>
<span class="token comment">// or</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stackFiltering<span class="token operator">:</span> <span class="token string">'concise'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Preserve important deep stack info</span>
<span class="token comment">// vs</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stackFiltering<span class="token operator">:</span> <span class="token string">'verbose'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Console shows full deep stacks</span>
</code></pre></div><h3 id="purpose-5"><a href="#purpose-5" class="header-anchor">#</a> Purpose</h3> <p><code>stackFiltering</code> trades off stronger stack traceback filtering to
minimize distractions vs completeness for tracking down bugs in
obscure places.</p> <h3 id="background-5"><a href="#background-5" class="header-anchor">#</a> Background</h3> <p>Many JavaScript engines show voluminous error stacks, containing many stack
frames of infrastructure functions which are usually irrelevant for bug diagnosis.
The SES-shim's <code>console</code>, with <code>consoleTaming</code> set to <code>'safe'</code>, is even more
voluminous. It displays &quot;deep stack&quot; traces, tracing back through the
<a href="https://github.com/tc39/proposal-eventual-send" target="_blank" rel="noopener noreferrer">eventually sent messages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
from other turns of the event loop.</p> <p>Full deep distributed stacks are overwhelmingly noisy for debugging distributed
computation. When possible, the SES-shim filters and transforms the shown stack
trace information, removing artifacts from low level infrastructure.
Currently, this only works on v8.</p> <p>The 'concise' vs 'verbose' settings are about trying to reduce the noise appearing
on the console's reported stack traces.
The default <code>'concise'</code> setting reduces the noise. But it does so at the risk of
throwing out the signal you were really looking for. Sometimes bugs might be in
that infrastructure, so that information is relevant. With the <code>'verbose'</code> setting,
the console shows the full raw stack information for each level of the deep stacks.</p> <p>Either <code>stackFiltering</code> setting is safe. Stack information will
or will not be available from error objects according to the <code>errorTaming</code>
option and the platform error behavior.</p> <p>Examples from
<a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/eventual-send/test/test-deep-send.js" target="_blank" rel="noopener noreferrer">test-deep-send.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
of the eventual-send shim:
</p><details><summary>Expand for { stackFiltering: 'concise' } log output</summary><p></p> <div class="language- extra-class"><pre><code>expected failure (Error#1)
Nested error
  Error#1: Wut?
    at Object.bar (packages/eventual-send/test/test-deep-send.js:13:21)

  Error#1 ERROR_NOTE: Thrown from: (Error#2) : 2 . 0
  Error#1 ERROR_NOTE: Rejection from: (Error#3) : 1 . 1
  Nested 2 errors under Error#1
    Error#2: Event: 1.1
      at Object.foo (packages/eventual-send/test/test-deep-send.js:17:28)

    Error#2 ERROR_NOTE: Caused by: (Error#3)
    Nested error under Error#2
      Error#3: Event: 0.1
        at Object.test (packages/eventual-send/test/test-deep-send.js:21:22)
        at packages/eventual-send/test/test-deep-send.js:25:19
        at async Promise.all (index 0)
</code></pre></div></details> <details><summary>Expand for { stackFiltering: 'verbose' } log output</summary> <div class="language- extra-class"><pre><code>expected failure (Error#1)
Nested error
  Error#1: Wut?
    at makeError (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/install-ses/node_modules/ses/dist/ses.cjs:2976:17)
    at Function.fail (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/install-ses/node_modules/ses/dist/ses.cjs:3109:19)
    at Object.bar (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/test/test-deep-send.js:13:21)
    at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:388:23
    at Object.applyMethod (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:353:14)
    at doIt (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:395:67)
    at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/track-turns.js:64:22
    at win (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:408:19)
    at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:425:20
    at processTicksAndRejections (internal/process/task_queues.js:93:5)

  Error#1 ERROR_NOTE: Thrown from: (Error#2) : 2 . 0
  Error#1 ERROR_NOTE: Rejection from: (Error#3) : 1 . 1
  Nested 2 errors under Error#1
    Error#2: Event: 1.1
      at trackTurns (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/track-turns.js:47:24)
      at handle (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:396:27)
      at Function.applyMethod (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:312:14)
      at Proxy.&amp;lt;anonymous&amp;gt; (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/E.js:37:49)
      at Object.foo (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/test/test-deep-send.js:17:28)
      at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:388:23
      at Object.applyMethod (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:353:14)
      at doIt (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:395:67)
      at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/track-turns.js:64:22
      at win (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:408:19)
      at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:425:20
      at processTicksAndRejections (internal/process/task_queues.js:93:5)

    Error#2 ERROR_NOTE: Caused by: (Error#3)
    Nested error under Error#2
      Error#3: Event: 0.1
        at trackTurns (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/track-turns.js:47:24)
        at handle (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:396:27)
        at Function.applyMethod (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/index.js:312:14)
        at Proxy.&lt;anonymous&gt; (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/src/E.js:37:49)
        at Object.test (/Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/test/test-deep-send.js:21:22)
        at /Users/markmiller/src/ongithub/agoric/agoric-sdk/packages/eventual-send/test/test-deep-send.js:25:19
        at Test.callFn (/Users/markmiller/src/ongithub/agoric/agoric-sdk/node_modules/ava/lib/test.js:610:21)
        at Test.run (/Users/markmiller/src/ongithub/agoric/agoric-sdk/node_modules/ava/lib/test.js:623:23)
        at Runner.runSingle (/Users/markmiller/src/ongithub/agoric/agoric-sdk/node_modules/ava/lib/runner.js:280:33)
        at Runner.runTest (/Users/markmiller/src/ongithub/agoric/agoric-sdk/node_modules/ava/lib/runner.js:348:30)
        at processTicksAndRejections (internal/process/task_queues.js:93:5)
        at async Promise.all (index 0)
        at async /Users/markmiller/src/ongithub/agoric/agoric-sdk/node_modules/ava/lib/runner.js:493:21
        at async Runner.start (/Users/markmiller/src/ongithub/agoric/agoric-sdk/node_modules/ava/lib/runner.js:503:15)
</code></pre></div></details> <h2 id="overridetaming-options"><a href="#overridetaming-options" class="header-anchor">#</a> <code>overrideTaming</code> Options</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// overrideTaming defaults to 'moderate'</span>
<span class="token comment">// or</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> overrideTaming<span class="token operator">:</span> <span class="token string">'moderate'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Moderate mitigations for legacy compatibility</span>
<span class="token comment">// vs</span>
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">{</span> overrideTaming<span class="token operator">:</span> <span class="token string">'min'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Minimal mitigations for purely modern code</span>
</code></pre></div><h3 id="purpose-6"><a href="#purpose-6" class="header-anchor">#</a> Purpose</h3> <p>The <code>overrideTaming</code> option trades off better code
compatibility vs better tool compatibility.</p> <h3 id="background-6"><a href="#background-6" class="header-anchor">#</a> Background</h3> <p>JavaScript suffers from the so-called
<a href="https://web.archive.org/web/20141230041441/http://wiki.ecmascript.org/doku.php?id=strawman:fixing_override_mistake" target="_blank" rel="noopener noreferrer">override mistake<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,
preventing <code>lockdown()</code> from <em>simply</em> hardening all primordials.</p> <p>Rather, <code>lockdown()</code> converts each of
<a href="https://github.com/endojs/endo/blob/master/packages/ses/src/enablements.js" target="_blank" rel="noopener noreferrer">these data properties<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to an accessor
property whose getter and setter emulate <a href="https://github.com/tc39/ecma262/pull/1320" target="_blank" rel="noopener noreferrer">a data property without the override
mistake<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. For non-reflective code
the illusion is perfect. But reflective code sees it is an accessor
rather than a data property. We add an <code>originalValue</code> property to that accessor's
getter, letting reflective code know that a getter alleges that it
results from this transform, and what the original data value was. This enables
a form of cooperative emulation, where that code can decide whether to uphold
the illusion by pretending it sees the data property that would have been there.</p> <p>The VSCode debugger's object inspector shows the own properties of an object,
a great aid to debugging. Unfortunately, it also shows the inherited
accessor properties, with one line for the getter and another for the
setter. As you enable override on more properties of widely used prototypes,
you become compatible with more legacy code, but at the price of a significantly
worse debugging experience. Expand the &quot;Expand for...&quot; items at the end of this
section for screenshots showing the different experiences.</p> <p>Enablements have a further debugging cost. When single stepping <em>into</em> code,
you step into every access to an enabled property. Every read steps into
the enabling getter. This adds yet more noise to the debugging experience.</p> <p><a href="https://github.com/endojs/endo/blob/master/packages/ses/src/enablements.js" target="_blank" rel="noopener noreferrer">src/enablements.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> exports two different
whitelists defining which data properties to convert to enable override by
assignment, <code>moderateEnablements</code> and <code>minEnablements</code>.</p> <p>The <code>overrideTaming</code> default <code>'moderate'</code> option of <code>lockdown</code> is intended to
be fairly minimal. We expand it when we
encounter code which should run under SES but can't due to
the override mistake. As we encountered these we listed them in the comments
next to each enablement. We rarely come
across any more cases. <em><strong>If you find one, please file an issue.</strong></em></p> <p>The <code>'min'</code> enablements setting serves two purposes: it enables a pleasant
debugging experience in VSCode, and it helps ensure new code does not
depend on anything more than these being enabled.
All Agoric-authored is compatible with both settings, but
Agoric currently still pulls in some third party dependencies only compatible
with the <code>'moderate'</code> setting.</p> <p>The following screenshots shows inspection of the <code>{ abc: 123 }</code> object, both
by hover and in the rightmost &quot;VARIABLES&quot; pane.
Only the <code>abc</code> property is normally useful. All other lines are noise introduced
by our override mitigation.</p> <details><summary>Expand for { overrideTaming: 'moderate' } vscode inspector display</summary> <p>![overrideTaming: 'moderate' vscode inspector display](./assets/override-taming-moderate-inspector.png)</p></details> <details><summary>Expand for { overrideTaming: 'min' } vscode inspector display</summary> <p>![overrideTaming: 'min' vscode inspector display](./assets/override-taming-min-inspector.png)</p></details> <details><summary>Expand to see the vscode inspector display if enabling all of Object.prototype</summary> <p>![vscode inspector display if enabling all of Object.prototype](./assets/override-taming-star-inspector.png)</p></details></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Agoric/documentation/edit/main/main/guides/js-programming/ses/lockdown.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/13/2021, 11:04:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/documentation/guides/js-programming/ses/ses-reference.html" class="prev">
        SES Reference
      </a></span> <span class="next"><a href="/documentation/guides/wallet/api.html">
        Wallet API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/documentation/assets/js/app.da4d8089.js" defer></script><script src="/documentation/assets/js/2.92af905e.js" defer></script><script src="/documentation/assets/js/53.24ba908b.js" defer></script>
  </body>
</html>
