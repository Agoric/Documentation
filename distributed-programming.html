<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Agoric JavaScript Programming Extensions | Documentation</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/documentation/favicon-full.ico">
    <script>
    const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://agoric.com");
      homeEl.setAttribute("onclick", "return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://agoric.com';return false;");
      clearInterval(logoUrlChanger);
    }
   }, 1000) </script>
    <meta name="description" content="Secure smart contracts">
    <link rel="preload" href="/documentation/assets/css/0.styles.ca7d8779.css" as="style"><link rel="preload" href="/documentation/assets/js/app.ca63d9fa.js" as="script"><link rel="preload" href="/documentation/assets/js/2.8bbaee0a.js" as="script"><link rel="preload" href="/documentation/assets/js/16.e2b2b424.js" as="script"><link rel="prefetch" href="/documentation/assets/js/10.453a8393.js"><link rel="prefetch" href="/documentation/assets/js/11.96313a7f.js"><link rel="prefetch" href="/documentation/assets/js/12.d340e5db.js"><link rel="prefetch" href="/documentation/assets/js/13.1e7ac300.js"><link rel="prefetch" href="/documentation/assets/js/14.58d8b024.js"><link rel="prefetch" href="/documentation/assets/js/15.cc5a16d7.js"><link rel="prefetch" href="/documentation/assets/js/17.8b71faa1.js"><link rel="prefetch" href="/documentation/assets/js/18.83759d87.js"><link rel="prefetch" href="/documentation/assets/js/19.a25303a9.js"><link rel="prefetch" href="/documentation/assets/js/20.c0d79b58.js"><link rel="prefetch" href="/documentation/assets/js/21.40a6e686.js"><link rel="prefetch" href="/documentation/assets/js/22.3f6a3f6a.js"><link rel="prefetch" href="/documentation/assets/js/23.a59e237d.js"><link rel="prefetch" href="/documentation/assets/js/24.919c63aa.js"><link rel="prefetch" href="/documentation/assets/js/25.b93fae52.js"><link rel="prefetch" href="/documentation/assets/js/26.4bf7360a.js"><link rel="prefetch" href="/documentation/assets/js/27.1a6a8681.js"><link rel="prefetch" href="/documentation/assets/js/28.8cd4660c.js"><link rel="prefetch" href="/documentation/assets/js/29.e9094263.js"><link rel="prefetch" href="/documentation/assets/js/3.8c2423ef.js"><link rel="prefetch" href="/documentation/assets/js/30.8c92832f.js"><link rel="prefetch" href="/documentation/assets/js/31.32a9cb14.js"><link rel="prefetch" href="/documentation/assets/js/32.923afbc9.js"><link rel="prefetch" href="/documentation/assets/js/33.1fd6b250.js"><link rel="prefetch" href="/documentation/assets/js/34.a68446f3.js"><link rel="prefetch" href="/documentation/assets/js/35.37da518e.js"><link rel="prefetch" href="/documentation/assets/js/36.caaaca86.js"><link rel="prefetch" href="/documentation/assets/js/37.595983bd.js"><link rel="prefetch" href="/documentation/assets/js/38.d10204e5.js"><link rel="prefetch" href="/documentation/assets/js/39.4154a9e7.js"><link rel="prefetch" href="/documentation/assets/js/4.3bcf8760.js"><link rel="prefetch" href="/documentation/assets/js/40.de00f2c7.js"><link rel="prefetch" href="/documentation/assets/js/41.8d22e646.js"><link rel="prefetch" href="/documentation/assets/js/42.d854fd39.js"><link rel="prefetch" href="/documentation/assets/js/43.1419441e.js"><link rel="prefetch" href="/documentation/assets/js/44.71608364.js"><link rel="prefetch" href="/documentation/assets/js/45.6fb488b9.js"><link rel="prefetch" href="/documentation/assets/js/46.f19c74dd.js"><link rel="prefetch" href="/documentation/assets/js/47.a38f3471.js"><link rel="prefetch" href="/documentation/assets/js/48.4a882460.js"><link rel="prefetch" href="/documentation/assets/js/49.5e89ebc3.js"><link rel="prefetch" href="/documentation/assets/js/5.044c26e6.js"><link rel="prefetch" href="/documentation/assets/js/50.ffb6bda1.js"><link rel="prefetch" href="/documentation/assets/js/51.179af34e.js"><link rel="prefetch" href="/documentation/assets/js/52.840412f2.js"><link rel="prefetch" href="/documentation/assets/js/53.17ad3455.js"><link rel="prefetch" href="/documentation/assets/js/54.d84fe10a.js"><link rel="prefetch" href="/documentation/assets/js/55.f4591d81.js"><link rel="prefetch" href="/documentation/assets/js/56.598649df.js"><link rel="prefetch" href="/documentation/assets/js/57.fa6489ef.js"><link rel="prefetch" href="/documentation/assets/js/58.f1de1e66.js"><link rel="prefetch" href="/documentation/assets/js/59.5bb872de.js"><link rel="prefetch" href="/documentation/assets/js/6.ba9b7b21.js"><link rel="prefetch" href="/documentation/assets/js/60.1a8369eb.js"><link rel="prefetch" href="/documentation/assets/js/61.5193b7b6.js"><link rel="prefetch" href="/documentation/assets/js/62.8ed5afb8.js"><link rel="prefetch" href="/documentation/assets/js/7.8cd76d0d.js"><link rel="prefetch" href="/documentation/assets/js/8.fe4f4c5e.js"><link rel="prefetch" href="/documentation/assets/js/9.26470848.js">
    <link rel="stylesheet" href="/documentation/assets/css/0.styles.ca7d8779.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation/" class="home-link router-link-active"><img src="/documentation/logo.svg" alt="Documentation" class="logo"> <span class="site-name can-hide">Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Before Using Agoric
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/agoric-cli-guide.html" class="nav-link">
  Agoric CLI Guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/agoric-cli-guide/" class="nav-link">
  Agoric CLI
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/wallet-api.html" class="nav-link">
  Wallet API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/documentation/distributed-programming.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  JS Distributed Programming
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/autoswap.html" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Before Using Agoric
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/agoric-cli-guide.html" class="nav-link">
  Agoric CLI Guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/agoric-cli-guide/" class="nav-link">
  Agoric CLI
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/wallet-api.html" class="nav-link">
  Wallet API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/documentation/distributed-programming.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  JS Distributed Programming
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/autoswap.html" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="agoric-javascript-programming-extensions"><a href="#agoric-javascript-programming-extensions" class="header-anchor">#</a> Agoric JavaScript Programming Extensions</h1> <p>Agoric's platform lets you write secure smart contracts in JavaScript. The platform itself is mainly written in JavaScript. However, we've made several Agoric-specific additions to general JavaScript programming that you should know about and understand before programming on the platform. Some are <em>concepts</em>, others are <em>Agoric library additions</em>, and some are at the <em>syntax level</em>. All changes at the language level are in process to become official standards.</p> <p>Extensions covered in this document are:</p> <ul><li><p><strong><a href="#vats">Vats</a></strong>: Objects and functions in the same JavaScript vat can
communicate synchronously. Communication with objects outside the
vat can only be done asynchronously.</p></li> <li><p><strong><a href="#secure-ecmascript-ses">Secure EcmaScript (SES)</a></strong>: SES provides a secure platform for
executing programs. With SES, you can run code you don't completely trust,
without being vulnerable to bugs or bad intentions. It's a
standards-track extension to the JavaScript standard.</p></li> <li><p><strong><a href="#compartments-and-realms">Realms and compartments</a></strong>: JavaScript code runs in the context of
a <em>realm</em>, made up of the set of primordials (the standard
library's objects and functions) and a global object. In a web
browser, an iframe is a realm. In Node.js, a Node process is a
realm. A <em>compartment</em> is a separate execution environment within a realm.</p></li> <li><p><strong><a href="#harden"><code>harden()</code></a></strong>: A hardened object’s properties cannot be changed, so the only way to interact
with a hardened object is through its methods. <code>harden()</code>is similar to <code>Object.freeze()</code> but
more powerful.</p></li> <li><p><strong><a href="#communicating-with-remote-objects-using-e">Remote object communication using <code>E</code></a></strong>: <code>E</code> is a local &quot;bridge&quot; function that lets
you invoke methods on remote objects, whether in another vat, machine, or blockchain (for example).
It takes a local representative (a <em>proxy</em>) for a remote object as an argument and sends messages
to it using normal message-sending syntax. The local proxy forwards all messages to the remote
object to deal with. Sending a message to the remote object must be done by
using <code>E</code> (<code>E(remoteObj).myMethod()</code>), or the &quot;tildot&quot; operator `remoteObj~.myMethod()``</p></li> <li><p><strong><a href="#notifiers">Notifiers</a>:</strong> Our Promise-based Notifier notifies Dapps and other tools
about changes to their subscribed-to contracts or offers' state.</p></li></ul> <h2 id="vats"><a href="#vats" class="header-anchor">#</a> Vats</h2> <p>A vat is a <em>unit of isolation</em>. To paraphrase the Las Vegas advertising slogan, what happens in the vat stays in the vat. Objects and functions in a JavaScript vat can communicate synchronously with one another. Vats and their contents can communicate with other vats and their objects and functions, but have to
<a href="#Communicating-with-remote-objects-via-E">manage asynchronous messages and responses</a>.</p> <p>There are no tools for telling what vat something is in, or if two things are in the same or different vats. In general, you/your code should know if things are local (in the same vat) because you created them or they were passed to you by something guaranteeing that’s the case. Other objects you should treat as if they might be distant (in different vats). In practice, you will know that your normal method calls (<code>obj.method()</code>) fails because the method doesn't exist and that's usually when you slap your forehead and go &quot;Of course, it's remote!&quot;.</p> <p>Vats need to run on some platform. Both a single physical machine and a blockchain (which might itself be running on a set of  collaborating machines) are possible platforms. Either type of platform can host one or more vats.</p> <p>Since a vat runs in a single <em>event loop</em>, each incoming request has to finish before the next one starts. If there's remaining work, you schedule it to happen later after a Promise resolves.</p> <p>The Agoric process starts several vats. Each vat hosts a service (e.g. the Board, Zoe,
etc.). As of July, 2020, all contracts run in the Zoe vat. Eventually this will change to each contract having a dedicated vat.</p> <h2 id="secure-ecmascript-ses"><a href="#secure-ecmascript-ses" class="header-anchor">#</a> Secure EcmaScript (SES)</h2> <p>SES is a standards-track extension of the JavaScript standard
<a href="https://www.ecma-international.org/publications/standards/Ecma-262.htm" target="_blank" rel="noopener noreferrer">EcmaScript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
It provides a secure platform for executing programs, letting you run code you don't completely trust.
SES-based programs, whether you are an enduser or a server operator, can host untrusted developer apps’
code without being vulnerable to possible bugs or bad intentions.</p> <p>The guest developer’s app code runs in an immutable realm that by default has no access to ambient authority. Agoric’s hosting code provides access to disk or network or other services, and the guest code has no access to any ungranted authority. So developers can import and rely on library code from anywhere on the net, and have limited vulnerability to its misbehavior. The outside code can’t talk to the network, store data on disk, or use other powers without the Dapp's explicit permission.</p> <p>Every program that uses a library which  uses SES, should start with <code>import '@agoric/install-ses'</code> Libraries do not (and should not) do this, and contracts are basically libraries</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>lockdown<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ses&quot;</span><span class="token punctuation">;</span>
 
<span class="token function">lockdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// turns the current realm into an immutable realm</span>
<span class="token comment">// calling this function also adds a global Compartment constructor to create compartments</span>
</code></pre></div><h2 id="compartments-and-realms"><a href="#compartments-and-realms" class="header-anchor">#</a> Compartments and realms</h2> <p>JavaScript code runs in the context of a <a href="https://www.ecma-international.org/ecma-262/10.0/index.html#sec-code-realms" target="_blank" rel="noopener noreferrer"><code>Realm</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. A realm is composed of the set of <em>primordials</em> (objects and functions of the standard library like <code>Array.prototype.push</code>) and of a global object. In a web browser, an iframe is a realm. In Node.js, a Node process is a realm.</p> <p>For historical reasons, the ECMAScript specification requires the <em>primordials</em>
to be mutable (<code>Array.prototype.push = yourFunction</code> is valid
ECMAScript but not recommended). SES makes it possible to turn the
current realm into an <strong>immutable realm</strong>, that is a realm within
which the primordials are deeply frozen. It also allows programs to
create <strong>Compartments</strong>.</p> <p>Compartments are &quot;mini-realms&quot;. They have their own dedicated global object
and environment, but they inherit the primordials from their parent realm.</p> <p>Agoric deploy scripts and smart contract code run in an immutable
realm with compartments providing just enough authority to create
useful and secure contracts (but not enough authority to do anything
unintended or harmful to the participants of the smart contract).</p> <h2 id="harden"><a href="#harden" class="header-anchor">#</a> <code>harden()</code></h2> <p><code>harden()</code> ensures that external callers of a hardened object can only
interact with it through functions in the object’s API.
<code>harden()</code> is an enhanced transitive version of
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" target="_blank" rel="noopener noreferrer"><code>Object.freeze</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
which only locks up an object's own properties.</p> <p>All objects that will be transferred across a trust boundary must have
their API surface frozen (usually by calling <code>harden()</code>). This ensures
other objects can only interact with them through their defined
method interface. CapTP, our communications layer for passing
references to distributed objects, enforces this at vat boundaries.</p> <p>The general rule is that if you make a new object and give it to someone else (and don't immediately forget it yourself),
you should give them <code>harden(obj)</code> instead of the raw object.
This prevents someone from adding/deleting the properties or prototypes of that object.
Being hardened doesn't preclude an object from having access to mutable state (<code>harden(new Map())</code> still behaves like a normal mutable <code>Map</code>), but it means their methods stay the same and can't be surprisingly changed by someone else</p> <p>Defined objects (<code>mint</code>, <code>issuer</code>, <code>zcf,</code> etc.) shouldn't need hardening as their constructors should do that work. It's mainly records, callbacks, and ephemeral objects that need hardening.</p> <p>You can send a message to a hardened object. If it's a record, you can access its
properties and their values.</p> <p>You have to harden a class before you harden any of its instances; i.e. it takes two separate steps
to harden both a class and its instances. Harden a base class before hardening classes that inherit from it.
<code>harden()</code> does transitive freezing by following the object’s
own properties (as opposed to properties it inherited), and the objects whose own properties refer to them,
and so forth.</p> <p><code>harden()</code> is automatically provided by SES. Any code that will run inside a vat or a contract
can use harden as a global, without importing anything.</p> <p><strong>Tip</strong>: If your text editor/IDE complains about <code>harden()</code> not being defined or imported, try
adding <code>/* global harden */</code> to the top of the file.</p> <p>You use <code>harden()</code> like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>a  <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12 because o is still mutable</span>

<span class="token function">harden</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>

o<span class="token punctuation">.</span>a  <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span> <span class="token comment">// throws a TypeError because o is now hardened</span>
</code></pre></div><h2 id="communicating-with-remote-objects-using-e"><a href="#communicating-with-remote-objects-using-e" class="header-anchor">#</a> Communicating with remote objects using <code>E</code></h2> <p>On the Agoric platform, objects may be running in distinct vats, on a remote
machine, or even on a blockchain. When you send messages to non-local
objects in different vats, the response isn't received immediately and
can't be acted upon locally until it arrives.</p> <p>To keep from blocking local code until the response arrives, we
return a <code>Promise</code> for the result. You can send more messages to a result's
<code>Promise</code>. If and when the <code>Promise</code> resolves to a remote object, the messages
are forwarded to the object's location, and their results are
eventually returned and processed locally.</p> <p>JavaScript natively
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises" target="_blank" rel="noopener noreferrer">supports Promises<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Agoric's <code>HandledPromises</code> are compatible and interoperable with
standard <code>Promise</code>s. Standard interaction with a <code>Promise</code> or
<code>HandledPromise</code> is to do further processing either in a <code>.then()</code>
clause or after using <code>await</code> to get the result.</p> <p>You can send messages to a <code>Promise</code>'s eventual result, or to a
presence (a proxy for a remote object), using <code>E()</code> notation. For
example, <code>E(remoteServiceP).startup(params)</code>. The result of a
send using<code>E</code> is always a <code>Promise</code>, so the normal thing to do with
the result (as with any object) is either pass it as a parameter or
invoke a function to be performed once the <code>Promise</code> is fulfilled.</p> <p><code>E(remoteServiceP).startup(params).then(result =&gt; useTheService(result));</code></p> <p>Deploy scripts and Zoe smart contracts often access services running in a
different vat. For instance, a deploy script may want to install a contract in a
Zoe instance running in a blockchain. But the deploy script
cannot call <code>zoe.install(bundle)</code>, because it does not have local
access to the <code>zoe</code> object in a different vat. However, the deploy
script is given access to a <code>zoe</code> <em>presence</em>. To call methods on the
actual Zoe object, the deploy code can do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> installationHandle <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">E</span><span class="token punctuation">(</span>zoe<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>E()</code> function is a local &quot;bridge&quot; that lets you invoke methods on
remote objects. The local version of a remote object is called a
<strong>presence</strong>. <code>E()</code> takes a presence as an argument and creates an
object that is a forwarder that doesn't know what methods the remote object has.</p> <p>This is useful to know for debugging. If you misspell or incorrectly capitalize the method name,
the local environment can't tell you've done so. You'll only find out at runtime when the
remote object complains that it doesn't know that method.</p> <p><code>E()</code> performs the communication asynchronously. Method calls can take
objects in the current vat or presences for objects in other vats as arguments.</p> <p><code>E()</code> is frequently used in code to call
<a href="https://agoric.com/documentation/zoe/api/zoe.html" target="_blank" rel="noopener noreferrer">Zoe Service API methods<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="notifiers"><a href="#notifiers" class="header-anchor">#</a> Notifiers</h2> <p>Dapps and other tools may want to be notified about state changes of a Zoe
contract or offer. Agoric uses a Notifier based on Promises, allowing
many subscribers to receive notifications without the publisher
having to track a subscription list.</p> <p>Zoe supports the Notifier, which publishes updates to offer state
(reallocations and completions). Some contracts also use it, and
can publish current prices or other contract-specific details.</p> <h3 id="getting-notifications"><a href="#getting-notifications" class="header-anchor">#</a> Getting notifications</h3> <p>Zoe has a public method <code>getOfferNotifier()</code>, and contracts will have
similar methods. This method provides a long-lived notifier object associated
with a particular stream of updates.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> offerNotifer <span class="token operator">=</span> zoe<span class="token punctuation">.</span><span class="token function">getOfferNotifier</span><span class="token punctuation">(</span>offerHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> updateHandle<span class="token punctuation">,</span> done <span class="token punctuation">}</span> <span class="token operator">=</span> offerNotifier<span class="token punctuation">.</span><span class="token function">getUpdateSince</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token operator">&lt;</span>drop offer <span class="token keyword">from</span> list<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
  <span class="token function">waitForNextUpdate</span><span class="token punctuation">(</span>offerNotifier<span class="token punctuation">,</span> updateHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note: There is both a <code>zoe.getOfferNotifier()</code> and a <code>zcf.getOfferNotifier()</code>. Use the <code>zcf.</code> version
within contracts and the <code>zoe.</code> version in the REPL, deploy scripts, and similar outside of a contract cases.</p> <p>When called on a notifier object<code>notifier.getUpdateSince()</code> returns
the record <code>{ value, updateHandle, done }</code>. <code>value</code> represents
the state of an offer or contract. If you want a notifier from Zoe, you have to
identify the offer.</p> <ul><li><code>value</code> is the current state, according to the source.</li> <li><code>done</code> is <code>false</code> until the stream of updates reaches a final state. Then
<code>value</code> never changes and <code>getUpdateSince()</code> always returns the
same record. A contract calling <code>complete()</code> on an offer causes that
offer's notifier to be marked as done.</li> <li><code>updateHandle</code> is used to request to be notified the next
time there's a change to the state.</li></ul> <p>If you call <code>getUpdateSince(oldUpdateHandle)</code>:</p> <ul><li>With no handle, or any <code>updateHandle</code> other than the most recent
one:
<ul><li>The notifier immediately returns a record with the current state.</li></ul></li> <li>With the most-recently generated <code>updateHandle</code>:
<ul><li>The notifier returns a promise for the next record, which is resolved
on the next state change.</li></ul></li> <li>If you haven't called <code>getUpdateSince()</code> before, there is no previous update handle to use.</li></ul> <p>Some notification systems also provide access to a complete list of
an object's state changes. The Agoric Notifier API only directly supports
the single state change notification style. The client can't work around this
by keeping lists of changes, since the service doesn't send out all the changes
by default. The alternative approach is for the service to represent its state
as the set of changes leading up to the present. A use case for this is an
editor with an undo function, or an application with rollback ability.</p> <p>Rather than sending <code>&quot;the current state is 'blue'.&quot;</code>, a contract could send
<code>&quot;the current state is 'blue', the most recent update was { ''blah' =&gt; 'blue' }&quot;</code>.
That requires the contract to determine that clients want redundant info, and
package and send it.</p> <p>A common pattern for following updates to a notifier until it's done is the following.
Note that the notifier object is outside the contract facet, and so uses <code>E()</code>.*
Also, <code>PublicAPI</code> is a widely available contract facet, where it often makes sense to
put the <code>getNotifier()</code> method.</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">updateStateOnChanges</span><span class="token punctuation">(</span><span class="token parameter">notifier<span class="token punctuation">,</span> lastHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">E</span><span class="token punctuation">(</span>notifier<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">getUpdateSince</span><span class="token punctuation">(</span>lastHandle<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">,</span> updateHandle<span class="token punctuation">,</span> done <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">stopTracking</span><span class="token punctuation">(</span>notifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">respondToNewValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// resubscribe for more updates</span>
          <span class="token function">updateStateOnChanges</span><span class="token punctuation">(</span>notifier<span class="token punctuation">,</span> updateHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token constant">E</span><span class="token punctuation">(</span>publicAPI<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">getNotifier</span><span class="token punctuation">(</span>offerHandle<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">notifier</span> <span class="token operator">=&gt;</span> <span class="token function">updateStateOnChanges</span><span class="token punctuation">(</span>notifier <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Zoe's updates for an offer show the current allocation to be
paid if the contract completes without further changes. When the
contract calls <code>complete()</code> on the offer, its notifier is marked <code>done</code>.</p> <h3 id="providing-updates"><a href="#providing-updates" class="header-anchor">#</a> Providing updates</h3> <p>Contract instances use a notifier to provide updates to people who
want to follow changes. They import and call
<code>produceNotifer()</code>, which returns two facets, a notifier and an updater. You can
pass the notifier object to anyone allowed to see that contract
instance's state changes.</p> <p>The updater has two methods, which both send a notification with the
new state to any waiting notifiers:</p> <ul><li><code>updateState(newState)</code></li> <li><code>resolve(finalState)</code> <ul><li><code>resolve()</code> also resolves the promise to a record with <code>done: true, updateHandle: undefined</code>, and ensures that the answer will never change.</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> produceNotifier <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@agoric/notifier'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> notifier<span class="token punctuation">,</span> updater <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">produceNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/documentation/assets/js/app.ca63d9fa.js" defer></script><script src="/documentation/assets/js/2.8bbaee0a.js" defer></script><script src="/documentation/assets/js/16.e2b2b424.js" defer></script>
  </body>
</html>
